<!doctype html><html lang=ja-jp>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=google-site-verification content="GjZA39yW9nL5F-rpFgxBuJd8TcTapj6xw7YLY9XbA8A">
<link rel=icon href=https://suzukiiichiro.github.io/assets/images/favicon/favicon.svg type=image/svg+xml>
<link rel=apple-touch-icon type=image/png href=https://suzukiiichiro.github.io/assets/images/favicon/apple-touch-icon-180x180.png>
<link rel=icon type=image/png href=https://suzukiiichiro.github.io/assets/images/favicon/icon-192x192.png>
<meta name=description content="ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiiichiro/N-Queens/tree/master/13Bit_codon Ｎクイーン問題 過去記事アーカイブ 【過去記事アーカイブ】Ｎク">
<meta name=keywords content="N-Queens,エイト・クイーン,アルゴリズム,鈴木維一郎,Python,codon,Webデザイン,Webサイト開発,bash,CSS,サーバ">
<title>Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化｜NLP</title>
<link rel=stylesheet href=https://suzukiiichiro.github.io/scss/style.min.css>
<link rel=stylesheet href=https://suzukiiichiro.github.io/css/normalize.min.css>
<link rel=stylesheet href=https://suzukiiichiro.github.io/scss/override.min.css>
<link rel=stylesheet href=https://suzukiiichiro.github.io/scss/custom.min.css>
<meta property="og:title" content="Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化｜NLP">
<meta property="og:description" content="ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiiichiro/N-Queens/tree/master/13Bit_codon Ｎクイーン問題 過去記事アーカイブ 【過去記事アーカイブ】Ｎク">
<meta property="og:url" content="https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/">
<meta property="og:site_name" content="NLP">
<meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="N-Queens"><meta property="article:tag" content="エイト・クイーン"><meta property="article:tag" content="アルゴリズム"><meta property="article:tag" content="鈴木維一郎"><meta property="article:tag" content="Python"><meta property="article:tag" content="codon"><meta property="article:published_time" content="2025-10-27T13:26:39+09:00"><meta property="article:modified_time" content="2025-10-27T15:07:08+09:00"><meta property="og:image" content="https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess.jpg">
<meta name=twitter:title content="Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化｜NLP">
<meta name=twitter:description content="ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiiichiro/N-Queens/tree/master/13Bit_codon Ｎクイーン問題 過去記事アーカイブ 【過去記事アーカイブ】Ｎク"><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess.jpg"><meta name=google-site-verification content="UkPHZN1iNRRN6BWnpUWNpNbk1KXAKuS1_0kZRhu6ock">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PE15Z9ML80"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config',"G-PE15Z9ML80",{custom_map:{dimension1:'image_url'},image_url:'/posts/2025-10-27-15-n-queens-suzuki/chess.jpg'})</script><script type=application/ld+json>[{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化","mainEntityOfPage":{"@type":"WebPage","@id":"https://suzukiiichiro.github.io/categories/programming/"},"image":["https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess.jpg"],"datePublished":"2025-10-27T13:26:39+09:00","dateModified":"2025-10-27T15:07:08+09:00","publisher":{"@type":"Organization","name":"NLP - 最新技術やプログラム、デザインなど様々な情報を提供するサイト","logo":{"@type":"ImageObject","url":"https://suzukiiichiro.github.io//images/logo.png"}},"author":{"@type":"Person","name":"suzukiiichiro","url":["https://github.com/nlp","https://suzukiiichiro.github.io/authors/suzuki/"]}},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"NLP","item":"https://suzukiiichiro.github.io/"},{"@type":"ListItem","position":2,"name":"Posts","item":"https://suzukiiichiro.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化","item":"https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/"}]}]</script>
</head>
<body class=article-page>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
on-phone--column extended">
<div class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=メニューを開く・閉じる>
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header class=site-info><div class="site-name site-avatar"><a href=https://suzukiiichiro.github.io/>
<picture>
<source src=https://suzukiiichiro.github.io/images/logo_hu492d4071ba1c5fc31251c8d6beb6380e_133587_60x0_resize_box_3.png srcset="https://suzukiiichiro.github.io/images/logo_hu492d4071ba1c5fc31251c8d6beb6380e_133587_60x0_resize_box_3.png 1x, https://suzukiiichiro.github.io/images/logo_hu492d4071ba1c5fc31251c8d6beb6380e_133587_120x0_resize_box_3.png 2x" media="(min-width: 769px)" width=60 height=60>
<source src=https://suzukiiichiro.github.io/images/logo_hu492d4071ba1c5fc31251c8d6beb6380e_133587_30x0_resize_box_3.png srcset="https://suzukiiichiro.github.io/images/logo_hu492d4071ba1c5fc31251c8d6beb6380e_133587_30x0_resize_box_3.png 1x, https://suzukiiichiro.github.io/images/logo_hu492d4071ba1c5fc31251c8d6beb6380e_133587_60x0_resize_box_3.png 2x" media="(max-width: 768px)" width=30 height=30>
<img src=https://suzukiiichiro.github.io/images/logo_hu492d4071ba1c5fc31251c8d6beb6380e_133587_60x0_resize_box_3.png srcset="https://suzukiiichiro.github.io/images/logo_hu492d4071ba1c5fc31251c8d6beb6380e_133587_60x0_resize_box_3.png 1x, https://suzukiiichiro.github.io/images/logo_hu492d4071ba1c5fc31251c8d6beb6380e_133587_120x0_resize_box_3.png 2x" width=60 height=60 class=site-logo loading=lazy alt=NLP>
</picture>
</a></div>
<h2 class=site-description>最新技術やプログラム、デザインなど様々な情報を提供するサイト</h2></header>
<div id=main-menu>
<div id=main-menu-area>
<nav class="menu menu-section" id=categories-menu>
<ul class=menu-list id=main-cat>
<li><a href=https://suzukiiichiro.github.io/ id=link-top>TOP</a></li>
<li>
<a href=https://suzukiiichiro.github.io/categories/ id=link-category>カテゴリ</a>
<ul class=menu-list>
<li>
<a href=https://suzukiiichiro.github.io/categories/programming/ class=font_size_288>
プログラミング
</a>
</li>
<li>
<a href=https://suzukiiichiro.github.io/categories/web/ class=font_size_22>
Web開発
</a>
</li>
<li>
<a href=https://suzukiiichiro.github.io/categories/server/ class=font_size_2>
サーバー構築
</a>
</li>
<li>
<a href=https://suzukiiichiro.github.io/categories/linux/ class=font_size_1>
Linux
</a>
</li>
</ul>
</li>
</ul>
</nav>
<nav>
<ol class="menu menu-section"><li>
<a href=https://suzukiiichiro.github.io/sitemap/><span>サイトマップ</span>
</a>
</li><li>
<a href=https://suzukiiichiro.github.io/ranking/><span>PVランキング</span>
</a>
</li><li>
<a href=https://suzukiiichiro.github.io/archives/><span>アーカイブ</span>
</a>
</li><li>
<a href=https://suzukiiichiro.github.io/privacy/><span>プライバシーポリシー</span>
</a>
</li><li>
<a href=https://suzukiiichiro.github.io/search/><span>サイト内検索</span>
</a>
</li></ol>
</nav>
</div>
</div>
<button type=button id=dark-mode-toggle aria-label=画面の明るさ切り替え><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24"><path d="M3.55 18.54l1.41 1.41 1.8-1.79-1.42-1.42M11 22.45c.32.0 2 0 2 0V19.5H11m1-14a6 6 0 00-6 6 6 6 0 006 6 6 6 0 006-6c0-3.32-2.69-6-6-6m8 7h3v-2H20m-2.76 7.66 1.8 1.79 1.41-1.41-1.79-1.8M20.45 4.46 19.04 3.05l-1.8 1.79 1.42 1.42M13 .55H11V3.5h2m-9 7H1v2H4M6.76 4.84 4.96 3.05 3.55 4.46l1.79 1.8L6.76 4.84z"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="#fff" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M17.75 4.09 15.22 6.03 16.13 9.09 13.5 7.28 10.87 9.09l.91-3.06L9.25 4.09 12.44 4 13.5 1l1.06 3L17.75 4.09M21.25 11l-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11 17.81 10.95 18.5 9 19.19 10.95 21.25 11m-2.28 4.95C19.8 15.87 20.69 17.05 20.16 17.8 19.84 18.25 19.5 18.67 19.08 19.07 15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24.0-14.14C5.34 4.53 5.76 4.17 6.21 3.85c.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02 2.19 2.2 5.15 3.16 8.02 2.89m-1.64 2.02c-2.83-.16-5.63-1.33-7.8-3.47-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98C9.37 20.67 14.19 20.78 17.33 17.97z"/></svg>
</button>
</div>
<main class="main full-width">
<nav class=breadcrumb-area>
<ol class=breadcrumb>
<li><a class=breadcrumb-item href=https://suzukiiichiro.github.io/>NLP</a>
<li><a class=breadcrumb-item href=https://suzukiiichiro.github.io/posts/>Posts</a>
<li><span class=breadcrumb-item>Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化</span>
</ol>
</nav>
<article class="has-image main-article">
<div class="article-details arcile-single">
<header class=article-header>
<div class=article-category>
<a href=https://suzukiiichiro.github.io/categories/programming/>
プログラミング
</a>
</div>
<div class=article-info>
<span class="article-time--item article-time--author"><span class=icon style=background-image:url(https://github.com/suzukiiichiro.png)></span><span class=name><a href=https://suzukiiichiro.github.io/authors/suzuki/>suzukiiichiro</a></span>
</span>
<time class="article-time--item article-time--published">2025.10.27</time>
<time class="article-time--item article-time--reading">
読了時間: 51分
</time>
</div>
</header>
<h1 class=article-title>
Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化
</h1>
</div>
<div class=article-footer>
<section class=article-tags>
<a href=https://suzukiiichiro.github.io/tags/n-queens/>N-Queens</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%82%A8%E3%82%A4%E3%83%88%E3%82%AF%E3%82%A4%E3%83%BC%E3%83%B3/>エイト・クイーン</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/>アルゴリズム</a>
<a href=https://suzukiiichiro.github.io/tags/%E9%88%B4%E6%9C%A8%E7%B6%AD%E4%B8%80%E9%83%8E/>鈴木維一郎</a>
<a href=https://suzukiiichiro.github.io/tags/python/>python</a>
<a href=https://suzukiiichiro.github.io/tags/codon/>codon</a>
</section>
</div>
<aside class="widget archives tableOfContents">
<h2 class="widget-title section-title">目次<button type=buton id=btn-closeTOC onclick=custom.toggleTOC(event)></button></h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#ｎクイーン問題-過去記事アーカイブ>Ｎクイーン問題 過去記事アーカイブ</a></li>
</ol>
<ol>
<li><a href=#gpu-実行例>GPU 実行例</a></li>
<li><a href=#codon-実行aws-m416xlarge--1>Codon 実行（AWS m4.16xlarge × 1）</a></li>
<li><a href=#実行方法>実行方法</a></li>
<li><a href=#参考リンク>参考リンク</a></li>
</ol>
<ol>
<li><a href=#主要コンセプト>主要コンセプト</a></li>
<li><a href=#使い方>使い方</a></li>
<li><a href=#実装上の注意>実装上の注意</a></li>
<li><a href=#参考コード断片>参考コード断片</a></li>
<li><a href=#レビューの要点コード引用付き>レビューの要点（コード引用付き）</a>
<ol>
<li><a href=#n-bit-正規化の徹底>N-bit 正規化の徹底</a></li>
<li><a href=#状態キャッシュの軽量化>状態キャッシュの軽量化</a></li>
<li><a href=#jasmin-正規化>Jasmin 正規化</a></li>
<li><a href=#回転重複の即時排除>回転重複の即時排除</a></li>
<li><a href=#sq-系の見通し>SQ 系の見通し</a></li>
<li><a href=#io-キャッシュの堅牢化>I/O キャッシュの堅牢化</a></li>
</ol>
</li>
<li><a href=#大規模計測ログaws--cuda>大規模計測ログ（AWS / CUDA）</a></li>
</ol>
<ol>
<li><a href=#-opt-08--部分盤面サブ問題キャッシュ>✅ Opt-08 — 部分盤面サブ問題キャッシュ</a></li>
<li><a href=#-opt-09--訪問済みtransposition--visited>✅ Opt-09 — 訪問済み（transposition / visited）</a></li>
<li><a href=#-opt-10--jasmin-正規化キャッシュ>✅ Opt-10 — Jasmin 正規化キャッシュ</a></li>
<li><a href=#-opt-11--星座コンステレーション重複排除>✅ Opt-11 — 星座（コンステレーション）重複排除</a></li>
<li><a href=#-opt-12--永続キャッシュ現状無効化>✅ Opt-12 — 永続キャッシュ（現状無効化）</a></li>
<li><a href=#-opt-13--部分盤面キャッシュtupledict>✅ Opt-13 — 部分盤面キャッシュ（tuple→dict）</a></li>
<li><a href=#-opt-14--星座の重複排除署名>✅ Opt-14 — 星座の重複排除（署名）</a></li>
<li><a href=#-opt-15--jasmin-メモ化>✅ Opt-15 — Jasmin メモ化</a></li>
<li><a href=#-opt-16--訪問済み状態の仕込みzobriststatehashstatekey>✅ Opt-16 — 訪問済み状態の仕込み（Zobrist/StateHash/StateKey）</a></li>
<li><a href=#-opt-17--星座リストの外部キャッシュtxtbin>✅ Opt-17 — 星座リストの外部キャッシュ（TXT/BIN）</a></li>
<li><a href=#-opt-18--サブ星座生成の-tuple-キー化>✅ Opt-18 — サブ星座生成の tuple キー化</a></li>
<li><a href=#-opt-19--星座自体の集合管理>✅ Opt-19 — 星座自体の集合管理</a></li>
<li><a href=#-opt-20--jasmin-変換のキャッシュ化>✅ Opt-20 — Jasmin 変換のキャッシュ化</a></li>
<li><a href=#-opt-21--180重複チェックの二重化整理>✅ Opt-21 — 180°重複チェックの二重化整理</a></li>
<li><a href=#-opt-22--visited-の粒度星座ごとに新規-set>✅ Opt-22 — visited の粒度（星座ごとに新規 set）</a></li>
<li><a href=#-opt-23--ビット演算のインライン化と共有マスク>✅ Opt-23 — ビット演算のインライン化と共有マスク</a></li>
<li><a href=#-opt-24--先読み空き-の条件最適化>✅ Opt-24 — “先読み空き” の条件最適化</a></li>
<li><a href=#対応不要非対応現設計での方針>対応不要／非対応（現設計での方針）</a>
<ol>
<li><a href=#-1行目以外の部分対称除去途中-canonical>❎ 1行目以外の<strong>部分対称除去</strong>（途中 canonical）</a></li>
<li><a href=#-軽量-is_canonical途中盤面>❎ 軽量 <code>is_canonical()</code>（途中盤面）</a></li>
<li><a href=#-マクロチェス局所パターン>❎ マクロチェス（局所パターン）</a></li>
</ol>
</li>
<li><a href=#ソースコード-1>ソースコード</a></li>
<li><a href=#-関連リンク>📚 関連リンク</a></li>
<li><a href=#ｎクイーン問題-過去記事アーカイブ-1>Ｎクイーン問題 過去記事アーカイブ</a></li>
<li><a href=#書籍の紹介>書籍の紹介</a></li>
</ol>
</nav>
</div>
</aside>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-8689199204567424 data-ad-slot=7088000027></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script>
<div class=article-content>
<p><figure class=gallery-image style=flex-grow:132;flex-basis:318px>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess.jpg data-size=1029x776>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess.jpg width=1029 height=776 loading=lazy alt="Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化の画像">
</a>
</a>
</figure></p>
<p><figure class=gallery-image style=flex-grow:398;flex-basis:955px>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/codon.png data-size=1864x468>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/codon.png width=1864 height=468 loading=lazy alt="Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化の画像">
</a>
</a>
</figure></p>
<h1 id=ソースコード>ソースコード</h1>
<p>今回の連載 python/codonのソースコードディレクトリはこちら<br>
<a class=link href=https://github.com/suzukiiichiro/N-Queens/tree/master/13Bit_codon target=_blank rel=noopener>https://github.com/suzukiiichiro/N-Queens/tree/master/13Bit_codon</a></p>
<h2 id=ｎクイーン問題-過去記事アーカイブ>Ｎクイーン問題 過去記事アーカイブ</h2>
<p>【過去記事アーカイブ】Ｎクイーン問題 過去記事一覧<br>
<a class=link href="https://suzukiiichiro.github.io/search/?keyword=" target=_blank rel=noopener>https://suzukiiichiro.github.io/search/?keyword=</a>Ｎクイーン問題<br>
【Github】エイト・クイーンのソース置き場 BashもJavaもPythonも！<br>
<a class=link href=https://github.com/suzukiiichiro/N-Queens target=_blank rel=noopener>https://github.com/suzukiiichiro/N-Queens</a></p>
<hr>
<h1 id=pythoncodon-ｎクイーン-コンステレーション版-キャッシュ最適化２>Python/codon Ｎクイーン コンステレーション版 キャッシュ最適化２</h1>
<pre tabindex=0><code>   ,     #_
   ~\_  ####_        N-Queens
  ~~  \_#####\       https://suzukiiichiro.github.io/
  ~~     \###|       N-Queens for github
  ~~       \#/ ___   https://github.com/suzukiiichiro/N-Queens
   ~~       V~' '-&gt;
    ~~~         /
      ~~._.   _/
         _/ _/
       _/m/'
</code></pre><p>結論から言えば <strong>codon for python 17Py_</strong> は <strong>GPU/CUDA 10Bit_CUDA/01CUDA_Bit_Symmetry.cu</strong> と同等の速度で動作します。</p>
<h2 id=gpu-実行例>GPU 実行例</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>$ nvcc -O3 -arch<span class=o>=</span>sm_61 -m64 -ptx -prec-div<span class=o>=</span><span class=nb>false</span> 04CUDA_Symmetry_BitBoard.cu <span class=o>&amp;&amp;</span> <span class=nv>POCL_DEBUG</span><span class=o>=</span>all ./a.out -n <span class=p>;</span>
対称解除法 GPUビットボード
20:      <span class=m>39029188884</span>       <span class=m>4878666808</span>     000:00:02:02.52
21:     <span class=m>314666222712</span>      <span class=m>39333324973</span>     000:00:18:46.52
22:    <span class=m>2691008701644</span>     <span class=m>336376244042</span>     000:03:00:22.54
23:   <span class=m>24233937684440</span>    <span class=m>3029242658210</span>     001:06:03:49.29
</code></pre></div><h2 id=codon-実行aws-m416xlarge--1>Codon 実行（AWS m4.16xlarge × 1）</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>amazon AWS m4.16xlarge x <span class=m>1</span>
$ codon build -release 15Py_constellations_optimize_codon.py <span class=o>&amp;&amp;</span> ./15Py_constellations_optimize_codon
20:      <span class=m>39029188884</span>                <span class=m>0</span>          0:02:52.430
21:     <span class=m>314666222712</span>                <span class=m>0</span>          0:24:25.554
22:    <span class=m>2691008701644</span>                <span class=m>0</span>          3:29:33.971
23:   <span class=m>24233937684440</span>                <span class=m>0</span>   <span class=m>1</span> day, 8:12:58.977
</code></pre></div><h2 id=実行方法>実行方法</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=c1># python（並列処理を除けば動作）</span>
$ python &lt;filename.py&gt;

<span class=c1># codon（ビルドせずに実行）</span>
$ codon run &lt;filename.py&gt;

<span class=c1># codon（ビルドしてC/C++ネイティブで高速実行）</span>
$ codon build -release &lt; filename.py&gt; <span class=o>&amp;&amp;</span> ./&lt;filename&gt;
</code></pre></div><h2 id=参考リンク>参考リンク</h2>
<ul>
<li>Ｎクイーン問題 過去記事一覧<br>
<a class=link href="https://suzukiiichiro.github.io/search/?keyword=%ef%bc%ae%e3%82%af%e3%82%a4%e3%83%bc%e3%83%b3%e5%95%8f%e9%a1%8c" target=_blank rel=noopener>https://suzukiiichiro.github.io/search/?keyword=Ｎクイーン問題</a></li>
<li>エイト・クイーンのプログラムアーカイブ（Bash、Lua、C、Java、Python、CUDA）<br>
<a class=link href=https://github.com/suzukiiichiro/N-Queens target=_blank rel=noopener>https://github.com/suzukiiichiro/N-Queens</a></li>
</ul>
<hr>
<h1 id=n-queens-constellations-solver-bitboard--zobrist--分割探索>N-Queens Constellations Solver (Bitboard + Zobrist + 分割探索)</h1>
<p>本プログラムは N-Queens を「開始コンステレーション（部分盤面）」に分割し、各コンステレーションを高速に探索する実装です。</p>
<h2 id=主要コンセプト>主要コンセプト</h2>
<ul>
<li>
<p><strong>ビットボード</strong>: 左/右対角線・列をビットで管理<br>
例) <code>set_pre_queens()</code> 内の <code>free</code> 計算:<br>
<code>free = ~(ld | rd | col | (LD>>(N-1-row)) | (RD&lt;&lt;(N-1-row))) & ((1&lt;&lt;N)-1)</code></p>
</li>
<li>
<p><strong>開始コンステレーション列挙</strong>: <code>gen_constellations()</code></p>
<ul>
<li>位置 <code>(i,j,k,l)</code> を <strong>5bit パック (<code>to_ijkl</code>)</strong> で signature 化</li>
<li>回転・ミラー対称除去（<code>check_rotations</code> / <code>jasmin</code>）</li>
</ul>
</li>
<li>
<p><strong>標準形（Jasmin 正規化）</strong>: <code>jasmin()</code></p>
<ul>
<li><code>(i,j,k,l)</code> を回転・ミラーで正規形へ写像し、重複を圧縮</li>
</ul>
</li>
<li>
<p><strong>Zobrist ハッシュ</strong>: <code>zobrist_hash()</code>, <code>_mix64()</code>, <code>_gen_list()</code>, <code>_init_zobrist()</code></p>
<ul>
<li>盤面状態の 64bit ハッシュで高速な探索済み検出に利用</li>
<li>実運用では <code>state_hash()</code> の O(1) 簡易ハッシュも併用</li>
</ul>
</li>
<li>
<p><strong>サブコンステレーション生成キャッシュ</strong>: <code>set_pre_queens_cached()</code></p>
<ul>
<li><code>StateKey</code>（行/ビットボード/パラメタ）で生成済みをスキップ</li>
</ul>
</li>
<li>
<p><strong>解探索分岐</strong>: <code>exec_solutions()</code> → <code>SQ...</code> 群</p>
<ul>
<li>コーナー/境界/特殊行（j, k, l）に応じて最適な再帰ソルバを選択</li>
<li><code>symmetry()</code> で 90/180/ミラーの重複補正（<strong>2/4/8倍</strong>）</li>
</ul>
</li>
</ul>
<h2 id=使い方>使い方</h2>
<ul>
<li><code>NQueens15_constellations().main()</code> で <strong>N=5..19</strong> を走査</li>
<li>事前配置数 <code>preset_queens</code> は <code>main()</code> の <code>preset_queens</code> で設定</li>
</ul>
<h2 id=実装上の注意>実装上の注意</h2>
<ul>
<li><strong>64bit マスク <code>MASK64</code></strong> で Zobrist 値の範囲を明確化</li>
<li><strong>N-bit マスク <code>((1&lt;&lt;N)-1)</code> を都度適用</strong>（符号や上位ビット汚染を防ぐ）</li>
<li><code>pickle</code> の代わりに <strong>TXT/BIN キャッシュ</strong>もサポート（Codon 互換考慮）</li>
<li><code>@par</code> は並列化の目印コメント（実行環境により扱いを調整）</li>
</ul>
<h2 id=参考コード断片>参考コード断片</h2>
<ul>
<li>5bit パック: <code>to_ijkl(i,j,k,l)</code></li>
<li>回転90度: <code>rot90(ijkl, N)</code></li>
<li>垂直ミラー: <code>mirvert(ijkl, N)</code></li>
<li>標準形: <code>jasmin(ijkl, N)</code></li>
<li>開始列挙: <code>gen_constellations(...)</code></li>
<li>探索本体: <code>exec_solutions(...) → SQ...()</code></li>
</ul>
<hr>
<h2 id=レビューの要点コード引用付き>レビューの要点（コード引用付き）</h2>
<h3 id=n-bit-正規化の徹底>N-bit 正規化の徹底</h3>
<p><code>zobrist_hash()</code> 冒頭で<br>
<code>ld &= mask; rd &= mask; col &= mask; LD &= mask; RD &= mask</code><br>
としており、負数や上位ビット汚染を確実に排除（<strong>重要</strong>）。</p>
<h3 id=状態キャッシュの軽量化>状態キャッシュの軽量化</h3>
<p><code>visited</code> に <code>state_hash()</code> の単一 <code>int</code> を入れる戦略は、<code>StateKey</code> タプルより省メモリ・高速。厳密検証では <code>zobrist_hash()</code> との <strong>A/B 実験</strong>がおすすめ。</p>
<h3 id=jasmin-正規化>Jasmin 正規化</h3>
<p>端からの距離基準で 90°回転を繰り返し、最後にミラー判定。代表圧縮が明快。</p>
<h3 id=回転重複の即時排除>回転重複の即時排除</h3>
<p><code>check_rotations()</code> を <code>gen_constellations()</code> の列挙内に内挿し、集合サイズ増加を初期で抑制。</p>
<h3 id=sq-系の見通し>SQ 系の見通し</h3>
<p>先読みを <code>_extra_block_for_row()</code> / <code>_should_go_plus1()</code> で関数化。<code>row==mark1</code> や <code>&lt;&lt;2 / >>2</code> の固定行通過最適化も良好。</p>
<h3 id=io-キャッシュの堅牢化>I/O キャッシュの堅牢化</h3>
<p>TXT/BIN 両対応、<code>validate_*()</code> と <code>try/except</code> を絡めた自己修復ロード。BIN は 16 バイト境界のサイズ検査で破損検出。</p>
<h2 id=大規模計測ログaws--cuda>大規模計測ログ（AWS / CUDA）</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>amazon AWS m4.16xlarge x <span class=m>1</span>
$ codon build -release 15Py_constellations_optimize_codon.py <span class=o>&amp;&amp;</span> ./15Py_constellations_optimize_codon
 N:            Total       Unique        hh:mm:ss.ms
 5:               <span class=m>10</span>            <span class=m>0</span>         0:00:00.000
 6:                <span class=m>4</span>            <span class=m>0</span>         0:00:00.079
 7:               <span class=m>40</span>            <span class=m>0</span>         0:00:00.001
 8:               <span class=m>92</span>            <span class=m>0</span>         0:00:00.001
 9:              <span class=m>352</span>            <span class=m>0</span>         0:00:00.001
10:              <span class=m>724</span>            <span class=m>0</span>         0:00:00.002
11:             <span class=m>2680</span>            <span class=m>0</span>         0:00:00.102
12:            <span class=m>14200</span>            <span class=m>0</span>         0:00:00.002
13:            <span class=m>73712</span>            <span class=m>0</span>         0:00:00.005
14:           <span class=m>365596</span>            <span class=m>0</span>         0:00:00.011
15:          <span class=m>2279184</span>            <span class=m>0</span>         0:00:00.035
16:         <span class=m>14772512</span>            <span class=m>0</span>         0:00:00.078
17:         <span class=m>95815104</span>            <span class=m>0</span>         0:00:00.436
18:        <span class=m>666090624</span>            <span class=m>0</span>         0:00:02.961
19:       <span class=m>4968057848</span>            <span class=m>0</span>         0:00:22.049
20:      <span class=m>39029188884</span>            <span class=m>0</span>         0:02:52.430
21:     <span class=m>314666222712</span>            <span class=m>0</span>         0:24:25.554
22:    <span class=m>2691008701644</span>            <span class=m>0</span>         3:29:33.971
23:   <span class=m>24233937684440</span>            <span class=m>0</span>  <span class=m>1</span>  day,8:12:58.977

top-10:29:32 up <span class=m>1</span> day,16:13, <span class=m>4</span> users, load average: 64.39,64.21,64.12
Tasks: <span class=m>563</span> total,  <span class=m>2</span> running,561 sleeping,  <span class=m>0</span> stopped,  <span class=m>0</span> zombie
%Cpu<span class=o>(</span>s<span class=o>)</span>:100.0 us, 0.0 sy, 0.0 ni, 0.0 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st
MiB Mem : 257899.4 total,256193.4 free,  1225.5 used,   480.5 buff/cache
MiB Swap:      0.0 total,     0.0 free,     0.0 used. 255314.6 avail Mem
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
   <span class=m>5634</span> suzuki    <span class=m>20</span>   <span class=m>0</span>   13.4g  <span class=m>70056</span>   <span class=m>7384</span> R  <span class=m>6399</span>   0.0 148411:55 15Py_constellat
</code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>GPU/CUDA
10Bit_CUDA/01CUDA_Bit_Symmetry.cu
19:       <span class=m>4968057848</span>        <span class=m>621012754</span>     000:00:00:13.80
20:      <span class=m>39029188884</span>       <span class=m>4878666808</span>     000:00:02:02.52
21:     <span class=m>314666222712</span>      <span class=m>39333324973</span>     000:00:18:46.52
22:    <span class=m>2691008701644</span>     <span class=m>336376244042</span>     000:03:00:22.54
23:   <span class=m>24233937684440</span>    <span class=m>3029242658210</span>     001:06:03:49.29
24:  <span class=m>227514171973736</span>   <span class=m>28439272956934</span>     012:23:38:21.02
25: <span class=m>2207893435808352</span>  <span class=m>275986683743434</span>     140:07:39:29.96
</code></pre></div><hr>
<h1 id=キャッシュ最適化チェックリストopt-08--opt-24>キャッシュ最適化チェックリスト（Opt-08 〜 Opt-24）</h1>
<h2 id=-opt-08--部分盤面サブ問題キャッシュ>✅ Opt-08 — 部分盤面サブ問題キャッシュ</h2>
<ul>
<li><strong>場所</strong>: <code>set_pre_queens_cached(...)</code></li>
<li><strong>キー</strong>: <code>(ld,rd,col,k,l,row,queens,LD,RD,N,preset_queens)</code></li>
<li><strong>役割</strong>: 同一部分状態のサブ問題展開を <strong>一度だけ</strong> にする。</li>
</ul>
<h2 id=-opt-09--訪問済みtransposition--visited>✅ Opt-09 — 訪問済み（transposition / visited）</h2>
<ul>
<li><strong>場所</strong>: <code>set_pre_queens(...)</code></li>
<li><strong>構造</strong>: <code>visited</code>（<code>Set</code>：タプル or 64bit圧縮キー）</li>
<li><strong>役割</strong>: 再帰木横断で同状態再訪を防ぐ。</li>
</ul>
<h2 id=-opt-10--jasmin-正規化キャッシュ>✅ Opt-10 — Jasmin 正規化キャッシュ</h2>
<ul>
<li><strong>場所</strong>: <code>get_jasmin(c,N)</code> / <code>jasmin_cache: Dict[Tuple[int,int],int]</code></li>
<li><strong>役割</strong>: 回転・鏡映の正規化結果をメモ化。</li>
</ul>
<h2 id=-opt-11--星座コンステレーション重複排除>✅ Opt-11 — 星座（コンステレーション）重複排除</h2>
<ul>
<li><strong>場所</strong>: <code>constellation_signatures: Set[Tuple[int,int,int,int,int,int]]</code></li>
<li><strong>役割</strong>: 生成済み部分盤面を一意に保つ署名セット。</li>
</ul>
<h2 id=-opt-12--永続キャッシュ現状無効化>✅ Opt-12 — 永続キャッシュ（現状無効化）</h2>
<ul>
<li><strong>場所</strong>: <code>load_constellations(...) / pickle</code>（Codon 非互換のため停止）</li>
<li><strong>インスタンス内キャッシュ</strong>（辞書／集合）を運用。</li>
</ul>
<h2 id=-opt-13--部分盤面キャッシュtupledict>✅ Opt-13 — 部分盤面キャッシュ（tuple→dict）</h2>
<ul>
<li>上記キーで <strong>再入防止</strong>。指数的重複をカット。</li>
</ul>
<h2 id=-opt-14--星座の重複排除署名>✅ Opt-14 — 星座の重複排除（署名）</h2>
<ul>
<li><strong>署名</strong>: <code>(ld,rd,col,k,l,row)</code></li>
<li>未出のみ <code>constellations.append(...)</code> ＆ <code>counter[0]+=1</code></li>
</ul>
<h2 id=-opt-15--jasmin-メモ化>✅ Opt-15 — Jasmin メモ化</h2>
<ul>
<li><code>self.jasmin_cache[(c,N)]</code> に結果を保存。</li>
</ul>
<h2 id=-opt-16--訪問済み状態の仕込みzobriststatehashstatekey>✅ Opt-16 — 訪問済み状態の仕込み（Zobrist/StateHash/StateKey）</h2>
<ul>
<li><strong>推奨</strong>: <code>state_hash</code>（O(1））を星座ごと <code>visited</code> に採用。</li>
<li><strong>備考</strong>: <code>zobrist_hash</code> 版は A/B 検証向き。</li>
</ul>
<h2 id=-opt-17--星座リストの外部キャッシュtxtbin>✅ Opt-17 — 星座リストの外部キャッシュ（TXT/BIN）</h2>
<ul>
<li>破損チェック <code>validate_*</code> で安全にロード/保存。</li>
</ul>
<h2 id=-opt-18--サブ星座生成の-tuple-キー化>✅ Opt-18 — サブ星座生成の tuple キー化</h2>
<ul>
<li><code>set_pre_queens_cached(...)</code> を <strong>初回から</strong> 使用。</li>
</ul>
<h2 id=-opt-19--星座自体の集合管理>✅ Opt-19 — 星座自体の集合管理</h2>
<ul>
<li><code>self.constellation_signatures</code> で <strong>再追加防止</strong>。</li>
</ul>
<h2 id=-opt-20--jasmin-変換のキャッシュ化>✅ Opt-20 — Jasmin 変換のキャッシュ化</h2>
<ul>
<li><code>get_jasmin(c,N)</code> を <strong>必ず経由</strong>。</li>
</ul>
<h2 id=-opt-21--180重複チェックの二重化整理>✅ Opt-21 — 180°重複チェックの二重化整理</h2>
<ul>
<li>奇数 N の中央列ブロックは <code>check_rotations(...)</code> のみで OK<br>
（<code>rot180_in_set(...)</code> 併用は冗長）。</li>
</ul>
<h2 id=-opt-22--visited-の粒度星座ごとに新規-set>✅ Opt-22 — visited の粒度（星座ごとに新規 set）</h2>
<ul>
<li>メモリ増大を回避。キー短縮（<code>N</code>/<code>preset_queens</code> 除外）も任意。</li>
</ul>
<h2 id=-opt-23--ビット演算のインライン化と共有マスク>✅ Opt-23 — ビット演算のインライン化と共有マスク</h2>
<ul>
<li><code>bit = x & -x</code>／<code>board_mask & ~blocked</code>／<code>blocked</code> の再利用で分岐軽量化。</li>
<li><code>symmetry(ijkl,N)</code> の小さな <strong>結果メモ化</strong>も効果的。</li>
</ul>
<h2 id=-opt-24--先読み空き-の条件最適化>✅ Opt-24 — “先読み空き” の条件最適化</h2>
<ul>
<li><code>if next_free and ((row >= endmark-1) or _has_future_space(...)):</code><br>
ゴール直前は先読み不要、以外は軽量チェックだけ実行。</li>
</ul>
<hr>
<h2 id=対応不要非対応現設計での方針>対応不要／非対応（現設計での方針）</h2>
<h3 id=-1行目以外の部分対称除去途中-canonical>❎ 1行目以外の<strong>部分対称除去</strong>（途中 canonical）</h3>
<ul>
<li>現在の <strong>bitmask-only</strong> 設計（<code>ld/rd/col + row/k/l</code>）では履歴がないため困難。</li>
<li>既存の <strong>初手代表化 + 係数(2/4/8)</strong> と整合を保つため <strong>導入しない方針</strong>が安全。</li>
</ul>
<h3 id=-軽量-is_canonical途中盤面>❎ 軽量 <code>is_canonical()</code>（途中盤面）</h3>
<ul>
<li>行→列履歴 <code>board[row]=col</code> を常時保持する設計に改変しない限り効果が薄い。</li>
<li>既存の対称性除去とキャッシュで十分高速。</li>
</ul>
<h3 id=-マクロチェス局所パターン>❎ マクロチェス（局所パターン）</h3>
<ul>
<li>直近行の列履歴が無い現方式では一般化が難しい。</li>
<li>代替として <em><em>SQ</em> の分岐最適化</em>*が既に十分に効いている。</li>
</ul>
<hr>
<h2 id=ソースコード-1>ソースコード</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=ch>#!/usr/bin/env python3</span>

<span class=c1># -*- coding: utf-8 -*-</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>Python/codon Ｎクイーン コンステレーション版 キャッシュ最適化２
</span><span class=s2>
</span><span class=s2>
</span><span class=s2>   ,     #_
</span><span class=s2>   ~\_  ####_        N-Queens
</span><span class=s2>  ~~  \_#####\       https://suzukiiichiro.github.io/
</span><span class=s2>  ~~     \###|       N-Queens for github
</span><span class=s2>  ~~       \#/ ___   https://github.com/suzukiiichiro/N-Queens
</span><span class=s2>   ~~       V~&#39; &#39;-&gt;
</span><span class=s2>    ~~~         /
</span><span class=s2>      ~~._.   _/
</span><span class=s2>         _/ _/
</span><span class=s2>       _/m/&#39;
</span><span class=s2>
</span><span class=s2>
</span><span class=s2>結論から言えば codon for python 17Py_ は GPU/CUDA 10Bit_CUDA/01CUDA_Bit_Symmetry.cu と同等の速度で動作します。
</span><span class=s2>
</span><span class=s2> $ nvcc -O3 -arch=sm_61 -m64 -ptx -prec-div=false 04CUDA_Symmetry_BitBoard.cu &amp;&amp; POCL_DEBUG=all ./a.out -n ;
</span><span class=s2>対称解除法 GPUビットボード
</span><span class=s2>20:      39029188884       4878666808     000:00:02:02.52
</span><span class=s2>21:     314666222712      39333324973     000:00:18:46.52
</span><span class=s2>22:    2691008701644     336376244042     000:03:00:22.54
</span><span class=s2>23:   24233937684440    3029242658210     001:06:03:49.29
</span><span class=s2>
</span><span class=s2>amazon AWS m4.16xlarge x 1
</span><span class=s2>$ codon build -release 15Py_constellations_optimize_codon.py &amp;&amp; ./15Py_constellations_optimize_codon
</span><span class=s2>20:      39029188884                0          0:02:52.430
</span><span class=s2>21:     314666222712                0          0:24:25.554
</span><span class=s2>22:    2691008701644                0          3:29:33.971
</span><span class=s2>23:   24233937684440                0   1 day, 8:12:58.977
</span><span class=s2>
</span><span class=s2>python 15py_ 以降の並列処理を除けば python でも動作します
</span><span class=s2>$ python &lt;filename.py&gt;
</span><span class=s2>
</span><span class=s2>codon for python ビルドしない実行方法
</span><span class=s2>$ codon run &lt;filename.py&gt;
</span><span class=s2>
</span><span class=s2>codon build for python ビルドすればC/C++ネイティブに変換し高速に実行します
</span><span class=s2>$ codon build -release &lt; filename.py&gt; &amp;&amp; ./&lt;filename&gt;
</span><span class=s2>
</span><span class=s2>
</span><span class=s2>詳細はこちら。
</span><span class=s2>【参考リンク】Ｎクイーン問題 過去記事一覧はこちらから
</span><span class=s2>https://suzukiiichiro.github.io/search/?keyword=Ｎクイーン問題
</span><span class=s2>
</span><span class=s2>エイト・クイーンのプログラムアーカイブ
</span><span class=s2>Bash、Lua、C、Java、Python、CUDAまで！
</span><span class=s2>https://github.com/suzukiiichiro/N-Queens
</span><span class=s2>&#34;&#34;&#34;</span>


<span class=s2>&#34;&#34;&#34;&#34;
</span><span class=s2> N-Queens Constellations Solver (Bitboard + Zobrist + 分割探索)
</span><span class=s2>
</span><span class=s2> 本プログラムは N-Queens を「開始コンステレーション（部分盤面）」に
</span><span class=s2> 分割し、各コンステレーションを高速に探索する実装です。
</span><span class=s2>
</span><span class=s2> 主要コンセプト
</span><span class=s2> - ビットボード: 左/右対角線・列をビットで管理
</span><span class=s2>     例) set_pre_queens() 内の free 計算:
</span><span class=s2>         free = ~(ld | rd | col | (LD&gt;&gt;(N-1-row)) | (RD&lt;&lt;(N-1-row))) &amp; ((1&lt;&lt;N)-1)
</span><span class=s2> - 開始コンステレーション列挙: gen_constellations()
</span><span class=s2>     - 位置 (i,j,k,l) を 5bit パック (to_ijkl) で signature 化
</span><span class=s2>     - 回転・ミラー対称除去 (check_rotations / jasmin)
</span><span class=s2> - 標準形（Jasmin正規化）: jasmin()
</span><span class=s2>     - (i,j,k,l) を回転・ミラーで正規形へ写像し、重複を圧縮
</span><span class=s2> - Zobrist ハッシュ: zobrist_hash(), _mix64(), _gen_list(), _init_zobrist()
</span><span class=s2>     - 盤面状態の64bitハッシュを計算し、高速な探索済み検出に利用
</span><span class=s2>     - 実運用では state_hash() の O(1) 簡易ハッシュも併用
</span><span class=s2> - サブコンステレーション生成キャッシュ: set_pre_queens_cached()
</span><span class=s2>     - StateKey（行/ビットボード/パラメタ）で生成済みをスキップ
</span><span class=s2> - 解探索分岐: exec_solutions() → SQ... 群
</span><span class=s2>     - コーナー/境界/特殊行（j, k, l）に応じて最適な再帰ソルバを選択
</span><span class=s2>     - symmetry() で 90/180/ミラーの重複補正(2/4/8倍)
</span><span class=s2>
</span><span class=s2> 使い方
</span><span class=s2> - NQueens15_constellations().main() で N=5..19 を走査
</span><span class=s2> - 事前配置数 preset_queens は main() の preset_queens で設定
</span><span class=s2>
</span><span class=s2> 実装上の注意
</span><span class=s2> - 64bit マスク MASK64 で Zobrist 値の範囲を明確化
</span><span class=s2> - N に応じた N-bit マスク ((1&lt;&lt;N)-1) を都度適用（符号や上位ビット汚染を防ぐ）
</span><span class=s2> - pickle の代わりに TXT/BIN キャッシュもサポート（Codon 互換考慮）
</span><span class=s2> - @par とある行は並列化の目印コメント（実行環境により扱いを調整）
</span><span class=s2>
</span><span class=s2> 参考コード断片
</span><span class=s2> - 5bit パック: to_ijkl(i,j,k,l)
</span><span class=s2> - 回転90度:    rot90(ijkl, N)
</span><span class=s2> - 垂直ミラー:  mirvert(ijkl, N)
</span><span class=s2> - 標準形:      jasmin(ijkl, N)
</span><span class=s2> - 開始列挙:    gen_constellations(...)
</span><span class=s2> - 探索本体:    exec_solutions(...) → SQ...()
</span><span class=s2>
</span><span class=s2>
</span><span class=s2>レビューの要点（コード中からの引用付き）
</span><span class=s2>
</span><span class=s2>N-bit 正規化の徹底
</span><span class=s2>zobrist_hash() 冒頭で
</span><span class=s2>ld &amp;= mask; rd &amp;= mask; col &amp;= mask; LD &amp;= mask; RD &amp;= mask
</span><span class=s2>としており、負数や上位ビット汚染を確実に排除できています（👍とても重要）。
</span><span class=s2>
</span><span class=s2>状態キャッシュの軽量化
</span><span class=s2>visited に state_hash() の単一 int を入れる戦略は、
</span><span class=s2>「StateKey タプル」より圧倒的に省メモリ・速い一方で、衝突の懸念は残ります。
</span><span class=s2>N≤17 という範囲なら実害はまず出ない設計ですが、厳密性を求める検証 runでは
</span><span class=s2>一時的に zobrist_hash() を使って比較する A/B 実験がおすすめ。
</span><span class=s2>
</span><span class=s2>Jasmin 正規化
</span><span class=s2>jasmin() は “最も端に近い軸”を選んで 90°回転を繰り返し、最後にミラー判定する明快設計。
</span><span class=s2>ffmin(self.getj(ijkl), N-1-self.getj(ijkl)) のような端から距離の採用が効いています。
</span><span class=s2>
</span><span class=s2>回転重複の即時排除
</span><span class=s2>check_rotations() を gen_constellations() の列挙内に内挿しているため、
</span><span class=s2>集合のサイズ増加を初期で抑制できています。
</span><span class=s2>
</span><span class=s2>SQ 系の見通し
</span><span class=s2>次行先読みを _extra_block_for_row() / _should_go_plus1() の2段で関数化し、
</span><span class=s2>多数の SQ バリアントにまたがる可読性と再利用性を維持。
</span><span class=s2>row==mark1 や &lt;&lt;2 / &gt;&gt;2 の2行スキップなど“固定行の強制通過”最適化も良いです。
</span><span class=s2>
</span><span class=s2>I/O キャッシュの堅牢化
</span><span class=s2>TXT/BIN 両対応、validate_*() と try/except を絡めた自己修復的ロードは実運用で有益。
</span><span class=s2>BIN は 16 バイト境界のサイズ検査で破損検出しているのも OK。
</span><span class=s2>
</span><span class=s2>amazon AWS m4.16xlarge x 1
</span><span class=s2>$ codon build -release 15Py_constellations_optimize_codon.py &amp;&amp; ./15Py_constellations_optimize_codon
</span><span class=s2> N:            Total       Unique        hh:mm:ss.ms
</span><span class=s2> 5:               10            0         0:00:00.000
</span><span class=s2> 6:                4            0         0:00:00.079
</span><span class=s2> 7:               40            0         0:00:00.001
</span><span class=s2> 8:               92            0         0:00:00.001
</span><span class=s2> 9:              352            0         0:00:00.001
</span><span class=s2>10:              724            0         0:00:00.002
</span><span class=s2>11:             2680            0         0:00:00.102
</span><span class=s2>12:            14200            0         0:00:00.002
</span><span class=s2>13:            73712            0         0:00:00.005
</span><span class=s2>14:           365596            0         0:00:00.011
</span><span class=s2>15:          2279184            0         0:00:00.035
</span><span class=s2>16:         14772512            0         0:00:00.078
</span><span class=s2>17:         95815104            0         0:00:00.436
</span><span class=s2>18:        666090624            0         0:00:02.961
</span><span class=s2>19:       4968057848            0         0:00:22.049
</span><span class=s2>20:      39029188884            0         0:02:52.430
</span><span class=s2>21:     314666222712            0         0:24:25.554
</span><span class=s2>22:    2691008701644            0         3:29:33.971
</span><span class=s2>23:   24233937684440            0  1  day,8:12:58.977
</span><span class=s2>
</span><span class=s2>top-10:29:32 up 1 day,16:13, 4 users, load average: 64.39,64.21,64.12
</span><span class=s2>Tasks: 563 total,  2 running,561 sleeping,  0 stopped,  0 zombie
</span><span class=s2>%Cpu(s):100.0 us, 0.0 sy, 0.0 ni, 0.0 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st
</span><span class=s2>MiB Mem : 257899.4 total,256193.4 free,  1225.5 used,   480.5 buff/cache
</span><span class=s2>MiB Swap:      0.0 total,     0.0 free,     0.0 used. 255314.6 avail Mem
</span><span class=s2>    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
</span><span class=s2>   5634 suzuki    20   0   13.4g  70056   7384 R  6399   0.0 148411:55 15Py_constellat
</span><span class=s2>
</span><span class=s2>GPU/CUDA
</span><span class=s2>10Bit_CUDA/01CUDA_Bit_Symmetry.cu
</span><span class=s2>19:       4968057848        621012754     000:00:00:13.80
</span><span class=s2>20:      39029188884       4878666808     000:00:02:02.52
</span><span class=s2>21:     314666222712      39333324973     000:00:18:46.52
</span><span class=s2>22:    2691008701644     336376244042     000:03:00:22.54
</span><span class=s2>23:   24233937684440    3029242658210     001:06:03:49.29
</span><span class=s2>24:  227514171973736   28439272956934     012:23:38:21.02
</span><span class=s2>25: 2207893435808352  275986683743434     140:07:39:29.96
</span><span class=s2>&#34;&#34;&#34;</span>


<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-08]部分盤面サブ問題キャッシュ
</span><span class=s2>場所: set_pre_queens_cached(...)
</span><span class=s2>キー: key=(ld,rd,col,k,l,row,queens,LD,RD,N,preset_queens)
</span><span class=s2>値: subconst_cache[key]=True
</span><span class=s2>役割: 同じ部分状態でのサブ問題展開を一度だけにする（必ず再利用の方針に合致）。
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-09]訪問済み（transposition / visited）
</span><span class=s2>場所: set_pre_queens(...)
</span><span class=s2>データ構造: visited（Set：実装版ではタプル or 64bit相当の圧縮キー）
</span><span class=s2>役割: 再帰木を横断して同じ状態への再訪を防止。
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-10]Jasmin 正規化キャッシュ
</span><span class=s2>場所: get_jasmin(c,N) / jasmin_cache: Dict[Tuple[int,int],int]
</span><span class=s2>役割: 盤面正規化（回転・鏡映）結果をメモ化し、同一候補の重複計算を回避。
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-11]星座（コンステレーション）重複排除
</span><span class=s2>場所: constellation_signatures: Set[Tuple[int,int,int,int,int,int]]
</span><span class=s2>役割: 生成済み部分盤面（星座）を一意に保つための署名セット。
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-12]永続キャッシュ（現状は無効化中）
</span><span class=s2>場所: load_constellations(...) / pickle
</span><span class=s2>インスタンス内キャッシュ（辞書／集合）
</span><span class=s2>  __init__
</span><span class=s2>    self.subconst_cache: Dict[StateKey,bool]=</span><span class=si>{}</span><span class=s2> … サブコンステ生成の再入防止
</span><span class=s2>    self.constellation_signatures: Set[Tuple[int,int,int,int,int,int]]=set() … 星座の重複署名
</span><span class=s2>    self.jasmin_cache: Dict[Tuple[int,int],int]=</span><span class=si>{}</span><span class=s2> … get_jasmin()の結果メモ化
</span><span class=s2>    self.zobrist_tables: Dict[int,Dict[str,List[int]]]=</span><span class=si>{}</span><span class=s2> … Zobristテーブル（Nごと）
</span><span class=s2>
</span><span class=s2>✅[Opt-13]部分盤面のキャッシュ（tuple化→dict）
</span><span class=s2>  set_pre_queens_cached(...)
</span><span class=s2>    キー：(ld,rd,col,k,l,row,queens,LD,RD,N,preset_queens)
</span><span class=s2>    既出キーなら再帰呼び出しスキップ → 指数的重複カット
</span><span class=s2>
</span><span class=s2>✅[Opt-14]星座（コンステレーション）の重複排除
</span><span class=s2>  set_pre_queens(...) 内 if queens==preset_queens: ブロック
</span><span class=s2>    署名：(ld,rd,col,k,l,row) を self.constellation_signatures で判定し重複追加を抑制
</span><span class=s2>
</span><span class=s2>✅[Opt-15]Jasmin 正規化のメモ化
</span><span class=s2>  get_jasmin(c,N) → self.jasmin_cache[(c,N)]
</span><span class=s2>  何度も登場する起点パターンの再計算を回避
</span><span class=s2>
</span><span class=s2>✅[Opt-16]訪問済み状態（transposition/visited）の仕込み
</span><span class=s2>  gen_constellations(...) で visited: Set[StateKey]=set() を生成し
</span><span class=s2>  set_pre_queens(...) 冒頭で key: StateKey=(...) を visited に登録・参照
</span><span class=s2>  ※Zobrist版 zobrist_hash(...) も実装済（今はコメントアウトでトグル可）
</span><span class=s2>
</span><span class=s2>    # 状態ハッシュによる探索枝の枝刈り バックトラック系の冒頭に追加　やりすぎると解が合わない
</span><span class=s2>    #
</span><span class=s2>    # zobrist_hash
</span><span class=s2>    # 各ビットを見てテーブルから XOR するため O(N)（ld/rd/col/LD/RDそれぞれで最大 N 回）。
</span><span class=s2>    # とはいえ N≤17 なのでコストは小さめ。衝突耐性は高い。
</span><span class=s2>    # マスク漏れや負数の扱いを誤ると不一致が起きる点に注意（先ほどの&amp;((1&lt;&lt;N)-1) 修正で解決）。
</span><span class=s2>    # h:int=self.zobrist_hash(ld,rd,col,row,queens,k,l,LD,RD,N)
</span><span class=s2>    #
</span><span class=s2>    # state_hash
</span><span class=s2>    # その場で数個の ^ と&lt;&lt;を混ぜるだけの O(1) 計算。
</span><span class=s2>    # 生成されるキーも 単一の int なので、set/dict の操作が最速＆省メモリ。
</span><span class=s2>    # ただし理論上は衝突し得ます（実際はN≤17の範囲なら実害が出にくい設計にしていればOK）。
</span><span class=s2>    h:int=self.state_hash(ld,rd,col,row,queens,k,l,LD,RD,N)
</span><span class=s2>    if h in visited:
</span><span class=s2>        return
</span><span class=s2>    visited.add(h)
</span><span class=s2>    #
</span><span class=s2>    # StateKey（タプル）
</span><span class=s2>    # 11個の整数オブジェクトを束ねるため、オブジェクト生成・GC負荷・ハッシュ合成が最も重い。
</span><span class=s2>    # set の比較・保持も重く、メモリも一番食います。
</span><span class=s2>    # 衝突はほぼ心配ないものの、速度とメモリ効率は最下位。
</span><span class=s2>    # key: StateKey=(ld,rd,col,row,queens,k,l,LD,RD,N,preset_queens)
</span><span class=s2>    # if key in visited:
</span><span class=s2>    #     return
</span><span class=s2>    # visited.add(key)
</span><span class=s2>
</span><span class=s2>✅[Opt-17]星座リストの外部キャッシュ（ファイル）
</span><span class=s2>  テキスト：save_constellations_txt(...) / load_constellations_txt(...)
</span><span class=s2>  バイナリ：save_constellations_bin(...) / load_constellations_bin(...)
</span><span class=s2>  ラッパ：load_or_build_constellations_txt(...) / load_or_build_constellations_bin(...)
</span><span class=s2>    load_or_build_constellations_bin(...)
</span><span class=s2>    破損チェック validate_constellation_list(...) / validate_bin_file(...) あり
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-18] 星座生成（サブコンステレーション）にtuple keyでキャッシュ
</span><span class=s2>set_pre_queens やサブ星座生成は、状態変数を tuple でまとめて key にできます。これで全く同じ状態での星座生成は1度だけ実行されます。
</span><span class=s2>
</span><span class=s2>__init__ で self.subconst_cache: Dict[StateKey,bool]=</span><span class=si>{}</span><span class=s2> を用意
</span><span class=s2>set_pre_queens_cached(...) が tupleキー
</span><span class=s2>  (ld,rd,col,k,l,row,queens,LD,RD,N,preset_queens)
</span><span class=s2>  を使って self.subconst_cache を参照・更新
</span><span class=s2>生成側は gen_constellations(...) から 最初の呼び出しを set_pre_queens_cached に変更済み
</span><span class=s2>再帰内でも次の分岐呼び出しを set_pre_queens_cached(...) に置換しており、同一状態の再実行を回避
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-19] 星座自体をtuple/hashで一意管理して重複を防ぐ
</span><span class=s2>constellationsリストに追加する際、既に存在する星座を再追加しない
</span><span class=s2>→ 星座自体を「tuple/int/hash」にして集合管理
</span><span class=s2>これにより、異なる経路から同じ星座に到達しても重複追加を防げます。
</span><span class=s2>
</span><span class=s2>__init__ で self.constellation_signatures: Set[Tuple[int,int,int,int,int,int]]=set() を用意。
</span><span class=s2>set_pre_queens(...) 内の if queens==preset_queens: ブロックで
</span><span class=s2>signature=(ld,rd,col,k,l,row) をキーに重複チェックし、未出だけ constellations.append(...) ＆ counter[0]+=1。
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-20] Jasmin変換キャッシュ（クラス属性またはグローバル変数で）
</span><span class=s2>（生成済み盤面の再利用）
</span><span class=s2>ijkl_list_jasmin={self.jasmin(c,N) for c in ijkl_list} も、盤面→jasmin変換は「一度計算したらdictでキャッシュ」が効果大
</span><span class=s2>#グローバル変数で
</span><span class=s2>
</span><span class=s2>def get_jasmin(self,c:int,N:int) -&gt; int:
</span><span class=s2>    key=(c,N)
</span><span class=s2>    if key in jasmin_cache:
</span><span class=s2>        return jasmin_cache[key]
</span><span class=s2>    result=self.jasmin(c,N)
</span><span class=s2>    jasmin_cache[key]=result
</span><span class=s2>    return result
</span><span class=s2>
</span><span class=s2># 使用例:gen_constellations()内に
</span><span class=s2>ijkl_list_jasmin={self.get_jasmin(c,N) for c in ijkl_list}
</span><span class=s2>
</span><span class=s2>__init__ に self.jasmin_cache: Dict[Tuple[int,int],int]=</span><span class=si>{}</span><span class=s2>
</span><span class=s2>
</span><span class=s2>get_jasmin(self,c:int,N:int) で (c,N) をキーに memo 化
</span><span class=s2>
</span><span class=s2>gen_constellations() 内で
</span><span class=s2>
</span><span class=s2>ijkl_list={ self.get_jasmin(c,N) for c in ijkl_list }
</span><span class=s2>としてキャッシュ経由で Jasmin 変換しています
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-21] 180°重複チェックの二重化
</span><span class=s2>check_rotations() は 90/180/270°すべて見ていますが、奇数 N の中央列ブロックで check_rotations(...) と
</span><span class=s2>rot180_in_set(...) を両方呼んでいますね。ここは rot180 が 重複なので、check_rotations(...)
</span><span class=s2>のみでOK（微小ですが内包表記が軽くなります）。
</span><span class=s2>
</span><span class=s2># 修正前（中央列ブロック）
</span><span class=s2>ijkl_list.update(
</span><span class=s2>    self.to_ijkl(i,j,center,l)
</span><span class=s2>    for l in range(center+1,N-1)
</span><span class=s2>    for i in range(center+1,N-1)
</span><span class=s2>    if i != (N-1)-l
</span><span class=s2>    for j in range(N-center-2,0,-1)
</span><span class=s2>    if j != i and j != l
</span><span class=s2>    if not self.check_rotations(ijkl_list,i,j,center,l,N)
</span><span class=s2>    if not self.rot180_in_set(ijkl_list,i,j,center,l,N)  # ←これを削除
</span><span class=s2>)
</span><span class=s2>
</span><span class=s2># 修正後（中央列ブロック）
</span><span class=s2>ijkl_list.update(
</span><span class=s2>    self.to_ijkl(i,j,center,l)
</span><span class=s2>    for l in range(center+1,N-1)
</span><span class=s2>    for i in range(center+1,N-1)
</span><span class=s2>    if i != (N-1)-l
</span><span class=s2>    for j in range(N-center-2,0,-1)
</span><span class=s2>    if j != i and j != l
</span><span class=s2>    if not self.check_rotations(ijkl_list,i,j,center,l,N)
</span><span class=s2>)
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-22] visited の粒度
</span><span class=s2>visited を星座ごとに新規 set() にしているので、メモリ爆発を回避できています。ハッシュに ld,rd,col,row,queens,k,
</span><span class=s2>l,LD,RD,N まで混ぜているのも衝突耐性◯。
</span><span class=s2>  gen_constellations() の各スタート（星座）ごとに
</span><span class=s2>  visited: Set[StateKey]=set() を新規作成
</span><span class=s2>  StateKey=(ld,rd,col,row,queens,k,l,LD,RD,N,preset_queens) を追加・照合
</span><span class=s2>  という構成なので、
</span><span class=s2>  visited のスコープが星座単位 → メモリ増大を回避できている
</span><span class=s2>  衝突耐性は ld/rd/col/LD/RD の**ビット集合＋行インデックスやカウンタ（row/queens）＋分岐（k/l）**まで含むので十分に高い
</span><span class=s2>
</span><span class=s2>  gen_constellations() の各スタート（星座）ごとに
</span><span class=s2>  visited: Set[StateKey]=set() を新規作成
</span><span class=s2>  StateKey=(ld,rd,col,row,queens,k,l,LD,RD,N,preset_queens) を追加・照合
</span><span class=s2>  という構成なので、visited のスコープが星座単位 → メモリ増大を回避できている
</span><span class=s2>  衝突耐性は ld/rd/col/LD/RD の**ビット集合＋行インデックスやカウンタ（row/queens）＋分岐（k/l）**まで含むので十分に高いでOKです。
</span><span class=s2>
</span><span class=s2>  細かい改善ポイント（任意）：
</span><span class=s2>  N と preset_queens は探索中は一定なので、キーから外しても挙動は変わりません（キーが少し短くなります）。もちろん入れたままでも正しいです。
</span><span class=s2>  もし将来 state_hash() に切り替えるときも、visited を星座ごとに new にする方針はそのまま維持してください（グローバルにしない）。
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-23] ビット演算のインライン化・board_mask の上位での共有・**1ビット抽出 bit=x &amp;
</span><span class=s2>-x**など、要所は押さえられています。
</span><span class=s2>cnt を星座ごとにローカルで完結→solutions に掛け算（symmetry()）という流れもキャッシュに優しい設計。
</span><span class=s2>これ以上を狙うなら、「星座ごと分割の並列度を広げる」か「gen_constellations の ijkl_list.update(...)
</span><span class=s2>での回転重複除去を最小限に（=set操作の負荷を減らす）」の二択ですが、現状の速度を見る限り十分実用的です。
</span><span class=s2>
</span><span class=s2>  いまの実装は
</span><span class=s2>  ビット演算の徹底（bit=x&amp;-x／board_maskの共有／blocked→next_freeの短絡判定）
</span><span class=s2>  cnt を星座ローカルで完結→最後に symmetry() を掛けるフロー
</span><span class=s2>  visited を星座ごとに分離
</span><span class=s2>  など、ボトルネックをしっかり押さえられていて実用速度も十分です。
</span><span class=s2>  さらに“やるなら”の小粒アイデア（任意）だけ置いておきます：
</span><span class=s2>  symmetry(ijkl,N) の結果を小さな dict でメモ化（星座件数分の呼び出しを削減）。
</span><span class=s2>  gen_constellations での set 操作を減らしたい場合は、候補を一旦 list に溜めて最後に
</span><span class=s2>  （i）jasmin 変換 →
</span><span class=s2>  （ii）set に流し込み（重複除去）
</span><span class=s2>  という“1回だけの set 化”に寄せる（ただし回転除去の粒度は保つ）。
</span><span class=s2>  並列度をもう少しだけ広げるなら、exec_solutions の @par は維持しつつ、constellations を大きめのチャンクに分割してワーカーに渡す（1件ずつよりスレッド起動回数が減るのでスケジューリング負荷が下がることがあります）。
</span><span class=s2>  無理にいじるより、現状のバランス（読みやすさ×速度）を維持で十分だと思います。
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>✅[Opt-24]“先読み空き” の条件
</span><span class=s2>先読み関数 _has_future_space() を使った
</span><span class=s2>if next_free and ((row &gt;= endmark-1) or _has_future_space(...)):
</span><span class=s2>の形は、**「ゴール直前は先読み不要」**という意図に合っていて良い感じ。境界で row+1 &gt;= endmark か row &gt;= endmark-1
</span><span class=s2>を使い分けている箇所も一貫しています。
</span><span class=s2>
</span><span class=s2>  各再帰で
</span><span class=s2>  next_free=board_mask&amp;~blocked
</span><span class=s2>  if next_free and ((row &gt;= endmark-1) or self._has_future_space(next_ld,next_rd,next_col,board_mask)):
</span><span class=s2>  （1行進む再帰は row+1 &gt;= endmark／2行進む再帰は row+2 &gt;= endmark などに合わせて判定）
</span><span class=s2>  という形になっており、
</span><span class=s2>  ゴール直前は先読み不要（短絡評価で _has_future_space を呼ばない）
</span><span class=s2>  それ以外は**“1行先に置ける可能性が1ビットでもあるか”**の軽量チェックでムダ分岐を削減
</span><span class=s2>  がきれいに機能しています。
</span><span class=s2>
</span><span class=s2>  軽い補足（任意）：
</span><span class=s2>  「+1 進む」「+2 進む」系で row+Δ &gt;= endmark の Δ を必ず合わせる（すでに合わせてありますが、この一貫性が重要）。
</span><span class=s2>  ループ先頭で if not next_free: continue の早期スキップを入れるのも読みやすさ的に○（実測差は小さいことが多いです）。
</span><span class=s2>  _has_future_space 内の式は現在の実装（board_mask&amp;~(((next_ld&lt;&lt;1)|(next_rd&gt;&gt;1)|next_col)) != 0）で十分速いです。
</span><span class=s2>  総じて、境界条件と短絡評価の使い方が意図に合っており、問題ありません。
</span><span class=s2>&#34;&#34;&#34;</span>
<span class=c1>##------------------------------------------------------------------------</span>
<span class=c1># 以下は対応不要、または対応できない一般的なキャッシュ対応</span>
<span class=c1>##------------------------------------------------------------------------</span>
<span class=s2>&#34;&#34;&#34;
</span><span class=s2>❎ 未対応 並列とキャッシュの整合
</span><span class=s2>@par は exec_solutions の星座単位で独立になっているので、インスタンス属性のキャッシュは
</span><span class=s2>生成段階（gen_constellations）で完結しており競合しません。jasmin_cache・subconst_cache を
</span><span class=s2>インスタンス属性にしたのは正解。
</span><span class=s2>
</span><span class=s2>  結論：今の実装（constellation → SQ＊の深い再帰、盤面は bitmask だけで保持）では “途中段階の部分対称除去”
</span><span class=s2>  は基本的に入れないほうが安全 です。入れるなら設計を少し変える必要があります。
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>❎ 未対応 1行目以外の部分対称除去
</span><span class=s2>jasmin/is_partial_canonicalで排除
</span><span class=s2>途中段階（深さ r の盤面）を都度「辞書順最小」の canonical かどうかチェックして、そうでなければ枝刈り
</span><span class=s2>→ 各 SQ〜() の再帰関数の while free: の直前にこの判定を入れ、False なら continue。
</span><span class=s2>  結論：board変数にrowの配置情報を格納していないので対応不可
</span><span class=s2>  結論：今の実装（constellation → SQ＊の深い再帰、盤面は bitmask だけで保持）では “途中段階の部分対称除去” は基本的に入れないほうが安全 です。入れるなら設計を少し変える必要があります。
</span><span class=s2>  なぜそのままは危険／効果が薄いか
</span><span class=s2>  対称代表（orbit representative）の一貫性
</span><span class=s2>  すでに gen_constellations 側で 初手左右半分＋コーナー分岐＋Jasmin で代表選択をしています。この方針と、途中深さでの is_partial_canonical() の代表規則がズレると、合法枝を誤って落とす／重複排除が二重に効いて過剰枝刈りが起きます（以前の Zobrist で総数が減った現象と同系の事故になりやすい）。
</span><span class=s2>  partial 変換の定義が難しい
</span><span class=s2>  D4（回転・鏡映）の作用は行と列を同時に入れ替えます。bitmask だけを持つ現在の SQ 再帰状態（ld/rd/col と row、さらに j/k/l の特殊制約）に、“部分盤面を回した後も同じ制約系になるか” を正しく合成するのがかなり大変です。
</span><span class=s2>  カウント重み（COUNT2/4/8）との整合
</span><span class=s2>  最終的な重み付けが「代表だけ探索して最後に 2/4/8 を掛ける」設計なので、途中で代表以外を落とす規則はこの重み付けと厳密に一致していなければなりません。
</span><span class=s2>
</span><span class=s2># -----------------------------------
</span><span class=s2># [Opt-07] 部分盤面 canonical 判定
</span><span class=s2>def is_partial_canonical(board: List[int],row:int,N:int) -&gt; bool:
</span><span class=s2>  # 現在の board[0:row] が他のミラー・回転盤面より辞書順で小さいか
</span><span class=s2>  current=tuple(board[:row])
</span><span class=s2>  symmetries=[]
</span><span class=s2>  # ミラー（左右反転）
</span><span class=s2>  mirrored=[N-1-b for b in current]
</span><span class=s2>  symmetries.append(tuple(mirrored))
</span><span class=s2>  # 90度回転：盤面を (col → row) に再構築する必要がある（簡略化版）
</span><span class=s2>  # 完全な回転は行列転置＋ミラーが必要（時間コストあり）
</span><span class=s2>  return all(current&lt;=s for s in symmetries)
</span><span class=s2># -----------------------------------
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>❎ 未対応 軽量 is_canonical() による“部分盤面”の辞書順最小チェックを高速化（キャッシュ/軽量版）
</span><span class=s2>「完成盤」だけでなく“部分盤面”用に軽量な変換（行の回転・反転は途中情報だけで可）を実装。
</span><span class=s2> is_partial_canonical() の中で zobrist_cache[hash]=True/False として使う
</span><span class=s2>
</span><span class=s2>  「部分盤面の辞書順最小（canonical）チェック」は、基本的に
</span><span class=s2>  board[row]=col_bit（＝各行に置いた列位置が順に分かる配列/スタック）
</span><span class=s2>  もしくは cols_by_row=[c0,c1,...,c(r-1)] のように「置いた列の履歴」
</span><span class=s2>  を常に持っている設計で効果を発揮します。
</span><span class=s2>  現在の “constellation 方式”（ld/rd/col のビットマスク＋row、k,l など）では、
</span><span class=s2>  行ごとの「どの列に置いたか」の履歴が再構成できない
</span><span class=s2>  回転・反転の変換を ld/rd/col に対して途中段階で正しく適用するのが難しい（ld/rd は「行進」に依存した相対ビット）
</span><span class=s2>  ため、そのままでは実装が難しいです。
</span><span class=s2>
</span><span class=s2>  いまの設計のまま：既存の対称性除去を強化する
</span><span class=s2>  →あなたのコードは既に
</span><span class=s2>  初手生成での左右対称除去・コーナー分岐
</span><span class=s2>  Jasmin 変換（代表系化）
</span><span class=s2>  180°重複チェック
</span><span class=s2>  さらに set_pre_queens_cached の状態キャッシュ
</span><span class=s2>  が入っているので、部分盤面 canonical は無理に足さなくても充分に強いです。
</span><span class=s2>&#34;&#34;&#34;</span>

<span class=s2>&#34;&#34;&#34;
</span><span class=s2>❎ 未対応 マクロチェス（局所パターン）    達成    violate_macro_patterns関数（導入済ならOK）
</span><span class=s2>→ violate_macro_patternsのようなローカルな局所配置判定関数を挟む設計で達成
</span><span class=s2>結論：board変数にrowのは位置情報を格納していないので対応不可
</span><span class=s2>
</span><span class=s2>  violate_macro_patterns のような「局所（2～3行内）の並びで即座に弾く」系は、
</span><span class=s2>  典型的には board[row]=col（行→列の履歴）を常に持っていてこそ強い枝刈りになります。
</span><span class=s2>  いまの constellations 方式（ld/rd/col の集合状態＋row,k,l）だと、**「直前・直前々行でどの列に置いたか」**が直接分からないため、
</span><span class=s2>  一般的な「近傍パターン」判定を素直に書くのは難しいです。
</span><span class=s2>  もっとも、あなたの実装はすでに
</span><span class=s2>  初手生成の厳しい対称性制約
</span><span class=s2>  Jasmin 代表系化
</span><span class=s2>  各種 SQ* 系の分岐（実質“マクロ手筋”をパターンとして埋め込んでいる）
</span><span class=s2>  が効いているので、汎用の violate_macro_patterns を後付けする必要性は低めです。
</span><span class=s2>&#34;&#34;&#34;</span>



<span class=c1># import random</span>
<span class=kn>import</span> <span class=nn>pickle</span><span class=o>,</span><span class=nn>os</span>
<span class=c1># from operator import or_</span>
<span class=c1># from functools import reduce</span>
<span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span><span class=n>Set</span><span class=p>,</span><span class=n>Dict</span><span class=p>,</span><span class=n>Tuple</span>
<span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>

<span class=c1># 64bit マスク（Zobrist用途）</span>
<span class=n>MASK64</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=mi>64</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span>
<span class=c1># StateKey=Tuple[int,int,int,int,int,int,int,int,int,int,int]</span>
<span class=n>StateKey</span><span class=o>=</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>]</span>
<span class=c1># StateKey=Tuple[int,int,int,int,int,int,int,int,int]</span>


<span class=c1># pypyを使うときは以下を活かしてcodon部分をコメントアウト</span>
<span class=c1># import pypyjit</span>
<span class=c1># pypyjit.set_param(&#39;max_unroll_recursion=-1&#39;)</span>
<span class=c1>#</span>
<span class=k>class</span> <span class=nc>NQueens15</span><span class=p>:</span>
  <span class=s2>&#34;&#34;&#34;N-Queens の探索・前処理（Zobrist, 対称除去, 開始盤面生成など）を担う中核クラス。
</span><span class=s2>
</span><span class=s2>  属性:
</span><span class=s2>      subconst_cache (Set[StateKey]): サブコンステレーション生成の重複防止キャッシュ。
</span><span class=s2>      constellation_signatures (Set[Tuple[int,...]]): 生成済み星座の重複抑止用 signature 集。
</span><span class=s2>      jasmin_cache (Dict[Tuple[int,int],int]): jasmin() 正規化の結果キャッシュ (key=(ijkl,N)).
</span><span class=s2>      zobrist_tables (Dict[int,Dict[str,List[int]]]): Nごとの Zobrist テーブル。
</span><span class=s2>      gen_cache (Dict[...]): 生成系の任意キャッシュ（拡張用）。
</span><span class=s2>  &#34;&#34;&#34;</span>


  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
    <span class=c1># StateKey</span>
    <span class=c1># self.subconst_cache: Dict[ StateKey,bool ]={}</span>
    <span class=c1># self.subconst_cache: Dict[ Tuple[int,int,int,int,int,int,int,int,int,int,int],bool ]={}</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>subconst_cache</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=n>StateKey</span><span class=p>]</span><span class=o>=</span><span class=nb>set</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>constellation_signatures</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>]</span> <span class=p>]</span><span class=o>=</span><span class=nb>set</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>jasmin_cache</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>],</span><span class=nb>int</span><span class=p>]</span><span class=o>=</span><span class=p>{}</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>zobrist_tables</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]]]</span><span class=o>=</span><span class=p>{}</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>gen_cache</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>,</span><span class=nb>int</span><span class=p>],</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]</span> <span class=p>]</span><span class=o>=</span><span class=p>{}</span>

  <span class=k>def</span> <span class=nf>_mix64</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>x</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;splitmix64 の終段に相当する 64bit ミキサ。
</span><span class=s2>
</span><span class=s2>    目的:
</span><span class=s2>        Zobrist テーブル用の擬似乱数を生成する内部関数。
</span><span class=s2>    参照:
</span><span class=s2>        MASK64, _gen_list()
</span><span class=s2>    &#34;&#34;&#34;</span>

    <span class=c1># splitmix64 の最終段だけ使ったミキサ</span>
    <span class=n>x</span> <span class=o>&amp;=</span> <span class=n>MASK64</span>
    <span class=n>x</span><span class=o>=</span><span class=p>(</span><span class=n>x</span> <span class=o>^</span> <span class=p>(</span><span class=n>x</span><span class=o>&gt;&gt;</span><span class=mi>30</span><span class=p>))</span> <span class=o>*</span> <span class=mh>0xBF58476D1CE4E5B9</span><span class=o>&amp;</span><span class=n>MASK64</span>
    <span class=n>x</span><span class=o>=</span><span class=p>(</span><span class=n>x</span> <span class=o>^</span> <span class=p>(</span><span class=n>x</span><span class=o>&gt;&gt;</span><span class=mi>27</span><span class=p>))</span> <span class=o>*</span> <span class=mh>0x94D049BB133111EB</span><span class=o>&amp;</span><span class=n>MASK64</span>
    <span class=n>x</span> <span class=o>^=</span> <span class=p>(</span><span class=n>x</span><span class=o>&gt;&gt;</span><span class=mi>31</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>x</span><span class=o>&amp;</span><span class=n>MASK64</span>

  <span class=k>def</span> <span class=nf>_gen_list</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>cnt</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>seed</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span>
    <span class=s2>&#34;&#34;&#34;Zobrist テーブルに使う 64bit 値を cnt 個生成して返す。
</span><span class=s2>    引数:
</span><span class=s2>        cnt: 生成個数
</span><span class=s2>        seed: 64bit シード（splitmix64 の加算項を利用）
</span><span class=s2>    戻り値:
</span><span class=s2>        64bit 整数のリスト
</span><span class=s2>    関連:
</span><span class=s2>        _init_zobrist() で &#39;ld&#39;,&#39;rd&#39;,&#39;col&#39;,&#39;LD&#39;,&#39;RD&#39;,&#39;row&#39;,&#39;queens&#39;,&#39;k&#39;,&#39;l&#39; に割当。
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>out</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span><span class=o>=</span><span class=p>[]</span>
    <span class=n>s</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>seed</span><span class=o>&amp;</span><span class=n>MASK64</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>cnt</span><span class=p>):</span>
      <span class=n>s</span><span class=o>=</span><span class=p>(</span><span class=n>s</span><span class=o>+</span><span class=mh>0x9E3779B97F4A7C15</span><span class=p>)</span><span class=o>&amp;</span><span class=n>MASK64</span>   <span class=c1># splitmix64 のインクリメント</span>
      <span class=n>out</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_mix64</span><span class=p>(</span><span class=n>s</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>out</span>

  <span class=k>def</span> <span class=nf>_init_zobrist</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;盤サイズ N 用の Zobrist テーブルを初期化（1度だけ）。
</span><span class=s2>    テーブル要素:
</span><span class=s2>        &#39;ld&#39;,&#39;rd&#39;,&#39;col&#39;,&#39;LD&#39;,&#39;RD&#39;,&#39;row&#39;,&#39;queens&#39;,&#39;k&#39;,&#39;l&#39;
</span><span class=s2>    再入防止:
</span><span class=s2>        既に self.zobrist_tables[N] があれば何もしない。
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=c1># 例: self.zobrist_tables: Dict[int,Dict[str,List[int]]] を持つ前提。</span>
    <span class=c1># N ごとに [&#39;ld&#39;,&#39;rd&#39;,&#39;col&#39;,&#39;LD&#39;,&#39;RD&#39;,&#39;row&#39;,&#39;queens&#39;,&#39;k&#39;,&#39;l&#39;] のテーブルを用意。</span>
    <span class=k>if</span> <span class=n>N</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>zobrist_tables</span><span class=p>:</span>
      <span class=k>return</span>
    <span class=n>base_seed</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=mh>0xC0D0_0000_0000_0000</span> <span class=o>^</span> <span class=p>(</span><span class=n>N</span><span class=o>&lt;&lt;</span><span class=mi>32</span><span class=p>))</span><span class=o>&amp;</span><span class=n>MASK64</span>
    <span class=n>tbl</span><span class=p>:</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]]</span><span class=o>=</span><span class=p>{</span>
        <span class=s1>&#39;ld&#39;</span>    <span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gen_list</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>base_seed</span> <span class=o>^</span> <span class=mh>0x01</span><span class=p>),</span>
        <span class=s1>&#39;rd&#39;</span>    <span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gen_list</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>base_seed</span> <span class=o>^</span> <span class=mh>0x02</span><span class=p>),</span>
        <span class=s1>&#39;col&#39;</span>   <span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gen_list</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>base_seed</span> <span class=o>^</span> <span class=mh>0x03</span><span class=p>),</span>
        <span class=s1>&#39;LD&#39;</span>    <span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gen_list</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>base_seed</span> <span class=o>^</span> <span class=mh>0x04</span><span class=p>),</span>
        <span class=s1>&#39;RD&#39;</span>    <span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gen_list</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>base_seed</span> <span class=o>^</span> <span class=mh>0x05</span><span class=p>),</span>
        <span class=s1>&#39;row&#39;</span>   <span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gen_list</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>base_seed</span> <span class=o>^</span> <span class=mh>0x06</span><span class=p>),</span>
        <span class=s1>&#39;queens&#39;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gen_list</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>base_seed</span> <span class=o>^</span> <span class=mh>0x07</span><span class=p>),</span>
        <span class=s1>&#39;k&#39;</span>     <span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gen_list</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>base_seed</span> <span class=o>^</span> <span class=mh>0x08</span><span class=p>),</span>
        <span class=s1>&#39;l&#39;</span>     <span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>_gen_list</span><span class=p>(</span><span class=n>N</span><span class=p>,</span><span class=n>base_seed</span> <span class=o>^</span> <span class=mh>0x09</span><span class=p>),</span>
    <span class=p>}</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>zobrist_tables</span><span class=p>[</span><span class=n>N</span><span class=p>]</span><span class=o>=</span><span class=n>tbl</span>

  <span class=k>def</span> <span class=nf>rot90</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;(i,j,k,l) の盤面を 90°（時計回り）回転させた signature を返す。
</span><span class=s2>    位置対応:
</span><span class=s2>        (row, col) → (col, N-1-row)
</span><span class=s2>    実装:
</span><span class=s2>        geti/getj/getk/getl を再配置して 20bit に組み直し。
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;&lt;</span><span class=mi>15</span><span class=p>)</span><span class=o>+</span><span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>5</span><span class=p>)</span><span class=o>+</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>rot180</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34; 対称性のための計算と、ijklを扱うためのヘルパー関数。
</span><span class=s2>    開始コンステレーションが回転90に対して対称である場合
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;&lt;</span><span class=mi>15</span><span class=p>)</span><span class=o>+</span><span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>)</span><span class=o>+</span><span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;&lt;</span><span class=mi>5</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span>


  <span class=k>def</span> <span class=nf>check_rotations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl_list</span><span class=p>:</span><span class=n>Set</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span><span class=n>i</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>j</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>k</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>l</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>bool</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;(i,j,k,l) の 90/180/270° 回転形のいずれかが既に集合に含まれているかを判定。
</span><span class=s2>    戻り値:
</span><span class=s2>        True: 既出（重複） / False: 未出（追加候補）
</span><span class=s2>    用途:
</span><span class=s2>        gen_constellations() で回転対称の重複を除外。
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=nb>any</span><span class=p>(</span><span class=n>rot</span> <span class=ow>in</span> <span class=n>ijkl_list</span> <span class=k>for</span> <span class=n>rot</span> <span class=ow>in</span> <span class=p>[((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>k</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>15</span><span class=p>)</span><span class=o>+</span><span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>l</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>&lt;&lt;</span><span class=mi>5</span><span class=p>)</span><span class=o>+</span><span class=n>i</span><span class=p>,((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>j</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>15</span><span class=p>)</span><span class=o>+</span><span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>i</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>)</span><span class=o>+</span><span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>l</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>5</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>k</span><span class=p>),(</span><span class=n>l</span><span class=o>&lt;&lt;</span><span class=mi>15</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>k</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>)</span><span class=o>+</span><span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>i</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>5</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>j</span><span class=p>)])</span>

  <span class=k>def</span> <span class=nf>symmetry</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;解の重複補正係数を返す（90°:2, 180°:4, その他:8）。
</span><span class=s2>    用途:
</span><span class=s2>        exec_solutions() で各コンステレーションの解数に補正を掛ける。
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=mi>2</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>symmetry90</span><span class=p>(</span><span class=n>ijkl</span><span class=p>,</span><span class=n>N</span><span class=p>)</span> <span class=k>else</span> <span class=mi>4</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span><span class=o>==</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span><span class=o>==</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span> <span class=k>else</span> <span class=mi>8</span>

  <span class=k>def</span> <span class=nf>symmetry90</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>bool</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;盤面が 90° 回転で自己一致するか（90°回転対称）を判定。&#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=p>((</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>15</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>5</span><span class=p>)</span><span class=o>+</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>==</span><span class=p>(((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;&lt;</span><span class=mi>15</span><span class=p>)</span><span class=o>+</span><span class=p>((</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>5</span><span class=p>)</span><span class=o>+</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span>

  <span class=k>def</span> <span class=nf>to_ijkl</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>i</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>j</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>k</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>l</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;(i,j,k,l) を 5bit ×4 の 20bit 整数にパックして返す（signature 用）。&#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=p>(</span><span class=n>i</span><span class=o>&lt;&lt;</span><span class=mi>15</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>j</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=n>k</span><span class=o>&lt;&lt;</span><span class=mi>5</span><span class=p>)</span><span class=o>+</span><span class=n>l</span>

  <span class=k>def</span> <span class=nf>mirvert</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;垂直ミラー（上下反転）後の signature を返す。&#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>to_ijkl</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span>

  <span class=k>def</span> <span class=nf>ffmin</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>a</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>b</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;微小高速のための min ラッパ（命名は Fast&amp;Friendly の意）。&#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=nb>min</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>geti</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span> <span class=k>return</span> <span class=p>(</span><span class=n>ijkl</span><span class=o>&gt;&gt;</span><span class=mi>15</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0x1F</span>
  <span class=k>def</span> <span class=nf>getj</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span> <span class=k>return</span> <span class=p>(</span><span class=n>ijkl</span><span class=o>&gt;&gt;</span><span class=mi>10</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0x1F</span>
  <span class=k>def</span> <span class=nf>getk</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span> <span class=k>return</span> <span class=p>(</span><span class=n>ijkl</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span><span class=o>&amp;</span><span class=mh>0x1F</span>
  <span class=k>def</span> <span class=nf>getl</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span> <span class=k>return</span> <span class=n>ijkl</span><span class=o>&amp;</span><span class=mh>0x1F</span>

  <span class=k>def</span> <span class=nf>get_jasmin</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>c</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;jasmin() による正規化にキャッシュを噛ませたラッパ。
</span><span class=s2>    key:
</span><span class=s2>        (c, N) をキーに結果を self.jasmin_cache に保存。
</span><span class=s2>    1. Jasmin変換キャッシュを導入する
</span><span class=s2>    [Opt-08] キャッシュ付き jasmin() のラッパー
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>key</span><span class=o>=</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>jasmin_cache</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>jasmin_cache</span><span class=p>[</span><span class=n>key</span><span class=p>]</span>
    <span class=n>result</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>jasmin</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>jasmin_cache</span><span class=p>[</span><span class=n>key</span><span class=p>]</span><span class=o>=</span><span class=n>result</span>
    <span class=k>return</span> <span class=n>result</span>

  <span class=k>def</span> <span class=nf>jasmin</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;(i,j,k,l) を回転・ミラーで“最も左上に近い標準形”へ写像する。
</span><span class=s2>    ポイント:
</span><span class=s2>        - まず j/i/k/l の「端からの距離」の最小を持つ軸を優先し、arg 回 90°回転。
</span><span class=s2>        - その後、j が上側に来るよう必要なら垂直ミラー。
</span><span class=s2>    戻り値:
</span><span class=s2>        正規化後の signature（20bit）
</span><span class=s2>    補足:
</span><span class=s2>        「l&gt;k&gt;i&gt;j の優先順位」の考え方をコードに反映（実装コメント参照）。
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>arg</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>min_val</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>ffmin</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span>
    <span class=c1># i: 最初の行（上端） 90度回転2回</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>ffmin</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;</span><span class=n>min_val</span><span class=p>:</span>
      <span class=n>arg</span><span class=o>=</span><span class=mi>2</span>
      <span class=n>min_val</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>ffmin</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span>
    <span class=c1># k: 最初の列（左端） 90度回転3回</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>ffmin</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;</span><span class=n>min_val</span><span class=p>:</span>
      <span class=n>arg</span><span class=o>=</span><span class=mi>3</span>
      <span class=n>min_val</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>ffmin</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span>
    <span class=c1># l: 最後の列（右端） 90度回転1回</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>ffmin</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span><span class=o>&lt;</span><span class=n>min_val</span><span class=p>:</span>
      <span class=n>arg</span><span class=o>=</span><span class=mi>1</span>
      <span class=n>min_val</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>ffmin</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>))</span>
    <span class=c1># 90度回転を arg 回繰り返す</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>arg</span><span class=p>):</span>
      <span class=n>ijkl</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>rot90</span><span class=p>(</span><span class=n>ijkl</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=c1># 必要に応じて垂直方向のミラーリングを実行</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span><span class=o>&lt;</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>):</span>
      <span class=n>ijkl</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>mirvert</span><span class=p>(</span><span class=n>ijkl</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>ijkl</span>

  <span class=k>def</span> <span class=nf>file_exists</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>fname</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;ファイル存在を安全に判定（例外も握りつぶして False を返す）。&#34;&#34;&#34;</span>
    <span class=k>try</span><span class=p>:</span>
      <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>fname</span><span class=p>,</span><span class=s2>&#34;rb&#34;</span><span class=p>):</span>
        <span class=k>return</span> <span class=kc>True</span>
    <span class=k>except</span><span class=p>:</span>
      <span class=k>return</span> <span class=kc>False</span>

  <span class=k>def</span> <span class=nf>validate_constellation_list</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>constellations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;読み込んだコンステレーション配列が最低限のキーを持つかを検証。&#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=nb>all</span><span class=p>(</span><span class=nb>all</span><span class=p>(</span><span class=n>k</span> <span class=ow>in</span> <span class=n>c</span> <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&#34;ld&#34;</span><span class=p>,</span><span class=s2>&#34;rd&#34;</span><span class=p>,</span><span class=s2>&#34;col&#34;</span><span class=p>,</span><span class=s2>&#34;startijkl&#34;</span><span class=p>))</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>constellations</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>read_uint32_le</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>b</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;4バイト（文字列扱い/Codon互換）から little-endian 32bit int を復元。&#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>&amp;</span><span class=mh>0xFF</span><span class=p>)</span><span class=o>|</span><span class=p>((</span><span class=nb>ord</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=o>&amp;</span><span class=mh>0xFF</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>8</span><span class=p>)</span><span class=o>|</span><span class=p>((</span><span class=nb>ord</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span><span class=o>&amp;</span><span class=mh>0xFF</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>16</span><span class=p>)</span><span class=o>|</span><span class=p>((</span><span class=nb>ord</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span><span class=o>&amp;</span><span class=mh>0xFF</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>24</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>int_to_le_bytes</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>x</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span>
    <span class=s2>&#34;&#34;&#34;32bit int を little-endian の4バイト配列に変換。&#34;&#34;&#34;</span>
    <span class=k>return</span> <span class=p>[(</span><span class=n>x</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=mi>8</span> <span class=o>*</span> <span class=n>i</span><span class=p>))</span><span class=o>&amp;</span><span class=mh>0xFF</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>)]</span>

  <span class=k>def</span> <span class=nf>validate_bin_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>fname</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;BINのサイズ妥当性を確認（1レコード=16バイト: ld,rd,col,startijkl）。&#34;&#34;&#34;</span>
    <span class=k>try</span><span class=p>:</span>
      <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>fname</span><span class=p>,</span><span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>f</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span>  <span class=c1># ファイル末尾に移動</span>
        <span class=n>size</span><span class=o>=</span><span class=n>f</span><span class=o>.</span><span class=n>tell</span><span class=p>()</span>
      <span class=k>return</span> <span class=n>size</span> <span class=o>%</span> <span class=mi>16</span><span class=o>==</span><span class=mi>0</span>
    <span class=k>except</span><span class=p>:</span>
      <span class=k>return</span> <span class=kc>False</span>

  <span class=k>def</span> <span class=nf>load_or_build_constellations_bin</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl_list</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span><span class=n>constellations</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]:</span>
    <span class=s2>&#34;&#34;&#34;BINキャッシュを読み込み、壊れていれば再生成して保存して返すラッパ。&#34;&#34;&#34;</span>
    <span class=n>fname</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;constellations_N</span><span class=si>{</span><span class=n>N</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>preset_queens</span><span class=si>}</span><span class=s2>.bin&#34;</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_exists</span><span class=p>(</span><span class=n>fname</span><span class=p>):</span>
      <span class=k>try</span><span class=p>:</span>
        <span class=n>constellations</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>load_constellations_bin</span><span class=p>(</span><span class=n>fname</span><span class=p>)</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>validate_bin_file</span><span class=p>(</span><span class=n>fname</span><span class=p>)</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>validate_constellation_list</span><span class=p>(</span><span class=n>constellations</span><span class=p>):</span>
          <span class=k>return</span> <span class=n>constellations</span>
        <span class=k>else</span><span class=p>:</span>
          <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[警告] 不正なキャッシュ形式: </span><span class=si>{</span><span class=n>fname</span><span class=si>}</span><span class=s2> を再生成します&#34;</span><span class=p>)</span>
      <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[警告] キャッシュ読み込み失敗: </span><span class=si>{</span><span class=n>fname</span><span class=si>}</span><span class=s2>,理由: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
    <span class=n>constellations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]</span><span class=o>=</span><span class=p>[]</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>gen_constellations</span><span class=p>(</span><span class=n>ijkl_list</span><span class=p>,</span><span class=n>constellations</span><span class=p>,</span><span class=n>N</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>save_constellations_bin</span><span class=p>(</span><span class=n>fname</span><span class=p>,</span><span class=n>constellations</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>constellations</span>

  <span class=k>def</span> <span class=nf>save_constellations_txt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span><span class=n>constellations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;コンステレーションをテキスト (ld rd col startijkl solutions) の1行形式で保存。&#34;&#34;&#34;</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span><span class=s2>&#34;w&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
      <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>constellations</span><span class=p>:</span>
        <span class=n>ld</span><span class=o>=</span><span class=n>c</span><span class=p>[</span><span class=s2>&#34;ld&#34;</span><span class=p>]</span>
        <span class=n>rd</span><span class=o>=</span><span class=n>c</span><span class=p>[</span><span class=s2>&#34;rd&#34;</span><span class=p>]</span>
        <span class=n>col</span><span class=o>=</span><span class=n>c</span><span class=p>[</span><span class=s2>&#34;col&#34;</span><span class=p>]</span>
        <span class=n>startijkl</span><span class=o>=</span><span class=n>c</span><span class=p>[</span><span class=s2>&#34;startijkl&#34;</span><span class=p>]</span>
        <span class=n>solutions</span><span class=o>=</span><span class=n>c</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;solutions&#34;</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span>
        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>ld</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>rd</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>col</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>startijkl</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>solutions</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>load_constellations_txt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]:</span>
    <span class=s2>&#34;&#34;&#34;テキスト形式のコンステレーションをロードし、辞書配列に復元。&#34;&#34;&#34;</span>
    <span class=n>out</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]</span><span class=o>=</span><span class=p>[]</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=p>,</span><span class=s2>&#34;r&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
      <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
        <span class=n>parts</span><span class=o>=</span><span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>5</span><span class=p>:</span>
          <span class=k>continue</span>
        <span class=n>ld</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span> <span class=n>rd</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span> <span class=n>col</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>parts</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
        <span class=n>startijkl</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>parts</span><span class=p>[</span><span class=mi>3</span><span class=p>]);</span> <span class=n>solutions</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>parts</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
        <span class=n>out</span><span class=o>.</span><span class=n>append</span><span class=p>({</span><span class=s2>&#34;ld&#34;</span><span class=p>:</span> <span class=n>ld</span><span class=p>,</span><span class=s2>&#34;rd&#34;</span><span class=p>:</span> <span class=n>rd</span><span class=p>,</span><span class=s2>&#34;col&#34;</span><span class=p>:</span> <span class=n>col</span><span class=p>,</span><span class=s2>&#34;startijkl&#34;</span><span class=p>:</span> <span class=n>startijkl</span><span class=p>,</span><span class=s2>&#34;solutions&#34;</span><span class=p>:</span> <span class=n>solutions</span><span class=p>})</span>
    <span class=k>return</span> <span class=n>out</span>

  <span class=k>def</span> <span class=nf>save_constellations_bin</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>fname</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span><span class=n>constellations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;コンステレーションを BIN (ld, rd, col, startijkl) × n レコードで保存。&#34;&#34;&#34;</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>fname</span><span class=p>,</span><span class=s2>&#34;wb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
      <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>constellations</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&#34;ld&#34;</span><span class=p>,</span><span class=s2>&#34;rd&#34;</span><span class=p>,</span><span class=s2>&#34;col&#34;</span><span class=p>,</span><span class=s2>&#34;startijkl&#34;</span><span class=p>]:</span>
          <span class=n>b</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>int_to_le_bytes</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=n>key</span><span class=p>])</span>
          <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>b</span><span class=p>))</span>  <span class=c1># Codonでは str がバイト文字列扱い</span>

  <span class=k>def</span> <span class=nf>load_constellations_bin</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>fname</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]:</span>
    <span class=s2>&#34;&#34;&#34;BIN形式のコンステレーションをロードして辞書配列に復元。&#34;&#34;&#34;</span>
    <span class=n>constellations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]</span><span class=o>=</span><span class=p>[]</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>fname</span><span class=p>,</span><span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
      <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
        <span class=n>raw</span><span class=o>=</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>raw</span><span class=p>)</span><span class=o>&lt;</span><span class=mi>16</span><span class=p>:</span>
          <span class=k>break</span>
        <span class=n>ld</span>        <span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>read_uint32_le</span><span class=p>(</span><span class=n>raw</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>4</span><span class=p>])</span>
        <span class=n>rd</span>        <span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>read_uint32_le</span><span class=p>(</span><span class=n>raw</span><span class=p>[</span><span class=mi>4</span><span class=p>:</span><span class=mi>8</span><span class=p>])</span>
        <span class=n>col</span>       <span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>read_uint32_le</span><span class=p>(</span><span class=n>raw</span><span class=p>[</span><span class=mi>8</span><span class=p>:</span><span class=mi>12</span><span class=p>])</span>
        <span class=n>startijkl</span> <span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>read_uint32_le</span><span class=p>(</span><span class=n>raw</span><span class=p>[</span><span class=mi>12</span><span class=p>:</span><span class=mi>16</span><span class=p>])</span>
        <span class=n>constellations</span><span class=o>.</span><span class=n>append</span><span class=p>({</span> <span class=s2>&#34;ld&#34;</span><span class=p>:</span> <span class=n>ld</span><span class=p>,</span><span class=s2>&#34;rd&#34;</span><span class=p>:</span> <span class=n>rd</span><span class=p>,</span><span class=s2>&#34;col&#34;</span><span class=p>:</span> <span class=n>col</span><span class=p>,</span><span class=s2>&#34;startijkl&#34;</span><span class=p>:</span> <span class=n>startijkl</span><span class=p>,</span><span class=s2>&#34;solutions&#34;</span><span class=p>:</span> <span class=mi>0</span> <span class=p>})</span>
    <span class=k>return</span> <span class=n>constellations</span>

  <span class=k>def</span> <span class=nf>load_or_build_constellations_txt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl_list</span><span class=p>:</span> <span class=n>Set</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span><span class=n>constellations</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]:</span>
    <span class=s2>&#34;&#34;&#34;TXTキャッシュを読み込み、壊れていれば再生成して保存して返すラッパ。&#34;&#34;&#34;</span>
    <span class=n>fname</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;constellations_N</span><span class=si>{</span><span class=n>N</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>preset_queens</span><span class=si>}</span><span class=s2>.txt&#34;</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_exists</span><span class=p>(</span><span class=n>fname</span><span class=p>):</span>
      <span class=k>try</span><span class=p>:</span>
        <span class=n>constellations</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>load_constellations_txt</span><span class=p>(</span><span class=n>fname</span><span class=p>)</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>validate_constellation_list</span><span class=p>(</span><span class=n>constellations</span><span class=p>):</span>
          <span class=k>return</span> <span class=n>constellations</span>
        <span class=k>else</span><span class=p>:</span>
          <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[警告] 不正なキャッシュ形式: </span><span class=si>{</span><span class=n>fname</span><span class=si>}</span><span class=s2> を再生成します&#34;</span><span class=p>)</span>
      <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[警告] キャッシュ読み込み失敗: </span><span class=si>{</span><span class=n>fname</span><span class=si>}</span><span class=s2>,理由: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
    <span class=n>constellations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]</span><span class=o>=</span><span class=p>[]</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>gen_constellations</span><span class=p>(</span><span class=n>ijkl_list</span><span class=p>,</span><span class=n>constellations</span><span class=p>,</span><span class=n>N</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>save_constellations_txt</span><span class=p>(</span><span class=n>fname</span><span class=p>,</span><span class=n>constellations</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>constellations</span>

  <span class=k>def</span> <span class=nf>set_pre_queens_cached</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>k</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>l</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>queens</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>LD</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>RD</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>counter</span><span class=p>:</span><span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span><span class=n>constellations</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]],</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>visited</span><span class=p>:</span><span class=n>Set</span><span class=p>[</span><span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;set_pre_queens() に StateKey キャッシュを噛ませたラッパ。
</span><span class=s2>    効果:
</span><span class=s2>        同一状態の再実行をスキップして生成時間を短縮。
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>key</span><span class=p>:</span><span class=n>StateKey</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>row</span><span class=p>,</span><span class=n>queens</span><span class=p>,</span><span class=n>LD</span><span class=p>,</span><span class=n>RD</span><span class=p>,</span><span class=n>N</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>subconst_cache</span><span class=p>:</span>
      <span class=c1># 以前に同じ状態で生成済み → 何もしない（または再利用）</span>
      <span class=k>return</span>
    <span class=c1># 新規実行（従来通りset_pre_queensの本体処理へ）</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>set_pre_queens</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>row</span><span class=p>,</span><span class=n>queens</span><span class=p>,</span><span class=n>LD</span><span class=p>,</span><span class=n>RD</span><span class=p>,</span><span class=n>counter</span><span class=p>,</span><span class=n>constellations</span><span class=p>,</span><span class=n>N</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>,</span><span class=n>visited</span><span class=p>)</span>
    <span class=c1># self.subconst_cache[key]=True  # マークだけでOK</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>subconst_cache</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>zobrist_hash</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>queens</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>k</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>l</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>LD</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>RD</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;Zobrist ハッシュ (64bit) を計算して返す。
</span><span class=s2>    説明:
</span><span class=s2>        各ビット集合（ld/rd/col/LD/RD）を N-bit に正規化した上で、
</span><span class=s2>        立っているビット位置ごとにテーブル値を XOR。行(row)/個数(queens)/k/l も反映。
</span><span class=s2>    注意:
</span><span class=s2>        必ず N-bit マスクを事前適用（負数や上位ビット汚染を回避）。
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>_init_zobrist</span><span class=p>(</span><span class=n>N</span><span class=p>)</span>
    <span class=n>tbl</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>zobrist_tables</span><span class=p>[</span><span class=n>N</span><span class=p>]</span>
    <span class=n>h</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>mask</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span>
    <span class=c1># ★ ここが重要：Nビットに揃える（負数や上位ビットを落とす）</span>
    <span class=n>ld</span> <span class=o>&amp;=</span> <span class=n>mask</span>
    <span class=n>rd</span> <span class=o>&amp;=</span> <span class=n>mask</span>
    <span class=n>col</span> <span class=o>&amp;=</span> <span class=n>mask</span>
    <span class=n>LD</span> <span class=o>&amp;=</span> <span class=n>mask</span>
    <span class=n>RD</span> <span class=o>&amp;=</span> <span class=n>mask</span>
    <span class=c1># 以下はそのまま</span>
    <span class=n>m</span><span class=o>=</span><span class=n>ld</span><span class=p>;</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>h</span> <span class=o>^=</span> <span class=n>tbl</span><span class=p>[</span><span class=s1>&#39;ld&#39;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span>
      <span class=n>m</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span><span class=o>+=</span><span class=mi>1</span>
    <span class=n>m</span><span class=o>=</span><span class=n>rd</span><span class=p>;</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>h</span> <span class=o>^=</span> <span class=n>tbl</span><span class=p>[</span><span class=s1>&#39;rd&#39;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span>
      <span class=n>m</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span><span class=o>+=</span><span class=mi>1</span>
    <span class=n>m</span><span class=o>=</span><span class=n>col</span><span class=p>;</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>h</span> <span class=o>^=</span> <span class=n>tbl</span><span class=p>[</span><span class=s1>&#39;col&#39;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span>
      <span class=n>m</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span><span class=o>+=</span><span class=mi>1</span>
    <span class=n>m</span><span class=o>=</span><span class=n>LD</span><span class=p>;</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>h</span> <span class=o>^=</span> <span class=n>tbl</span><span class=p>[</span><span class=s1>&#39;LD&#39;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span>
      <span class=n>m</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span><span class=o>+=</span><span class=mi>1</span>
    <span class=n>m</span><span class=o>=</span><span class=n>RD</span><span class=p>;</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=o>&amp;</span><span class=mi>1</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>h</span> <span class=o>^=</span> <span class=n>tbl</span><span class=p>[</span><span class=s1>&#39;RD&#39;</span><span class=p>][</span><span class=n>i</span><span class=p>]</span>
      <span class=n>m</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span><span class=o>+=</span><span class=mi>1</span>
    <span class=k>if</span> <span class=mi>0</span><span class=o>&lt;=</span><span class=n>row</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>     <span class=n>h</span> <span class=o>^=</span> <span class=n>tbl</span><span class=p>[</span><span class=s1>&#39;row&#39;</span><span class=p>][</span><span class=n>row</span><span class=p>]</span>
    <span class=k>if</span> <span class=mi>0</span><span class=o>&lt;=</span><span class=n>queens</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>  <span class=n>h</span> <span class=o>^=</span> <span class=n>tbl</span><span class=p>[</span><span class=s1>&#39;queens&#39;</span><span class=p>][</span><span class=n>queens</span><span class=p>]</span>
    <span class=k>if</span> <span class=mi>0</span><span class=o>&lt;=</span><span class=n>k</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>       <span class=n>h</span> <span class=o>^=</span> <span class=n>tbl</span><span class=p>[</span><span class=s1>&#39;k&#39;</span><span class=p>][</span><span class=n>k</span><span class=p>]</span>
    <span class=k>if</span> <span class=mi>0</span><span class=o>&lt;=</span><span class=n>l</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>       <span class=n>h</span> <span class=o>^=</span> <span class=n>tbl</span><span class=p>[</span><span class=s1>&#39;l&#39;</span><span class=p>][</span><span class=n>l</span><span class=p>]</span>
    <span class=k>return</span> <span class=n>h</span><span class=o>&amp;</span><span class=n>MASK64</span>

  <span class=k>def</span> <span class=nf>state_hash</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>queens</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>k</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>l</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>LD</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>RD</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;O(1) の軽量ハッシュ（探索の高速枝刈り用）。
</span><span class=s2>    使い分け:
</span><span class=s2>        - 衝突耐性重視: zobrist_hash()
</span><span class=s2>        - 速度/省メモリ重視: state_hash()（この実装）
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=c1># [Opt-09] Zobrist Hash（Opt-09）の導入とその用途</span>
    <span class=c1># ビットボード設計でも、「盤面のハッシュ」→「探索済みフラグ」で枝刈りは可能です。</span>
    <span class=k>return</span> <span class=p>(</span><span class=n>ld</span><span class=o>&lt;&lt;</span><span class=mi>3</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>rd</span><span class=o>&lt;&lt;</span><span class=mi>2</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>col</span><span class=o>&lt;&lt;</span><span class=mi>1</span><span class=p>)</span> <span class=o>^</span> <span class=n>row</span> <span class=o>^</span> <span class=p>(</span><span class=n>queens</span><span class=o>&lt;&lt;</span><span class=mi>7</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>k</span><span class=o>&lt;&lt;</span><span class=mi>12</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>l</span><span class=o>&lt;&lt;</span><span class=mi>17</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>LD</span><span class=o>&lt;&lt;</span><span class=mi>22</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>RD</span><span class=o>&lt;&lt;</span><span class=mi>27</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>N</span><span class=o>&lt;&lt;</span><span class=mi>1</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>set_pre_queens</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>k</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>l</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>queens</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>LD</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>RD</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>counter</span><span class=p>:</span><span class=nb>list</span><span class=p>,</span><span class=n>constellations</span><span class=p>:</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]],</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>visited</span><span class=p>:</span><span class=n>Set</span><span class=p>[</span><span class=nb>int</span><span class=p>])</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;開始コンステレーション（preset_queens 個のクイーン配置）を再帰的に列挙する。
</span><span class=s2>    振る舞い:
</span><span class=s2>        - row が k/l の行はスキップ（必置行）
</span><span class=s2>        - queens == preset_queens で現状態を constellations に push
</span><span class=s2>        - free = ~(ld|rd|col|(LD&gt;&gt;(N-1-row))|(RD&lt;&lt;(N-1-row))) &amp; ((1&lt;&lt;N)-1)
</span><span class=s2>          の各ビットにクイーンを立てながら深掘り
</span><span class=s2>    最適化:
</span><span class=s2>        - visited に state_hash を登録し、再訪を枝刈り
</span><span class=s2>        - constellation_signatures で (ld,rd,col,k,l,row) 重複を抑止
</span><span class=s2>    出力:
</span><span class=s2>        counter[0] に生成件数を加算、constellations に辞書を追加（startijkl は後で付与）
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>mask</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span>  <span class=c1># setPreQueensで使用</span>
    <span class=c1># 状態ハッシュによる探索枝の枝刈り バックトラック系の冒頭に追加　やりすぎると解が合わない</span>
    <span class=c1>#</span>
    <span class=c1># zobrist_hash</span>
    <span class=c1># 各ビットを見てテーブルから XOR するため O(N)（ld/rd/col/LD/RDそれぞれで最大 N 回）。</span>
    <span class=c1># とはいえ N≤17 なのでコストは小さめ。衝突耐性は高い。</span>
    <span class=c1># マスク漏れや負数の扱いを誤ると不一致が起きる点に注意（先ほどの&amp;((1&lt;&lt;N)-1) 修正で解決）。</span>
    <span class=c1># h:int=self.zobrist_hash(ld,rd,col,row,queens,k,l,LD,RD,N)</span>
    <span class=c1>#</span>
    <span class=c1># state_hash</span>
    <span class=c1># その場で数個の ^ と&lt;&lt;を混ぜるだけの O(1) 計算。</span>
    <span class=c1># 生成されるキーも 単一の int なので、set/dict の操作が最速＆省メモリ。</span>
    <span class=c1># ただし理論上は衝突し得ます（実際はN≤17の範囲なら実害が出にくい設計にしていればOK）。</span>
    <span class=n>h</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>state_hash</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>row</span><span class=p>,</span><span class=n>queens</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>LD</span><span class=p>,</span><span class=n>RD</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>h</span> <span class=ow>in</span> <span class=n>visited</span><span class=p>:</span>
      <span class=k>return</span>
    <span class=n>visited</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>h</span><span class=p>)</span>
    <span class=c1>#</span>
    <span class=c1># StateKey（タプル）</span>
    <span class=c1># 11個の整数オブジェクトを束ねるため、オブジェクト生成・GC負荷・ハッシュ合成が最も重い。</span>
    <span class=c1># set の比較・保持も重く、メモリも一番食います。</span>
    <span class=c1># 衝突はほぼ心配ないものの、速度とメモリ効率は最下位。</span>
    <span class=c1># key: StateKey=(ld,rd,col,row,queens,k,l,LD,RD)</span>
    <span class=c1># if key in visited:</span>
    <span class=c1>#     return</span>
    <span class=c1># visited.add(key)</span>

    <span class=c1># ----------------------------</span>
    <span class=c1># k行とl行はスキップ</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>k</span> <span class=ow>or</span> <span class=n>row</span><span class=o>==</span><span class=n>l</span><span class=p>:</span>
      <span class=c1># self.set_pre_queens(ld&lt;&lt;1,rd&gt;&gt;1,col,k,l,row+1,queens,LD,RD,counter,constellations,N,preset_queens,visited)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>set_pre_queens_cached</span><span class=p>(</span><span class=n>ld</span><span class=o>&lt;&lt;</span><span class=mi>1</span><span class=p>,</span><span class=n>rd</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>queens</span><span class=p>,</span><span class=n>LD</span><span class=p>,</span><span class=n>RD</span><span class=p>,</span><span class=n>counter</span><span class=p>,</span><span class=n>constellations</span><span class=p>,</span><span class=n>N</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>,</span><span class=n>visited</span><span class=p>)</span>
      <span class=k>return</span>
    <span class=c1># クイーンの数がpreset_queensに達した場合、現在の状態を保存</span>
    <span class=c1># ------------------------------------------------</span>
    <span class=c1># 3. 星座のsignature重複防止</span>
    <span class=c1>#</span>
    <span class=c1># if queens==preset_queens:</span>
    <span class=c1>#   constellation= {&#34;ld&#34;: ld,&#34;rd&#34;: rd,&#34;col&#34;: col,&#34;startijkl&#34;: row&lt;&lt;20,&#34;solutions&#34;:0}</span>
    <span class=c1>#   # 新しいコンステレーションをリストに追加</span>
    <span class=c1>#   constellations.append(constellation)</span>
    <span class=c1>#   counter[0]+=1</span>
    <span class=c1>#   return</span>
    <span class=k>if</span> <span class=n>queens</span><span class=o>==</span><span class=n>preset_queens</span><span class=p>:</span>
      <span class=c1># signatureの生成</span>
      <span class=n>signature</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>row</span><span class=p>)</span>  <span class=c1># 必要な変数でOK</span>
      <span class=c1># signaturesセットをクラス変数やグローバルで管理</span>
      <span class=k>if</span> <span class=ow>not</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=s2>&#34;constellation_signatures&#34;</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>constellation_signatures</span><span class=o>=</span><span class=nb>set</span><span class=p>()</span>
      <span class=n>signatures</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>constellation_signatures</span>
      <span class=k>if</span> <span class=n>signature</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>signatures</span><span class=p>:</span>
        <span class=n>constellation</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;ld&#34;</span><span class=p>:</span> <span class=n>ld</span><span class=p>,</span><span class=s2>&#34;rd&#34;</span><span class=p>:</span> <span class=n>rd</span><span class=p>,</span><span class=s2>&#34;col&#34;</span><span class=p>:</span> <span class=n>col</span><span class=p>,</span><span class=s2>&#34;startijkl&#34;</span><span class=p>:</span> <span class=n>row</span><span class=o>&lt;&lt;</span><span class=mi>20</span><span class=p>,</span><span class=s2>&#34;solutions&#34;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>
        <span class=n>constellations</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>constellation</span><span class=p>)</span> <span class=c1>#星座データ追加</span>
        <span class=n>signatures</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>signature</span><span class=p>)</span>
        <span class=n>counter</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>+=</span><span class=mi>1</span>
      <span class=k>return</span>
    <span class=c1># 現在の行にクイーンを配置できる位置を計算</span>
    <span class=n>free</span><span class=o>=~</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>rd</span><span class=o>|</span><span class=n>col</span><span class=o>|</span><span class=p>(</span><span class=n>LD</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>row</span><span class=p>))</span><span class=o>|</span><span class=p>(</span><span class=n>RD</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>row</span><span class=p>)))</span><span class=o>&amp;</span><span class=n>mask</span>
    <span class=k>while</span> <span class=n>free</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span><span class=o>&amp;-</span><span class=n>free</span>
      <span class=n>free</span><span class=o>&amp;=</span><span class=n>free</span><span class=o>-</span><span class=mi>1</span>
      <span class=c1># クイーンを配置し、次の行に進む</span>
      <span class=c1># self.set_pre_queens((ld|bit)&lt;&lt;1,(rd|bit)&gt;&gt;1,col|bit,k,l,row+1,queens+1,LD,RD,counter,constellations,N,preset_queens,visited)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>set_pre_queens_cached</span><span class=p>((</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span><span class=p>,(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>,</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>queens</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>LD</span><span class=p>,</span><span class=n>RD</span><span class=p>,</span><span class=n>counter</span><span class=p>,</span><span class=n>constellations</span><span class=p>,</span><span class=n>N</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>,</span><span class=n>visited</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>exec_solutions</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>constellations</span><span class=p>:</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]],</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;各コンステレーションに対して最適な SQ... 再帰ソルバを選び、解数を計算して書き込む。
</span><span class=s2>    仕組み:
</span><span class=s2>        - startijkl から j,k,l 等を復元し、境界条件/位置関係に応じて SQ... 関数を選択
</span><span class=s2>        - 返値 cnt に symmetry(ijkl,N) を掛けて constellation[&#39;solutions&#39;] に格納
</span><span class=s2>    注意:
</span><span class=s2>        - board_mask は (1&lt;&lt;N)-1 を用いる（上位ビット汚染注意）
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=c1># jmark=j=k=l=ijkl=ld=rd=col=start_ijkl=start=free=LD=endmark=mark1=mark2=0</span>
    <span class=n>N2</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>2</span>
    <span class=n>small_mask</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N2</span><span class=p>))</span><span class=o>-</span><span class=mi>1</span>
    <span class=n>temp_counter</span><span class=o>=</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
    <span class=n>cnt</span><span class=o>=</span><span class=mi>0</span>
    <span class=c1># board_mask の値が 1 ビット足りない</span>
    <span class=c1># board_mask:int=(1&lt;&lt;(N-1))-1</span>
    <span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span>
    <span class=nd>@par</span>
    <span class=k>for</span> <span class=n>constellation</span> <span class=ow>in</span> <span class=n>constellations</span><span class=p>:</span>
      <span class=c1># mark1,mark2=mark1,mark2</span>
      <span class=n>jmark</span><span class=o>=</span><span class=n>mark1</span><span class=o>=</span><span class=n>mark2</span><span class=o>=</span><span class=mi>0</span>
      <span class=n>start_ijkl</span><span class=o>=</span><span class=n>constellation</span><span class=p>[</span><span class=s2>&#34;startijkl&#34;</span><span class=p>]</span>
      <span class=n>start</span><span class=o>=</span><span class=n>start_ijkl</span><span class=o>&gt;&gt;</span><span class=mi>20</span>
      <span class=n>ijkl</span><span class=o>=</span><span class=n>start_ijkl</span><span class=o>&amp;</span><span class=p>((</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=mi>20</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
      <span class=n>j</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>(</span><span class=n>ijkl</span><span class=p>),</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span><span class=p>(</span><span class=n>ijkl</span><span class=p>)</span>
      <span class=c1># 左右対角線と列の占有状況を設定</span>
      <span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=o>=</span><span class=n>constellation</span><span class=p>[</span><span class=s2>&#34;ld&#34;</span><span class=p>]</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>,</span><span class=n>constellation</span><span class=p>[</span><span class=s2>&#34;rd&#34;</span><span class=p>]</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>,(</span><span class=n>constellation</span><span class=p>[</span><span class=s2>&#34;col&#34;</span><span class=p>]</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>)</span><span class=o>|</span><span class=p>(</span><span class=o>~</span><span class=n>small_mask</span><span class=p>)</span>
      <span class=n>LD</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>j</span><span class=p>))</span><span class=o>|</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>l</span><span class=p>))</span>
      <span class=n>ld</span><span class=o>|=</span><span class=n>LD</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=n>start</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>start</span><span class=o>&gt;</span><span class=n>k</span><span class=p>:</span>
        <span class=n>rd</span><span class=o>|=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=p>(</span><span class=n>start</span><span class=o>-</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)))</span>
      <span class=k>if</span> <span class=n>j</span> <span class=o>&gt;=</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>N</span><span class=o>-</span><span class=mi>33</span><span class=o>-</span><span class=n>start</span><span class=p>:</span>
        <span class=n>rd</span><span class=o>|=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>j</span><span class=p>))</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N2</span><span class=o>-</span><span class=n>start</span><span class=p>)</span>
      <span class=n>free</span><span class=o>=~</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>rd</span><span class=o>|</span><span class=n>col</span><span class=p>)</span>
      <span class=c1># 各ケースに応じた処理</span>
      <span class=k>if</span> <span class=n>j</span><span class=o>&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span><span class=p>):</span>
        <span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=o>=</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>N2</span>
        <span class=k>if</span> <span class=n>j</span><span class=o>&gt;</span><span class=mi>2</span> <span class=o>*</span> <span class=n>N</span><span class=o>-</span><span class=mi>34</span><span class=o>-</span><span class=n>start</span><span class=p>:</span>
          <span class=k>if</span> <span class=n>k</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>
            <span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=o>=</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span>
            <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>
              <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>k</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>l</span><span class=o>!=</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>:</span>
                  <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBkBlBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
                <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBklBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
              <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBlBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
          <span class=k>else</span><span class=p>:</span>
            <span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=o>=</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span>
            <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>k</span><span class=p>:</span>
              <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>k</span><span class=o>!=</span><span class=n>l</span><span class=o>+</span><span class=mi>1</span><span class=p>:</span>
                  <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBlBkBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
                <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBlkBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
              <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBkBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
          <span class=k>if</span> <span class=n>k</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>
            <span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=o>=</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span>
            <span class=k>if</span> <span class=n>l</span><span class=o>!=</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>:</span>
              <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjlBkBlBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjlBklBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
          <span class=k>else</span><span class=p>:</span>
            <span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=o>=</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span>
            <span class=k>if</span> <span class=n>k</span> <span class=o>!=</span> <span class=n>l</span><span class=o>+</span><span class=mi>1</span><span class=p>:</span>
              <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjlBlBkBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjlBlkBjrB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>elif</span> <span class=n>j</span><span class=o>==</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span><span class=p>):</span>
        <span class=n>endmark</span><span class=o>=</span><span class=n>N2</span>
        <span class=k>if</span> <span class=n>k</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>
          <span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=o>=</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span>
          <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>k</span><span class=p>:</span>
              <span class=k>if</span> <span class=n>l</span> <span class=o>!=</span> <span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BkBlB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
              <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BklB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
              <span class=n>mark2</span><span class=o>=</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span>
              <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BlB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
          <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2B</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
          <span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=o>=</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span>
          <span class=n>endmark</span><span class=o>=</span><span class=n>N2</span>
          <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>k</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>
              <span class=k>if</span> <span class=n>k</span> <span class=o>!=</span> <span class=n>l</span><span class=o>+</span><span class=mi>1</span><span class=p>:</span>
                <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BlBkB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
              <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BlkB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
              <span class=n>mark2</span><span class=o>=</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span>
              <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BkB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
          <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2B</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>elif</span> <span class=n>j</span><span class=o>==</span><span class=n>N2</span><span class=p>:</span> <span class=c1># クイーンjがコーナーからちょうど1列離れている場合</span>
        <span class=k>if</span> <span class=n>k</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>  <span class=c1># kが最初になることはない、lはクイーンの配置の関係で最後尾にはなれない</span>
          <span class=n>endmark</span><span class=o>=</span><span class=n>N2</span>
          <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>  <span class=c1># 少なくともlがまだ来ていない場合</span>
            <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>k</span><span class=p>:</span>  <span class=c1># もしkもまだ来ていないなら</span>
              <span class=n>mark1</span><span class=o>=</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span>
              <span class=k>if</span> <span class=n>l</span> <span class=o>!=</span> <span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>:</span>  <span class=c1># kとlが隣り合っている場合</span>
                <span class=n>mark2</span><span class=o>=</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span>
                <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BkBlB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
              <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BklB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>  <span class=c1># lがまだ来ていないなら</span>
              <span class=n>mark2</span><span class=o>=</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span>
              <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BlB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
          <span class=c1># すでにkとlが来ている場合</span>
          <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1B</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>  <span class=c1># l&lt;k</span>
          <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>k</span><span class=p>:</span>  <span class=c1># 少なくともkがまだ来ていない場合</span>
            <span class=k>if</span> <span class=n>start</span><span class=o>&lt;</span><span class=n>l</span><span class=p>:</span>  <span class=c1># lがまだ来ていない場合</span>
              <span class=k>if</span> <span class=n>k</span><span class=o>&lt;</span><span class=n>N2</span><span class=p>:</span>  <span class=c1># kが末尾にない場合</span>
                <span class=n>mark1</span><span class=p>,</span><span class=n>endmark</span><span class=o>=</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>N2</span>
                <span class=k>if</span> <span class=n>k</span> <span class=o>!=</span> <span class=n>l</span><span class=o>+</span><span class=mi>1</span><span class=p>:</span>  <span class=c1># lとkの間に空行がある場合</span>
                  <span class=n>mark2</span><span class=o>=</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span>
                  <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BlBkB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
                <span class=c1># lとkの間に空行がない場合</span>
                <span class=k>else</span><span class=p>:</span> <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BlkB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
              <span class=k>else</span><span class=p>:</span>  <span class=c1># kが末尾の場合</span>
                <span class=k>if</span> <span class=n>l</span> <span class=o>!=</span> <span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span><span class=p>):</span>  <span class=c1># lがkの直前でない場合</span>
                  <span class=n>mark2</span><span class=p>,</span><span class=n>endmark</span><span class=o>=</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
                  <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BlB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
                <span class=k>else</span><span class=p>:</span>  <span class=c1># lがkの直前にある場合</span>
                  <span class=n>endmark</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>4</span>
                  <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1B</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>  <span class=c1># もしkがまだ来ていないなら</span>
              <span class=k>if</span> <span class=n>k</span> <span class=o>!=</span> <span class=n>N2</span><span class=p>:</span>  <span class=c1># kが末尾にない場合</span>
                <span class=n>mark2</span><span class=p>,</span><span class=n>endmark</span><span class=o>=</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>N2</span>
                <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BkB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
              <span class=k>else</span><span class=p>:</span>  <span class=c1># kが末尾の場合</span>
                <span class=n>endmark</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
                <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1B</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
          <span class=k>else</span><span class=p>:</span> <span class=c1># kとlはスタートの前</span>
            <span class=n>endmark</span><span class=o>=</span><span class=n>N2</span>
            <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1B</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>else</span><span class=p>:</span>  <span class=c1># クイーンjがコーナーに置かれている場合</span>
        <span class=n>endmark</span><span class=o>=</span><span class=n>N2</span>
        <span class=k>if</span> <span class=n>start</span><span class=o>&gt;</span><span class=n>k</span><span class=p>:</span>
          <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd0B</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span> <span class=c1># クイーンをコーナーに置いて星座を組み立てる方法と、ジャスミンを適用する方法</span>
          <span class=n>mark1</span><span class=o>=</span><span class=n>k</span><span class=o>-</span><span class=mi>1</span>
          <span class=n>cnt</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd0BkB</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>start</span><span class=p>,</span><span class=n>free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># 各コンステレーションのソリューション数を更新</span>
      <span class=c1># constellation[&#34;solutions&#34;]=temp_counter[0] * self.symmetry(ijkl,N)</span>
      <span class=n>constellation</span><span class=p>[</span><span class=s2>&#34;solutions&#34;</span><span class=p>]</span><span class=o>=</span><span class=n>cnt</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>symmetry</span><span class=p>(</span><span class=n>ijkl</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># temp_counter[0]=0</span>

  <span class=k>def</span> <span class=nf>gen_constellations</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ijkl_list</span><span class=p>:</span><span class=n>Set</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span><span class=n>constellations</span><span class=p>:</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]],</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;開始コンステレーションの代表集合を生成（回転・ミラー重複排除込み）。
</span><span class=s2>
</span><span class=s2>    ステップ:
</span><span class=s2>        1) (i,j,k,l) を厳密順序で走査し、回転重複は check_rotations() で除去
</span><span class=s2>        2) 奇数Nは中央列を特別扱い（Opt-03）
</span><span class=s2>        3) jasmin()（get_jasmin）で標準形に写像 → ijkl_list を正規化
</span><span class=s2>        4) 各 signature に対し set_pre_queens_cached() でサブ星座を列挙
</span><span class=s2>        5) 列挙結果の &#39;startijkl&#39; に基底 to_ijkl(i,j,k,l) を OR 付与
</span><span class=s2>    出力:
</span><span class=s2>        constellations に {ld,rd,col,startijkl,solutions} の辞書を詰める
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>halfN</span><span class=o>=</span><span class=p>(</span><span class=n>N</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>//</span><span class=mi>2</span>  <span class=c1># Nの半分を切り上げ</span>
    <span class=c1># --- [Opt-03] 中央列特別処理（奇数Nの場合のみ） ---</span>
    <span class=k>if</span> <span class=n>N</span> <span class=o>%</span> <span class=mi>2</span><span class=o>==</span><span class=mi>1</span><span class=p>:</span>
      <span class=n>center</span><span class=o>=</span><span class=n>N</span> <span class=o>//</span> <span class=mi>2</span>
      <span class=n>ijkl_list</span><span class=o>.</span><span class=n>update</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>to_ijkl</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>center</span><span class=p>,</span><span class=n>l</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>l</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>center</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>center</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>i</span> <span class=o>!=</span> <span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>-</span><span class=n>l</span>
        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=n>center</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>j</span> <span class=o>!=</span> <span class=n>i</span> <span class=ow>and</span> <span class=n>j</span> <span class=o>!=</span> <span class=n>l</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_rotations</span><span class=p>(</span><span class=n>ijkl_list</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>center</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
        <span class=c1># 180°回転盤面がセットに含まれていない</span>
        <span class=c1># if not self.rot180_in_set(ijkl_list,i,j,center,l,N)</span>
      <span class=p>)</span>
    <span class=c1># --- [Opt-03] 中央列特別処理（奇数Nの場合のみ） ---</span>
    <span class=c1># コーナーにクイーンがいない場合の開始コンステレーションを計算する</span>
    <span class=n>ijkl_list</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>to_ijkl</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>)</span> <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>halfN</span><span class=p>)</span> <span class=k>for</span> <span class=n>l</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=k>if</span> <span class=n>i</span> <span class=o>!=</span> <span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>-</span><span class=n>l</span> <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=n>k</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=k>if</span> <span class=n>j</span><span class=o>!=</span><span class=n>i</span> <span class=ow>and</span> <span class=n>j</span><span class=o>!=</span><span class=n>l</span> <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>check_rotations</span><span class=p>(</span><span class=n>ijkl_list</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>N</span><span class=p>))</span>
    <span class=c1># コーナーにクイーンがある場合の開始コンステレーションを計算する</span>
    <span class=n>ijkl_list</span><span class=o>.</span><span class=n>update</span><span class=p>({</span><span class=bp>self</span><span class=o>.</span><span class=n>to_ijkl</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>l</span><span class=p>)</span> <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>N</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span> <span class=k>for</span> <span class=n>l</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>)})</span>
    <span class=c1># Jasmin変換</span>
    <span class=c1># ijkl_list_jasmin={self.jasmin(c,N) for c in ijkl_list}</span>
    <span class=c1># ijkl_list_jasmin={self.get_jasmin(c,N) for c in ijkl_list}</span>
    <span class=c1># ijkl_list=ijkl_list_jasmin</span>
    <span class=n>ijkl_list</span><span class=o>=</span><span class=p>{</span><span class=bp>self</span><span class=o>.</span><span class=n>get_jasmin</span><span class=p>(</span><span class=n>c</span><span class=p>,</span><span class=n>N</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>ijkl_list</span><span class=p>}</span>
    <span class=n>L</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># Lは左端に1を立てる</span>
    <span class=c1># ローカルアクセスに変更</span>
    <span class=n>geti</span><span class=p>,</span><span class=n>getj</span><span class=p>,</span><span class=n>getk</span><span class=p>,</span><span class=n>getl</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>geti</span><span class=p>,</span><span class=bp>self</span><span class=o>.</span><span class=n>getj</span><span class=p>,</span><span class=bp>self</span><span class=o>.</span><span class=n>getk</span><span class=p>,</span><span class=bp>self</span><span class=o>.</span><span class=n>getl</span>
    <span class=n>to_ijkl</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>to_ijkl</span>
    <span class=k>for</span> <span class=n>sc</span> <span class=ow>in</span> <span class=n>ijkl_list</span><span class=p>:</span>
      <span class=c1># ここで毎回クリア（＝この sc だけの重複抑止に限定）</span>
      <span class=c1># self.constellation_signatures.clear()</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>constellation_signatures</span><span class=o>=</span><span class=nb>set</span><span class=p>()</span>
      <span class=c1># i,j,k,l=self.geti(sc),self.getj(sc),self.getk(sc),self.getl(sc)</span>
      <span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=o>=</span><span class=n>geti</span><span class=p>(</span><span class=n>sc</span><span class=p>),</span><span class=n>getj</span><span class=p>(</span><span class=n>sc</span><span class=p>),</span><span class=n>getk</span><span class=p>(</span><span class=n>sc</span><span class=p>),</span><span class=n>getl</span><span class=p>(</span><span class=n>sc</span><span class=p>)</span>
      <span class=c1># ld,rd,col=(L&gt;&gt;(i-1))|(1&lt;&lt;(N-k)),(L&gt;&gt;(i+1))|(1&lt;&lt;(l-1)),1|L|(L&gt;&gt;i)|(L&gt;&gt;j)</span>
      <span class=c1># LD,RD=(L&gt;&gt;j)|(L&gt;&gt;l),(L&gt;&gt;j)|(1&lt;&lt;k)</span>
      <span class=n>Lj</span><span class=o>=</span><span class=n>L</span><span class=o>&gt;&gt;</span><span class=n>j</span><span class=p>;</span> <span class=n>Li</span><span class=o>=</span><span class=n>L</span><span class=o>&gt;&gt;</span><span class=n>i</span><span class=p>;</span> <span class=n>Ll</span><span class=o>=</span><span class=n>L</span><span class=o>&gt;&gt;</span><span class=n>l</span>
      <span class=c1># ld=(L&gt;&gt;(i-1))|(1&lt;&lt;(N-k))</span>
      <span class=n>ld</span><span class=o>=</span><span class=p>((</span><span class=n>L</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span> <span class=k>if</span> <span class=n>i</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>)</span><span class=o>|</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=n>k</span><span class=p>))</span>
      <span class=n>rd</span><span class=o>=</span><span class=p>(</span><span class=n>L</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>))</span><span class=o>|</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span>
      <span class=n>col</span><span class=o>=</span><span class=mi>1</span><span class=o>|</span><span class=n>L</span><span class=o>|</span><span class=n>Li</span><span class=o>|</span><span class=n>Lj</span>
      <span class=n>LD</span><span class=o>=</span><span class=n>Lj</span><span class=o>|</span><span class=n>Ll</span>
      <span class=n>RD</span><span class=o>=</span><span class=n>Lj</span><span class=o>|</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>k</span><span class=p>)</span>

      <span class=n>counter</span><span class=p>:</span><span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span><span class=o>=</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># サブコンステレーションを生成</span>
      <span class=c1>#-------------------------</span>
      <span class=c1># visited:Set[StateKey]=set()</span>
      <span class=n>visited</span><span class=p>:</span><span class=n>Set</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span><span class=o>=</span><span class=nb>set</span><span class=p>()</span>
      <span class=c1>#-------------------------</span>
      <span class=c1># self.set_pre_queens(ld,rd,col,k,l,1,3 if j==N-1 else 4,LD,RD,counter,constellations,N,preset_queens,visited)</span>
      <span class=bp>self</span><span class=o>.</span><span class=n>set_pre_queens_cached</span><span class=p>(</span><span class=n>ld</span><span class=p>,</span><span class=n>rd</span><span class=p>,</span><span class=n>col</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>3</span> <span class=k>if</span> <span class=n>j</span><span class=o>==</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span> <span class=k>else</span> <span class=mi>4</span><span class=p>,</span><span class=n>LD</span><span class=p>,</span><span class=n>RD</span><span class=p>,</span><span class=n>counter</span><span class=p>,</span><span class=n>constellations</span><span class=p>,</span><span class=n>N</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>,</span><span class=n>visited</span><span class=p>)</span>
      <span class=n>current_size</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>constellations</span><span class=p>)</span>
      <span class=c1># 生成されたサブコンステレーションにスタート情報を追加</span>
      <span class=c1># list(map(lambda target:target.__setitem__(&#34;startijkl&#34;,target[&#34;startijkl&#34;]|self.to_ijkl(i,j,k,l)),(constellations[current_size-a-1] for a in range(counter[0]))))</span>
      <span class=c1>#</span>
      <span class=c1># こちらのほうが少しだけ軽いらしい</span>
      <span class=c1># for a in range(counter[0]):</span>
      <span class=c1>#   constellations[-1-a][&#34;startijkl&#34;]|=self.to_ijkl(i,j,k,l)</span>
      <span class=c1>#</span>
      <span class=c1># to_ijkl(i,j,k,l) はループ外で一回だけ</span>
      <span class=c1># 今は毎回呼んでいるので、定数化すると少しだけ軽くなります。</span>
      <span class=c1># base=self.to_ijkl(i,j,k,l)</span>
      <span class=n>base</span><span class=o>=</span><span class=n>to_ijkl</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>)</span>
      <span class=k>for</span> <span class=n>a</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>counter</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
          <span class=n>constellations</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>a</span><span class=p>][</span><span class=s2>&#34;startijkl&#34;</span><span class=p>]</span><span class=o>|=</span><span class=n>base</span>

  <span class=nd>@staticmethod</span>
  <span class=k>def</span> <span class=nf>_has_future_space_step</span><span class=p>(</span><span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>extra_block_next</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;次行 row_next で少なくとも 1bit 置ける見込みがあるかを判定（短絡枝刈り）。
</span><span class=s2>    仕様:
</span><span class=s2>        - row_next &gt;= endmark の場合は True（ゴール直前）
</span><span class=s2>        - それ以外は blocked = (next_ld&lt;&lt;1)|(next_rd&gt;&gt;1)|next_col|extra_block_next を見て判定
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=c1># ゴール直前は先読み不要（短絡）</span>
    <span class=k>if</span> <span class=n>row_next</span> <span class=o>&gt;=</span> <span class=n>endmark</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>True</span>
    <span class=n>blocked_next</span><span class=o>=</span><span class=p>(</span><span class=n>next_ld</span><span class=o>&lt;&lt;</span><span class=mi>1</span><span class=p>)</span><span class=o>|</span><span class=p>(</span><span class=n>next_rd</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>)</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>extra_block_next</span>
    <span class=k>return</span> <span class=p>(</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked_next</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span>

  <span class=nd>@staticmethod</span>
  <span class=k>def</span> <span class=nf>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;次行に入るときに適用すべき“追加遮蔽”ビットを返す（k/l/j の固定影響をモデル化）。
</span><span class=s2>
</span><span class=s2>    仕様:
</span><span class=s2>        - row_next == mark1 or mark2: (1&lt;&lt;(N-3)) を追加（blockK 相当）
</span><span class=s2>        - row_next == (N-1-jmark): (1&lt;&lt;(N-1)) を追加（j行系）
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>extra</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>blockK</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span><span class=p>)</span>  <span class=c1># あなたのロジックに合わせて blockL 等も別にするなら拡張</span>
    <span class=k>if</span> <span class=n>row_next</span><span class=o>==</span><span class=n>mark1</span><span class=p>:</span>
        <span class=n>extra</span><span class=o>|=</span><span class=n>blockK</span>
    <span class=k>if</span> <span class=n>row_next</span><span class=o>==</span><span class=n>mark2</span><span class=p>:</span>
        <span class=n>extra</span><span class=o>|=</span><span class=n>blockK</span>
    <span class=k>if</span> <span class=n>row_next</span><span class=o>==</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=o>-</span><span class=n>jmark</span><span class=p>):</span>  <span class=c1># jmark 系ありの関数だけ使う</span>
        <span class=n>extra</span><span class=o>|=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>extra</span>

  <span class=k>def</span> <span class=nf>_should_go_plus1</span><span class=p>(</span> <span class=bp>self</span><span class=p>,</span><span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>extra</span><span class=p>:</span><span class=nb>int</span><span class=p>,)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;次行へ進む前に“行っても無駄にならないか”を先読み判定する薄いラッパ。&#34;&#34;&#34;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>False</span>
    <span class=k>if</span> <span class=n>row_next</span> <span class=o>&gt;=</span> <span class=n>endmark</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>True</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_has_future_space_step</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>)</span>

  <span class=k>def</span> <span class=nf>SQd0B</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;行指向の再帰探索（分岐版）。行ごとに 1bit（クイーン）を選んで次へ進む。
</span><span class=s2>    共通引数:
</span><span class=s2>        ld, rd, col (int): 左/右対角線・列のビット占有。次行遷移で &lt;&lt;1 / &gt;&gt;1 を付与。
</span><span class=s2>        row (int): 現在の行インデックス。
</span><span class=s2>        free (int): 現行行で置ける位置のビット集合（board_mask &amp; ~blocked）。
</span><span class=s2>        jmark, endmark (int): 特殊行 j の目印 / ゴール直前行の目印（最深行）。
</span><span class=s2>        mark1, mark2 (int): 事前固定行（k,l 起因）の“追加ブロック”適用行。
</span><span class=s2>        board_mask (int): 盤サイズ N の Nbit マスク((1&lt;&lt;N)-1)。
</span><span class=s2>        N (int): 盤面サイズ。
</span><span class=s2>
</span><span class=s2>    共通ロジック:
</span><span class=s2>        - avail の最下位ビットを取り出して配置 → 次行へ（ld&lt;&lt;1 / rd&gt;&gt;1 / col|bit）
</span><span class=s2>        - _extra_block_for_row() で次行に入るときの追加遮蔽（k/l/jの固定影響）を考慮
</span><span class=s2>        - _should_go_plus1() で「次行に少なくとも1bit置ける見込みか」を先読みして枝刈り
</span><span class=s2>        - 行末(endmark)到達で 1 返し、和を積算
</span><span class=s2>
</span><span class=s2>    命名規則のヒント:
</span><span class=s2>        SQ[d?][B?][k?][l?][jr?]B
</span><span class=s2>          d0/d1/d2 : コーナー距離/ケース種別（exec_solutions の分岐条件に対応）
</span><span class=s2>          k / l    : 固定行の通過タイミング（mark1/mark2 が効く）
</span><span class=s2>          jr       : j 行（コーナー相対の特別行）を即時処理するバリアント
</span><span class=s2>          B        : “Bitboard step（再帰）”の意味的接尾辞
</span><span class=s2>
</span><span class=s2>    # 例: SQd0B …… d0ケースのベース版（特殊行処理なしの基本遷移）
</span><span class=s2>    # 例: SQd0BkB …… d0 + k固定行をヒットしたら 2行スキップで進める版
</span><span class=s2>    # 例: SQd1B …… d1ケースのベース版。endmark 到達で 1 を返す。
</span><span class=s2>    # 例: SQBjrB …… j 行に入ったら列0をマスクして即時処理する版
</span><span class=s2>    # 例: SQBjlBkBlBjrB …… j行を“1行前倒し”で処理しつつ、l→k 順の固定行考慮版
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>endmark</span><span class=p>:</span>
      <span class=k>return</span> <span class=mi>1</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>_extra_block_for_row</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span>
    <span class=n>_should_go_plus1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free and ((row+1 &gt;= endmark) or self._has_future_space(next_ld,next_rd,next_col,board_mask)):</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   total+=self.SQd0B(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
      <span class=c1># if next_free:</span>
      <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
      <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1># if row_next==mark1:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1># if row_next==mark2:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=n>extra</span><span class=o>=</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
      <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd0B</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd0BkB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd0B</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd0BkB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd0BkB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd1BklB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N4</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>4</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N4</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>3</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>3</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=mi>1</span><span class=o>|</span><span class=n>blockK</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1B</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>1</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BklB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd1BklB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd1B</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>endmark</span><span class=p>:</span>
      <span class=k>return</span> <span class=mi>1</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>_extra_block_for_row</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span>
    <span class=n>_should_go_plus1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free :</span>
      <span class=c1>#   total+=self.SQd1B(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
      <span class=c1># if next_free:</span>
      <span class=c1># row_next:int=row+1</span>
      <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1># if row_next==mark1:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1># if row_next==mark2:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
      <span class=n>extra</span><span class=o>=</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
      <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1B</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd1BkBlB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=c1># _extra_block_for_row=self._extra_block_for_row</span>
    <span class=c1># _should_go_plus1=self._should_go_plus1</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BlB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
      <span class=c1># row_next:int=row+1</span>
      <span class=c1># extra=_extra_block_for_row(row_next,mark1,mark2,jmark,N)</span>
      <span class=c1># if _should_go_plus1(next_free,row_next,endmark,next_ld,next_rd,next_col,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BkBlB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd1BkBlB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd1BlB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark2</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span><span class=o>|</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free and ((row+2 &gt;= endmark) or self._has_future_space(next_ld,next_rd,next_col,board_mask)):</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1B</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BlB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd1BlB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd1BlkB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>3</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>3</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=mi>2</span><span class=o>|</span><span class=n>blockK</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1B</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>2</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BlkB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd1BlkB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd1BlBkB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=mi>1</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BkB</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>1</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BlBkB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd1BlBkB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd1BkB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark2</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1B</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd1BkB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd1BkB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd2BlkB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>3</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>3</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span><span class=o>|</span><span class=mi>2</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2B</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>2</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BlkB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd2BlkB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd2BklB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N4</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>4</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N4</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>3</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>3</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span><span class=o>|</span><span class=mi>1</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2B</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>1</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BklB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd2BklB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd2BkB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark2</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2B</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BkB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd2BkB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd2BlBkB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=mi>1</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BkB</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>1</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BlBkB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd2BlBkB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd2BlB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark2</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=mi>1</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2B</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>1</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BlB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd2BlB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd2BkBlB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BlB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2BkBlB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQd2BkBlB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQd2B</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>endmark</span><span class=p>:</span>
      <span class=k>if</span> <span class=p>(</span><span class=n>avail</span><span class=o>&amp;</span><span class=p>(</span><span class=o>~</span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>:</span>
        <span class=k>return</span> <span class=mi>1</span>
    <span class=n>_extra_block_for_row</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span>
    <span class=n>_should_go_plus1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free and ((row+1 &gt;= endmark) or self._has_future_space(next_ld,next_rd,next_col,board_mask)):</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   total+=self.SQd2B(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
      <span class=c1># if next_free:</span>
      <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
      <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1># if row_next==mark1:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1># if row_next==mark2:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=n>extra</span><span class=o>=</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
      <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQd2B</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBlBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark2</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=mi>1</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>1</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBlBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQBlBjrB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBkBlBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBlBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBkBlBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQBkBlBjrB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>_extra_block_for_row</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span>
    <span class=n>_should_go_plus1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>jmark</span><span class=p>:</span>
      <span class=n>avail</span><span class=o>&amp;=~</span><span class=mi>1</span>
      <span class=n>ld</span><span class=o>|=</span><span class=mi>1</span>
      <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
        <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
        <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
        <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
        <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
        <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
        <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
        <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
        <span class=c1># if next_free:</span>
        <span class=c1>#   total+=self.SQB(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
        <span class=c1># if next_free:</span>
        <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
        <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
        <span class=c1># if row_next==mark1:</span>
        <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
        <span class=c1># if row_next==mark2:</span>
        <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
        <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
        <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
        <span class=n>extra</span><span class=o>=</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
        <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
          <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>return</span> <span class=n>total</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   total+=self.SQBjrB(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
      <span class=c1># if next_free:</span>
      <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
      <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1># if row_next==mark1:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1># if row_next==mark2:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=n>extra</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
      <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>_extra_block_for_row</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span>
    <span class=n>_should_go_plus1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>endmark</span><span class=p>:</span>
      <span class=k>return</span> <span class=mi>1</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free and ((row+1 &gt;= endmark) or self._has_future_space(next_ld,next_rd,next_col,board_mask)):</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   total+=self.SQB(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
      <span class=c1># if next_free:</span>
      <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
      <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1># if row_next==mark1:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1># if row_next==mark2:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=n>extra</span><span class=o>=</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
      <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBlBkBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=mi>1</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBkBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>1</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBlBkBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQBlBkBjrB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBkBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark2</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>2</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>2</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>2</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBkBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQBkBjrB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBklBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N4</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>4</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N4</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>3</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>3</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span><span class=o>|</span><span class=mi>1</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>1</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBklBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQBklBjrB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBlkBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N3</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>3</span>
    <span class=n>blockK</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N3</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=k>while</span> <span class=n>row</span><span class=o>==</span><span class=n>mark1</span> <span class=ow>and</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>3</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>3</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span><span class=o>|</span><span class=n>blockK</span><span class=o>|</span><span class=mi>2</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=o>|</span><span class=mi>2</span><span class=p>,</span><span class=n>next_rd</span><span class=o>|</span><span class=n>blockK</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBlkBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   row_next:int=row+1</span>
      <span class=c1>#   extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1>#   if row_next==mark1:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1>#   if row_next==mark2:</span>
      <span class=c1>#     extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1>#   # jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1>#   # if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=c1>#   if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
      <span class=c1>#     total+=self.SQBlkBjrB(next_ld,next_rd,next_col,row_next,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBjlBkBlBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N1</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>_extra_block_for_row</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span>
    <span class=n>_should_go_plus1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>N1</span><span class=o>-</span><span class=n>jmark</span><span class=p>:</span>
      <span class=n>rd</span><span class=o>|=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>ld</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>rd</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBkBlBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>return</span> <span class=n>total</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   total+=self.SQBjlBkBlBjrB(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
      <span class=c1># if next_free:</span>
      <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
      <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1># if row_next==mark1:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1># if row_next==mark2:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=n>extra</span><span class=o>=</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
      <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjlBkBlBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBjlBlBkBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N1</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>_extra_block_for_row</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span>
    <span class=n>_should_go_plus1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>N1</span><span class=o>-</span><span class=n>jmark</span><span class=p>:</span>
      <span class=n>rd</span><span class=o>|=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>ld</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>rd</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBlBkBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>return</span> <span class=n>total</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   total+=self.SQBjlBlBkBjrB(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
      <span class=c1># if next_free:</span>
      <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
      <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1># if row_next==mark1:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1># if row_next==mark2:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=n>extra</span><span class=o>=</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
      <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjlBlBkBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBjlBklBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N1</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>_extra_block_for_row</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span>
    <span class=n>_should_go_plus1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>N1</span><span class=o>-</span><span class=n>jmark</span><span class=p>:</span>
      <span class=n>rd</span><span class=o>|=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>ld</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>rd</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBklBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>return</span> <span class=n>total</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   total+=self.SQBjlBklBjrB(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
      <span class=c1># if next_free:</span>
      <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
      <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1># if row_next==mark1:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1># if row_next==mark2:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=n>extra</span><span class=o>=</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
      <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjlBklBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>SQBjlBlkBjrB</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>ld</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>rd</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>col</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>free</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>jmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>endmark</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark1</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>mark2</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>board_mask</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>N</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
    <span class=n>N1</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>N</span><span class=o>-</span><span class=mi>1</span>
    <span class=n>avail</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>free</span>
    <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span>
    <span class=n>_extra_block_for_row</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_extra_block_for_row</span>
    <span class=n>_should_go_plus1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_should_go_plus1</span>
    <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>N1</span><span class=o>-</span><span class=n>jmark</span><span class=p>:</span>
      <span class=n>rd</span><span class=o>|=</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>N1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>ld</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>rd</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=k>if</span> <span class=n>next_free</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBlkBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>return</span> <span class=n>total</span>
    <span class=k>while</span> <span class=n>avail</span><span class=p>:</span>
      <span class=n>bit</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>avail</span><span class=o>&amp;-</span><span class=n>avail</span>
      <span class=n>avail</span><span class=o>&amp;=</span><span class=n>avail</span><span class=o>-</span><span class=mi>1</span>
      <span class=n>next_ld</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>ld</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span>
      <span class=n>next_rd</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=p>(</span><span class=n>rd</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span>
      <span class=n>next_col</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>col</span><span class=o>|</span><span class=n>bit</span>
      <span class=n>blocked</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>next_ld</span><span class=o>|</span><span class=n>next_rd</span><span class=o>|</span><span class=n>next_col</span>
      <span class=n>next_free</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>board_mask</span><span class=o>&amp;~</span><span class=n>blocked</span>
      <span class=c1># if next_free:</span>
      <span class=c1>#   total+=self.SQBjlBlkBjrB(next_ld,next_rd,next_col,row+1,next_free,jmark,endmark,mark1,mark2,board_mask,N)</span>
      <span class=c1># if next_free:</span>
      <span class=n>row_next</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span>
      <span class=c1># extra=0 # 次の行が特殊行なら、その行で実際にORされる追加ブロックを足す</span>
      <span class=c1># if row_next==mark1:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK</span>
      <span class=c1># if row_next==mark2:</span>
      <span class=c1>#   extra|=(1&lt;&lt;(N-3)) #blockK or blockL</span>
      <span class=c1># jmark 系の分岐がある関数ではここでJのビットも追加する</span>
      <span class=c1># if row_next==(N-1-jmark): extra|=(1&lt;&lt;(N-1)) 等、該当関数の実装に合わせる</span>
      <span class=n>extra</span><span class=o>=</span><span class=n>_extra_block_for_row</span><span class=p>(</span><span class=n>row_next</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>_should_go_plus1</span><span class=p>(</span><span class=n>next_free</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>extra</span><span class=p>):</span>
      <span class=c1># if self._has_future_space_step(next_ld,next_rd,next_col,row_next,endmark,board_mask,extra):</span>
        <span class=n>total</span><span class=o>+=</span><span class=bp>self</span><span class=o>.</span><span class=n>SQBjlBlkBjrB</span><span class=p>(</span><span class=n>next_ld</span><span class=p>,</span><span class=n>next_rd</span><span class=p>,</span><span class=n>next_col</span><span class=p>,</span><span class=n>row_next</span><span class=p>,</span><span class=n>next_free</span><span class=p>,</span><span class=n>jmark</span><span class=p>,</span><span class=n>endmark</span><span class=p>,</span><span class=n>mark1</span><span class=p>,</span><span class=n>mark2</span><span class=p>,</span><span class=n>board_mask</span><span class=p>,</span><span class=n>N</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>
<span class=k>class</span> <span class=nc>NQueens15_constellations</span><span class=p>():</span>
  <span class=s2>&#34;&#34;&#34;小さなNの総数検算や、バッチ実行エントリ(main)を持つ補助クラス。&#34;&#34;&#34;</span>

  <span class=k>def</span> <span class=nf>_bit_total</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span><span class=n>size</span><span class=p>:</span><span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;小さな N（例: N≤5）を正攻法バックトラックで全列挙して総数を返す。&#34;&#34;&#34;</span>
    <span class=n>mask</span><span class=o>=</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=n>size</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span>
    <span class=n>total</span><span class=o>=</span><span class=mi>0</span>

    <span class=k>def</span> <span class=nf>bt</span><span class=p>(</span><span class=n>row</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>left</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>down</span><span class=p>:</span><span class=nb>int</span><span class=p>,</span><span class=n>right</span><span class=p>:</span><span class=nb>int</span><span class=p>):</span>
      <span class=k>nonlocal</span> <span class=n>total</span>
      <span class=k>if</span> <span class=n>row</span><span class=o>==</span><span class=n>size</span><span class=p>:</span>
        <span class=n>total</span><span class=o>+=</span><span class=mi>1</span>
        <span class=k>return</span>
      <span class=n>bitmap</span><span class=o>=</span><span class=n>mask</span><span class=o>&amp;~</span><span class=p>(</span><span class=n>left</span><span class=o>|</span><span class=n>down</span><span class=o>|</span><span class=n>right</span><span class=p>)</span>
      <span class=k>while</span> <span class=n>bitmap</span><span class=p>:</span>
        <span class=n>bit</span><span class=o>=-</span><span class=n>bitmap</span><span class=o>&amp;</span><span class=n>bitmap</span>
        <span class=n>bitmap</span> <span class=o>^=</span> <span class=n>bit</span>
        <span class=n>bt</span><span class=p>(</span><span class=n>row</span><span class=o>+</span><span class=mi>1</span><span class=p>,(</span><span class=n>left</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&lt;&lt;</span><span class=mi>1</span><span class=p>,</span><span class=n>down</span><span class=o>|</span><span class=n>bit</span><span class=p>,(</span><span class=n>right</span><span class=o>|</span><span class=n>bit</span><span class=p>)</span><span class=o>&gt;&gt;</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>bt</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>total</span>

  <span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
    <span class=s2>&#34;&#34;&#34;N=5..19 を対象に、(開始列挙 → 解探索) の一括実行を行い、所要時間を表示。
</span><span class=s2>
</span><span class=s2>    振る舞い:
</span><span class=s2>        - N≤5 は _bit_total() で検算
</span><span class=s2>        - 通常は NQueens15().gen_constellations(...), exec_solutions(...) の順に実行
</span><span class=s2>        - solutions 合計と経過時間を出力
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=n>nmin</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>5</span>
    <span class=n>nmax</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>20</span>
    <span class=n>preset_queens</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>4</span>  <span class=c1># 必要に応じて変更</span>
    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34; N:        Total       Unique        hh:mm:ss.ms&#34;</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>size</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>nmin</span><span class=p>,</span><span class=n>nmax</span><span class=p>):</span>
      <span class=n>start_time</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
      <span class=k>if</span> <span class=n>size</span><span class=o>&lt;=</span><span class=mi>5</span><span class=p>:</span>
        <span class=c1># ← フォールバック：N=5はここで正しい10を得る</span>
        <span class=n>total</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>_bit_total</span><span class=p>(</span><span class=n>size</span><span class=p>)</span>
        <span class=n>dt</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>-</span><span class=n>start_time</span>
        <span class=n>text</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>dt</span><span class=p>)[:</span><span class=o>-</span><span class=mi>3</span><span class=p>]</span>
        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>size</span><span class=si>:</span><span class=s2>2d</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>total</span><span class=si>:</span><span class=s2>13d</span><span class=si>}{</span><span class=mi>0</span><span class=si>:</span><span class=s2>13d</span><span class=si>}{</span><span class=n>text</span><span class=si>:</span><span class=s2>&gt;20s</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
        <span class=k>continue</span>
      <span class=n>ijkl_list</span><span class=p>:</span><span class=n>Set</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span><span class=o>=</span><span class=nb>set</span><span class=p>()</span>
      <span class=n>constellations</span><span class=p>:</span><span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>int</span><span class=p>]]</span><span class=o>=</span><span class=p>[]</span>
      <span class=n>NQ</span><span class=o>=</span><span class=n>NQueens15</span><span class=p>()</span>
      <span class=c1>#---------------------------------</span>
      <span class=c1># 星座リストそのものをキャッシュ</span>
      <span class=c1>#---------------------------------</span>
      <span class=c1># キャッシュを使わない</span>
      <span class=n>NQ</span><span class=o>.</span><span class=n>gen_constellations</span><span class=p>(</span><span class=n>ijkl_list</span><span class=p>,</span><span class=n>constellations</span><span class=p>,</span><span class=n>size</span><span class=p>,</span><span class=n>preset_queens</span><span class=p>)</span>
      <span class=c1># キャッシュを使う、キャッシュの整合性もチェック</span>
      <span class=c1># -- txt</span>
      <span class=c1># constellations=NQ.load_or_build_constellations_txt(ijkl_list,constellations,size,preset_queens)</span>
      <span class=c1># -- bin</span>
      <span class=c1># constellations=NQ.load_or_build_constellations_bin(ijkl_list,constellations,size,preset_queens)</span>
      <span class=c1>#---------------------------------</span>
      <span class=n>NQ</span><span class=o>.</span><span class=n>exec_solutions</span><span class=p>(</span><span class=n>constellations</span><span class=p>,</span><span class=n>size</span><span class=p>)</span>
      <span class=n>total</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=nb>sum</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=s1>&#39;solutions&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>constellations</span> <span class=k>if</span> <span class=n>c</span><span class=p>[</span><span class=s1>&#39;solutions&#39;</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>)</span>
      <span class=n>time_elapsed</span><span class=o>=</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>-</span><span class=n>start_time</span>
      <span class=n>text</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>time_elapsed</span><span class=p>)[:</span><span class=o>-</span><span class=mi>3</span><span class=p>]</span>
      <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>size</span><span class=si>:</span><span class=s2>2d</span><span class=si>}</span><span class=s2>:</span><span class=si>{</span><span class=n>total</span><span class=si>:</span><span class=s2>13d</span><span class=si>}{</span><span class=mi>0</span><span class=si>:</span><span class=s2>13d</span><span class=si>}{</span><span class=n>text</span><span class=si>:</span><span class=s2>&gt;20s</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
<span class=k>if</span> <span class=vm>__name__</span><span class=o>==</span><span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
  <span class=n>NQueens15_constellations</span><span class=p>()</span><span class=o>.</span><span class=n>main</span><span class=p>()</span>

</code></pre></div><hr>
<h2 id=-関連リンク>📚 関連リンク</h2>
<ul>
<li><a class=link href=https://github.com/exaloop/codon target=_blank rel=noopener>Codon GitHub (Exaloop)</a></li>
<li><a class=link href=https://github.com/suzukiiichiro/N-Queens target=_blank rel=noopener>N-Queens Project Archive</a></li>
<li><a class=link href=https://llvm.org/docs/ target=_blank rel=noopener>公式 LLVM Documentation</a></li>
<li><a class=link href=https://docs.exaloop.io target=_blank rel=noopener>Codon Language Docs</a></li>
</ul>
<hr>
<h2 id=ｎクイーン問題-過去記事アーカイブ-1>Ｎクイーン問題 過去記事アーカイブ</h2>
<p>【過去記事アーカイブ】Ｎクイーン問題 過去記事一覧<br>
<a class=link href="https://suzukiiichiro.github.io/search/?keyword=" target=_blank rel=noopener>https://suzukiiichiro.github.io/search/?keyword=</a>Ｎクイーン問題<br>
【Github】エイト・クイーンのソース置き場 BashもJavaもPythonも！<br>
<a class=link href=https://github.com/suzukiiichiro/N-Queens target=_blank rel=noopener>https://github.com/suzukiiichiro/N-Queens</a></p>
<p>Ｎクイーン問題（１０１）Python/Codonで爆速プログラミング コンステレーション＋インテグレート<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/</a><br>
Ｎクイーン問題（１００）Python/Codonで爆速プログラミング コンステレーション＋マージ<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/</a><br>
Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/</a><br>
Ｎクイーン問題（９８）Python/Codonで爆速プログラミング コンステレーション＋並列処理<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/</a><br>
Ｎクイーン問題（９７）Python/Codonで爆速プログラミング コンステレーション<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/</a><br>
Ｎクイーン問題（９６）Python/Codonで爆速プログラミング キャリーチェーン<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/</a><br>
Ｎクイーン問題（９５）Python/Codonで爆速プログラミング ノードレイヤー＋対象解除法<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/</a><br>
Ｎクイーン問題（９４）Python/Codonで爆速プログラミング ノードレイヤー＋ミラー<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/</a><br>
Ｎクイーン問題（９３）Python/Codonで爆速プログラミング ノードレイヤー<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/</a><br>
Ｎクイーン問題（９２）Python/Codonで爆速プログラミング ビットでミラー＋対象解除法<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-08-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-08-n-queens-suzuki/</a><br>
Ｎクイーン問題（９１）Python/Codonで爆速プログラミング ビットで対象解除法<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-07-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-07-n-queens-suzuki/</a><br>
Ｎクイーン問題（９０）Python/Codonで爆速プログラミング ビットでミラー<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-06-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-06-n-queens-suzuki/</a><br>
Ｎクイーン問題（８９）Python/Codonで爆速プログラミング ビットでバックトラック<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-05-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-05-n-queens-suzuki/</a><br>
Ｎクイーン問題（８８）Python/Codonで爆速プログラミング 対象解除法<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-04-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-04-n-queens-suzuki/</a><br>
Ｎクイーン問題（８７）Python/Codonで爆速プログラミング バックトラック<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（８６）Python/Codonで爆速プログラミング ポストフラグ<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（８５）Python/Codonで爆速プログラミング ブルートフォース<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-27-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-27-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（８４）Python/Codonで爆速プログラミング<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-10-24-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-10-24-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（８３）Python-codon＆並列処理で高速化 Constellations<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-11-07-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-11-07-n-queens-suzuki/</a><br>
Ｎクイーン問題（８２）Python-並列処理で高速化 16Python_carryChain_ProcessPool<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-11-06-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-11-06-n-queens-suzuki/</a><br>
Ｎクイーン問題（８１）Python-codonで高速化 15Python_carryChain<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-11-05-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-11-05-n-queens-suzuki/</a><br>
Ｎクイーン問題（８０）Python-並列処理で高速化 14Python_NodeLayer_symmetry_ProcessPool<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-11-04-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-11-04-n-queens-suzuki/</a><br>
Ｎクイーン問題（７９）Python-codonで高速化 13Python_NodeLayer_symmetry<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-11-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-11-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（７８）Python-codonで高速化 12Python_NodeLayer_mirror<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-11-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-11-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（７７）Python-codonで高速化 11Python_NodeLayer<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-11-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-11-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（７６）Python-並列処理で高速化 10Python_bit_symmetry_ProcessPool<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-10-05-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-10-05-n-queens-suzuki/</a><br>
Ｎクイーン問題（７５）Python-並列処理で高速化 09Python_bit_symmetry_ThreadPool<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-10-04-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-10-04-n-queens-suzuki/</a><br>
Ｎクイーン問題（７４）Python-codonで高速化 08Python_bit_symmetry<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-10-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-10-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（７３）Python-codonで高速化 07Python_bit_mirror<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-10-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-10-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（７２）Python-codonで高速化 06Python_bit_backTrack<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-10-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-10-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（７１）Python-codonで高速化 05Python_optimize<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-07-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-07-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（７０）Python-codonで高速化 04Python_symmetry<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-06-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-06-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（６９）Python-codonで高速化 03Python_backTracking<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-06-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-06-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（６８）Python-codonで高速化 02Python_postFlag<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-05-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-05-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（６７）Python-codonで高速化 01Python_bluteForce<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-05-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-05-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（６６）Python-codonで高速化<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2025-03-05-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2025-03-05-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（６５） Ｎ２５を解決！事実上の日本一に<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2024-04-25-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2024-04-25-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（６４）第七章 並列処理 キャリーチェーン ＮＶＩＤＩＡ ＣＵＤＡ編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-08-01-05-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-08-01-05-n-queens-suzuki/</a><br>
Ｎクイーン問題（６３）第七章 並列処理 キャリーチェーン ＮＶＩＤＩＡ ＣＵＤＡ編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-08-01-05-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-08-01-05-n-queens-suzuki/</a><br>
Ｎクイーン問題（６２）第七章 並列処理 対称解除法 ビットボード ＮＶＩＤＩＡ ＣＵＤＡ編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-08-01-04-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-08-01-04-n-queens-suzuki/</a><br>
Ｎクイーン問題（６１）第七章 並列処理 対称解除法 ノードレイヤー ＮＶＩＤＩＡ ＣＵＤＡ編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-08-01-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-08-01-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（６０）第七章 並列処理 ミラー ＮＶＩＤＩＡ ＣＵＤＡ編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-08-01-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-08-01-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（５９）第七章 並列処理 ビットマップ ＮＶＩＤＩＡ ＣＵＤＡ編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-08-01-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-08-01-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（５８）第六章 並列処理 pthread C言語編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-28-09-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-28-09-n-queens-suzuki/</a><br>
Ｎクイーン問題（５７）第八章 キャリーチェーン C言語編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-28-08-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-28-08-n-queens-suzuki/</a><br>
Ｎクイーン問題（５６）第八章 ミラー C言語編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-28-06-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-28-06-n-queens-suzuki/</a><br>
Ｎクイーン問題（５５）第八章 ビットマップ C言語編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-28-05-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-28-05-n-queens-suzuki/</a><br>
Ｎクイーン問題（５４）第八章 ビットマップ C言語編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-28-04-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-28-04-n-queens-suzuki/</a><br>
Ｎクイーン問題（５３）第八章 配置フラグ C言語編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-28-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-28-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（５２）第八章 バックトラック C言語編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-28-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-28-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（５１）第八章 ブルートフォース C言語編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-28-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-28-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（５０）第七章 マルチプロセス Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-21-04-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-21-04-n-queens-suzuki/</a><br>
Ｎクイーン問題（４９）第七章 マルチスレッド Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-21-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-21-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（４８）第七章 シングルスレッド Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-21-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-21-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（４７）第七章 クラス Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-21-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-21-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（４６）第七章 ステップＮの実装 Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-16-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-16-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（４５）第七章 キャリーチェーン Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-16-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-16-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（４４）第七章　対象解除法 Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-14-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-14-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（４３）第七章　ミラー Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-14-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-14-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（４２）第七章　ビットマップ Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-13-05-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-13-05-n-queens-suzuki/</a><br>
Ｎクイーン問題（４１）第七章　配置フラグ Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-13-04-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-13-04-n-queens-suzuki/</a><br>
Ｎクイーン問題（４０）第七章　バックトラック Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-13-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-13-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（３９）第七章　バックトラック準備編 Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-13-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-13-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（３８）第七章　ブルートフォース Python編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-06-13-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-06-13-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（３７）第六章 C言語移植 その１７ pthread並列処理完成<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-17-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-17-n-queens-suzuki/</a><br>
Ｎクイーン問題（３６）第六章 C言語移植 その１６ pthreadの実装<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-16-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-16-n-queens-suzuki/</a><br>
Ｎクイーン問題（３５）第六章 C言語移植 その１５ pthread実装直前版完成<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-15-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-15-n-queens-suzuki/</a><br>
Ｎクイーン問題（３４）第六章 C言語移植 その１４<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-14-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-14-n-queens-suzuki/</a><br>
Ｎクイーン問題（３３）第六章 C言語移植 その１３<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-13-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-13-n-queens-suzuki/</a><br>
Ｎクイーン問題（３２）第六章 C言語移植 その１２<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-12-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-12-n-queens-suzuki/</a><br>
Ｎクイーン問題（３１）第六章 C言語移植 その１１<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-11-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-11-n-queens-suzuki/</a><br>
Ｎクイーン問題（３０）第六章 C言語移植 その１０<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-10-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-10-n-queens-suzuki/</a><br>
Ｎクイーン問題（２９）第六章 C言語移植 その９<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-09-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-09-n-queens-suzuki/</a><br>
Ｎクイーン問題（２８）第六章 C言語移植 その８<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-08-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-08-n-queens-suzuki/</a><br>
Ｎクイーン問題（２７）第六章 C言語移植 その７<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-07-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-07-n-queens-suzuki/</a><br>
Ｎクイーン問題（２６）第六章 C言語移植 その６<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-06-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-06-n-queens-suzuki/</a><br>
Ｎクイーン問題（２５）第六章 C言語移植 その５<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-05-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-05-n-queens-suzuki/</a><br>
Ｎクイーン問題（２４）第六章 C言語移植 その４<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-04-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-04-n-queens-suzuki/</a><br>
Ｎクイーン問題（２３）第六章 C言語移植 その３<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（２２）第六章 C言語移植 その２<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-30-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-30-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（２１）第六章 C言語移植 その１<br>
N-Queens問://suzukiiichiro.github.io/posts/2023-05-30-01-n-queens-suzuki/<br>
Ｎクイーン問題（２０）第五章 並列処理<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-23-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-23-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（１９）第五章 キャリーチェーン<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-05-23-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-05-23-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（１８）第四章 エイト・クイーンノスタルジー<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-04-25-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-04-25-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（１７）第四章　偉人のソースを読む「Ｎ２４を発見 Ｊｅｆｆ Ｓｏｍｅｒｓ」<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-04-21-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-04-21-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（１６）第三章　対象解除法 ソース解説<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-04-18-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-04-18-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（１５）第三章　対象解除法 ロジック解説<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-04-13-02-nqueens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-04-13-02-nqueens-suzuki/</a><br>
Ｎクイーン問題（１４）第三章　ミラー<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-04-13-01-nqueens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-04-13-01-nqueens-suzuki/</a><br>
Ｎクイーン問題（１３）第三章　ビットマップ<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-04-05-01-nqueens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-04-05-01-nqueens-suzuki/</a><br>
Ｎクイーン問題（１２）第二章　まとめ<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-03-17-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-03-17-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（１１）第二章　配置フラグの再帰・非再帰<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-03-17-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-03-17-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（１０）第二章　バックトラックの再帰・非再帰<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-03-16-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-03-16-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（９）第二章　ブルートフォースの再帰・非再帰<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-03-14-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-03-14-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（８）第一章　まとめ<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-03-09-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-03-09-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（７）第一章　ブルートフォース再び<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-03-08-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-03-08-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（６）第一章　配置フラグ<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-03-07-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-03-07-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（５）第一章　進捗表示テーブルの作成<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-03-06-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-03-06-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（４）第一章　バックトラック<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-02-21-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-02-21-01-n-queens-suzuki/</a><br>
Ｎクイーン問題（３）第一章　バックトラック準備編<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-02-14-03-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-02-14-03-n-queens-suzuki/</a><br>
Ｎクイーン問題（２）第一章　ブルートフォース<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-02-14-02-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-02-14-02-n-queens-suzuki/</a><br>
Ｎクイーン問題（１）第一章　エイトクイーンについて<br>
<a class=link href=https://suzukiiichiro.github.io/posts/2023-02-14-01-n-queens-suzuki/ target=_blank rel=noopener>https://suzukiiichiro.github.io/posts/2023-02-14-01-n-queens-suzuki/</a></p>
<h2 id=書籍の紹介>書籍の紹介</h2>
<aside class=amazon-box>
<a href="https://www.amazon.co.jp/gp/proteect/4873112672/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4873112672&linkCode=as2&tag=nlpqueens09-22&linkId=ef087fd92d3628bb94e1eb10cb202d43" target=_blank>
<div class="columns amazon-image">
<img border=0 src=https://m.media-amazon.com/images/I/51EAPCH56ML._SL250_.jpg alt="詳解 シェルスクリプト 大型本  2006/1/16">
</div>
<div class="columns amazon-info">
<h2 class=amazon-name>詳解 シェルスクリプト 大型本 2006/1/16</h2>
<p>Unixのプログラムは「ツール」と呼ばれます。
Unixは、処理を実現するために複数の道具(ツール)を組み合わせる「ソフトウェアツール」という思想の下に設計されているためです。
そしてこれらツールを「組み合わせる」ということこそがUnixの真髄です。
また、シェルスクリプトの作成には言語自体だけでなくそれぞれのツールに対する理解も求められます。
つまり、あるツールが何のためのものであり、それを単体あるいは他のプログラムと組み合わせて利用するにはどのようにすればよいかということを理解しなければなりません。
本書は、Unixシステムへの理解を深めながら、シェルスクリプトの基礎から応用までを幅広く解説します。
標準化されたシェルを通じてUnix(LinuxやFreeBSD、Mac OS XなどあらゆるUnix互換OSを含む)の各種ツールを組み合わせ、
目的の処理を実現するための方法を詳しく学ぶことができます。
</p>
<span class=link>Amazonで詳細を見る</span>
</div>
</a>
<small>Amazon.co.jpアソシエイトを使用</small>
</aside>
<aside class=amazon-box>
<a href="https://www.amazon.co.jp/gp/proteect/4797377623/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4797377623&linkCode=as2&tag=nlpqueens09-22&linkId=3c8d4566263ae99374221c4f8f469154" target=_blank>
<div class="columns amazon-image">
<img border=0 src=https://m.media-amazon.com/images/I/51R5SZKrEAL._SL250_.jpg alt="UNIXシェルスクリプト マスターピース132">
</div>
<div class="columns amazon-info">
<h2 class=amazon-name>UNIXシェルスクリプト マスターピース132</h2>
<p>すべてのUNIXエンジニア必携!!
<p>サーバー管理、ネットワーク管理など、現場で使えるテクニックを豊富にちりばめたシェルスクリプトサンプル集の決定版。<br>
知りたいことがきっと見つかる秘密の道具箱。Linux、FreeBSD、MacOS対応。</p>
</p>
<span class=link>Amazonで詳細を見る</span>
</div>
</a>
<small>Amazon.co.jpアソシエイトを使用</small>
</aside>
<aside class=amazon-box>
<a href="https://www.amazon.co.jp/gp/proteect/4774186945/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4774186945&linkCode=as2&tag=nlpqueens09-22&linkId=8ef3ff961c569212e910cf3d6e37dcb6" target=_blank>
<div class="columns amazon-image">
<img border=0 src=https://m.media-amazon.com/images/I/41i956UyusL._SL250_.jpg alt="[改訂第3版]シェルスクリプト基本リファレンス ──#!/bin/shで、ここまでできる (WEB+DB PRESS plus) 単行本（ソフトカバー）  2017/1/20">
</div>
<div class="columns amazon-info">
<h2 class=amazon-name>[改訂第3版]シェルスクリプト基本リファレンス ──#!/bin/shで、ここまでできる (WEB+DB PRESS plus) 単行本（ソフトカバー） 2017/1/20</h2>
<p>定番の1冊『シェルスクリプト基本リファレンス』の改訂第3版。
シェルスクリプトの知識は、プログラマにとって長く役立つ知識です。
本書では、複数のプラットフォームに対応できる移植性の高いシェルスクリプト作成に主眼を置き、
基本から丁寧に解説。
第3版では最新のLinux/FreeBSD/Solarisに加え、組み込み分野等で注目度の高いBusyBoxもサポート。
合わせて、全収録スクリプトに関してWindowsおよびmacOS環境でのbashの動作確認も行い、さらなる移植性の高さを追求。
ますますパワーアップした改訂版をお届けします。</p>
<span class=link>Amazonで詳細を見る</span>
</div>
</a>
<small>Amazon.co.jpアソシエイトを使用</small>
</aside>
<aside class=amazon-box>
<a href="https://www.amazon.co.jp/gp/proteect/4797393106/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4797393106&linkCode=as2&tag=nlpqueens09-22&linkId=f514a6378c1c10e59ab16275745c2439" target=_blank>
<div class="columns amazon-image">
<img border=0 src=https://m.media-amazon.com/images/I/41d1D6rgDiL._SL250_.jpg alt="新しいシェルプログラミングの教科書 単行本">
</div>
<div class="columns amazon-info">
<h2 class=amazon-name>新しいシェルプログラミングの教科書 単行本</h2>
<p>エキスパートを目指せ!!
<p>システム管理やソフトウェア開発など、<br>
実際の業務では欠かせないシェルスクリプトの知識を徹底解説</p>
<p>ほとんどのディストリビューションでデフォルトとなっているbashに特化することで、<br>
類書と差別化を図るとともに、より実践的なプログラミングを紹介します。<br>
またプログラミング手法の理解に欠かせないLinuxの仕組みについてもできるかぎり解説しました。<br>
イマドキのエンジニア必携の一冊。</p>
<p>▼目次<br>
CHAPTER01 シェルってなんだろう<br>
CHAPTER02 シェルスクリプトとは何か<br>
CHAPTER03 シェルスクリプトの基本<br>
CHAPTER04 変数<br>
CHAPTER05 クォーティング<br>
CHAPTER06 制御構造<br>
CHAPTER07 リダイレクトとパイプ<br>
CHAPTER08 関数<br>
CHAPTER09 組み込みコマンド<br>
CHAPTER10 正規表現と文字列<br>
CHAPTER11 シェルスクリプトの実行方法<br>
CHAPTER12 シェルスクリプトのサンプルで学ぼう<br>
CHAPTER13 シェルスクリプトの実用例<br>
CHAPTER14 テストとデバッグ<br>
CHAPTER15 読みやすいシェルスクリプト</p>
</p>
<span class=link>Amazonで詳細を見る</span>
</div>
</a>
<small>Amazon.co.jpアソシエイトを使用</small>
</aside>
</div>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-8689199204567424 data-ad-slot=9341917836></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script>
<aside class="section related-contents--wrapper">
<h2 class=section-title>関連するコンテンツ</h2>
<div class=article-list>
<article class="has-image article-item" data-date=2026.02.03>
<a class=article-link href=https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/>
<header class=article-header>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=200 height=151>
<img src=https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" width=200 height=151 loading=lazy alt=Ｎクイーン問題（１０２）Python/CodonでNの計測値がC/GPU-CUDAに追いついてしまった話>
</picture>
</div>
<div class=article-category>
<span class=article-category-item>
プログラミング
</span>
</div>
</header>
<div class=article-details>
<h2 class=article-title>Ｎクイーン問題（１０２）Python/CodonでNの計測値がC/GPU-CUDAに追いついてしまった話</h2><div class=article-time>
<time class="article-time--item article-time--published">2026.02.03</time>
</div><p class=article-subtitle>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiii…</p>
</div>
</a>
</article>
<article class="has-image article-item" data-date=2025.10.27>
<a class=article-link href=https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/>
<header class=article-header>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=200 height=151>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" width=200 height=151 loading=lazy alt="Ｎクイーン問題（１０１）Python/Codonで爆速プログラミング コンステレーション＋インテグレート">
</picture>
</div>
<div class=article-category>
<span class=article-category-item>
プログラミング
</span>
</div>
</header>
<div class=article-details>
<h2 class=article-title>Ｎクイーン問題（１０１）Python/Codonで爆速プログラミング コンステレーション＋インテグレート</h2><div class=article-time>
<time class="article-time--item article-time--published">2025.10.27</time>
</div><p class=article-subtitle>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiii…</p>
</div>
</a>
</article>
<article class="has-image article-item" data-date=2025.10.27>
<a class=article-link href=https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/>
<header class=article-header>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=200 height=151>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" width=200 height=151 loading=lazy alt="Ｎクイーン問題（１００）Python/Codonで爆速プログラミング コンステレーション＋マージ">
</picture>
</div>
<div class=article-category>
<span class=article-category-item>
プログラミング
</span>
</div>
</header>
<div class=article-details>
<h2 class=article-title>Ｎクイーン問題（１００）Python/Codonで爆速プログラミング コンステレーション＋マージ</h2><div class=article-time>
<time class="article-time--item article-time--published">2025.10.27</time>
</div><p class=article-subtitle>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiii…</p>
</div>
</a>
</article>
<article class="has-image article-item" data-date=2025.10.27>
<a class=article-link href=https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/>
<header class=article-header>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=200 height=151>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" width=200 height=151 loading=lazy alt="Ｎクイーン問題（９８）Python/Codonで爆速プログラミング コンステレーション＋並列処理">
</picture>
</div>
<div class=article-category>
<span class=article-category-item>
プログラミング
</span>
</div>
</header>
<div class=article-details>
<h2 class=article-title>Ｎクイーン問題（９８）Python/Codonで爆速プログラミング コンステレーション＋並列処理</h2><div class=article-time>
<time class="article-time--item article-time--published">2025.10.27</time>
</div><p class=article-subtitle>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiii…</p>
</div>
</a>
</article>
<article class="has-image article-item" data-date=2025.10.27>
<a class=article-link href=https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/>
<header class=article-header>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=200 height=151>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" width=200 height=151 loading=lazy alt="Ｎクイーン問題（９７）Python/Codonで爆速プログラミング コンステレーション">
</picture>
</div>
<div class=article-category>
<span class=article-category-item>
プログラミング
</span>
</div>
</header>
<div class=article-details>
<h2 class=article-title>Ｎクイーン問題（９７）Python/Codonで爆速プログラミング コンステレーション</h2><div class=article-time>
<time class="article-time--item article-time--published">2025.10.27</time>
</div><p class=article-subtitle>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiii…</p>
</div>
</a>
</article>
<article class="has-image article-item" data-date=2025.10.27>
<a class=article-link href=https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/>
<header class=article-header>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=200 height=151>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" width=200 height=151 loading=lazy alt="Ｎクイーン問題（９６）Python/Codonで爆速プログラミング キャリーチェーン">
</picture>
</div>
<div class=article-category>
<span class=article-category-item>
プログラミング
</span>
</div>
</header>
<div class=article-details>
<h2 class=article-title>Ｎクイーン問題（９６）Python/Codonで爆速プログラミング キャリーチェーン</h2><div class=article-time>
<time class="article-time--item article-time--published">2025.10.27</time>
</div><p class=article-subtitle>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiii…</p>
</div>
</a>
</article>
<article class="has-image article-item" data-date=2025.10.27>
<a class=article-link href=https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/>
<header class=article-header>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=200 height=151>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" width=200 height=151 loading=lazy alt="Ｎクイーン問題（９５）Python/Codonで爆速プログラミング ノードレイヤー＋対象解除法">
</picture>
</div>
<div class=article-category>
<span class=article-category-item>
プログラミング
</span>
</div>
</header>
<div class=article-details>
<h2 class=article-title>Ｎクイーン問題（９５）Python/Codonで爆速プログラミング ノードレイヤー＋対象解除法</h2><div class=article-time>
<time class="article-time--item article-time--published">2025.10.27</time>
</div><p class=article-subtitle>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiii…</p>
</div>
</a>
</article>
<article class="has-image article-item" data-date=2025.10.27>
<a class=article-link href=https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/>
<header class=article-header>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=200 height=151>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_400x0_resize_q75_box.jpg 2x" width=200 height=151 loading=lazy alt="Ｎクイーン問題（９４）Python/Codonで爆速プログラミング ノードレイヤー＋ミラー">
</picture>
</div>
<div class=article-category>
<span class=article-category-item>
プログラミング
</span>
</div>
</header>
<div class=article-details>
<h2 class=article-title>Ｎクイーン問題（９４）Python/Codonで爆速プログラミング ノードレイヤー＋ミラー</h2><div class=article-time>
<time class="article-time--item article-time--published">2025.10.27</time>
</div><p class=article-subtitle>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら https://github.com/suzukiii…</p>
</div>
</a>
</article>
</div>
</aside>
<footer class=article-footer>
</footer>
<div class=article-pager>
<div class="article-pager-item article-pager--next">
<div class="article has-image">
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/>
<div class=article-image>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" width=50 height=38 alt="Ｎクイーン問題（１００）Python/Codonで爆速プログラミング コンステレーション＋マージ">
</div>
<div class=article-details>
<h4 class=article-title>Ｎクイーン問題（１００）Python/Codonで爆速プログラミング コンステレーション＋マージ</h4>
</div>
</a>
</div>
</div>
<div class="article-pager-item article-pager--prev">
<div class="article has-image">
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/>
<div class=article-image>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" width=50 height=38 alt="Ｎクイーン問題（９８）Python/Codonで爆速プログラミング コンステレーション＋並列処理">
</div>
<div class=article-details>
<h4 class=article-title>Ｎクイーン問題（９８）Python/Codonで爆速プログラミング コンステレーション＋並列処理</h4>
</div>
</a>
</div>
</div>
</div>
</article>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<div class="sidebar right-sidebar sticky">
<div class="profile-area widget">
<span class=profile-icon style=background-image:url(https://github.com/suzukiiichiro.png)></span>
<div class=profile-bio-area>
<h4 class=profile-name>suzukiiichiro</h4>
<p class=profile-bio>
鈴木維一郎
/慶應義塾大学大学院特別研究講師(常勤)
/RPG Rogue日本語版開発者
/遠隔操作リモートデスクトップ特許発明者
/離散数学研究開発者
/自然言語処理研究開発者/
人工知能学会/情報処理学会
</p><a href=https://suzukiiichiro.github.io/authors/suzuki/>「suzukiiichiro」のコンテンツ一覧</a></div>
</div>
<aside class=widget>
<ins class=adsbygoogle style=display:inline-block;width:300px;height:250px data-ad-client=ca-pub-8689199204567424 data-ad-slot=8359266396></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script>
</aside>
<aside class="widget tagCloud">
<h2 class="widget-title section-title">タグ</h2>
<div class=tagCloud-tags>
<a href=https://suzukiiichiro.github.io/tags/%E9%88%B4%E6%9C%A8%E7%B6%AD%E4%B8%80%E9%83%8E/ class=font_size_247>
鈴木維一郎
</a>
<a href=https://suzukiiichiro.github.io/tags/bash/ class=font_size_143>
Bash
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88/ class=font_size_143>
シェルスクリプト
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/ class=font_size_103>
アルゴリズム
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%82%A8%E3%82%A4%E3%83%88%E3%82%AF%E3%82%A4%E3%83%BC%E3%83%B3/ class=font_size_103>
エイト・クイーン
</a>
<a href=https://suzukiiichiro.github.io/tags/n-queens/ class=font_size_102>
N-Queens
</a>
<a href=https://suzukiiichiro.github.io/tags/python/ class=font_size_90>
python
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%81%96%E3%81%A3%E3%81%8F%E3%82%8A%E3%82%8F%E3%81%8B%E3%82%8B%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA/ class=font_size_58>
ざっくりわかるシリーズ
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0/ class=font_size_46>
プログラム
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0/ class=font_size_40>
プログラミング
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E6%B4%BB%E7%94%A8/ class=font_size_38>
コマンド活用
</a>
<a href=https://suzukiiichiro.github.io/tags/codon/ class=font_size_37>
codon
</a>
<a href=https://suzukiiichiro.github.io/tags/%EF%BD%83%E8%A8%80%E8%AA%9E/ class=font_size_33>
Ｃ言語
</a>
<a href=https://suzukiiichiro.github.io/tags/n-queen/ class=font_size_25>
N-Queen
</a>
<a href=https://suzukiiichiro.github.io/tags/%E4%B8%A6%E5%88%97%E5%87%A6%E7%90%86/ class=font_size_24>
並列処理
</a>
<a href=https://suzukiiichiro.github.io/tags/designer/ class=font_size_20>
Designer
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%83%9E%E3%83%8B%E3%82%A2%E3%83%83%E3%82%AF%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89/ class=font_size_18>
マニアックコマンド
</a>
<a href=https://suzukiiichiro.github.io/tags/front-engineer/ class=font_size_16>
Front engineer
</a>
<a href=https://suzukiiichiro.github.io/tags/html/ class=font_size_16>
HTML
</a>
<a href=https://suzukiiichiro.github.io/tags/web-designer/ class=font_size_16>
Web designer
</a>
<a href=https://suzukiiichiro.github.io/tags/web/ class=font_size_15>
Web
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0%E3%81%A8%E3%83%87%E3%83%BC%E3%82%BF%E6%A7%8B%E9%80%A0/ class=font_size_15>
アルゴリズムとデータ構造
</a>
<a href=https://suzukiiichiro.github.io/tags/css/ class=font_size_14>
css
</a>
<a href=https://suzukiiichiro.github.io/tags/develop/ class=font_size_14>
Develop
</a>
<a href=https://suzukiiichiro.github.io/tags/e-stat/ class=font_size_13>
e-Stat
</a>
<a href=https://suzukiiichiro.github.io/tags/hugo/ class=font_size_13>
Hugo
</a>
<a href=https://suzukiiichiro.github.io/tags/%E3%83%87%E3%83%BC%E3%82%BF%E3%83%9E%E3%82%A4%E3%83%8B%E3%83%B3%E3%82%B0/ class=font_size_13>
データマイニング
</a>
<a href=https://suzukiiichiro.github.io/tags/wyoshi/ class=font_size_9>
wyoshi
</a>
<a href=https://suzukiiichiro.github.io/tags/%E9%96%8B%E7%99%BA/ class=font_size_8>
開発
</a>
<a href=https://suzukiiichiro.github.io/tags/corder/ class=font_size_7>
Corder
</a>
</div>
</aside>
<aside class="widget archives sidearticle-contents--wrapper" id=newpost-articles>
<h2 class=section-title>最新記事</h2>
<div class=sidearticle-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2026-02-03-01-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt=Ｎクイーン問題（１０２）Python/CodonでNの計測値がC/GPU-CUDAに追いついてしまった話>
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（１０２）Python/CodonでNの計測値がC/GPU-CUDAに追いついてしまった話</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-17-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="Ｎクイーン問題（１０１）Python/Codonで爆速プログラミング コンステレーション＋インテグレート">
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（１０１）Python/Codonで爆速プログラミング コンステレーション＋インテグレート</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-16-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="Ｎクイーン問題（１００）Python/Codonで爆速プログラミング コンステレーション＋マージ">
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（１００）Python/Codonで爆速プログラミング コンステレーション＋マージ</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-15-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化">
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（９９）Python/Codonで爆速プログラミング コンステレーション＋最適化</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-14-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="Ｎクイーン問題（９８）Python/Codonで爆速プログラミング コンステレーション＋並列処理">
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（９８）Python/Codonで爆速プログラミング コンステレーション＋並列処理</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-13-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="Ｎクイーン問題（９７）Python/Codonで爆速プログラミング コンステレーション">
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（９７）Python/Codonで爆速プログラミング コンステレーション</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-12-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="Ｎクイーン問題（９６）Python/Codonで爆速プログラミング キャリーチェーン">
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（９６）Python/Codonで爆速プログラミング キャリーチェーン</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-11-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="Ｎクイーン問題（９５）Python/Codonで爆速プログラミング ノードレイヤー＋対象解除法">
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（９５）Python/Codonで爆速プログラミング ノードレイヤー＋対象解除法</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-10-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="Ｎクイーン問題（９４）Python/Codonで爆速プログラミング ノードレイヤー＋ミラー">
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（９４）Python/Codonで爆速プログラミング ノードレイヤー＋ミラー</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2025-10-27-09-n-queens-suzuki/chess_hu5d4d4af13a53f9dee6df2227e73445ae_203330_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="Ｎクイーン問題（９３）Python/Codonで爆速プログラミング ノードレイヤー">
</picture>
</div>
<div class=article-details>
<strong class=article-title>Ｎクイーン問題（９３）Python/Codonで爆速プログラミング ノードレイヤー</strong>
<p class=text>ソースコード 今回の連載 python/codonのソースコードディレクトリはこちら ht…</p>
</div>
</a>
</article>
</div>
<div class=link-btns>
<a href=https://suzukiiichiro.github.io/posts/>最新の記事をもっと見る</a>
</div>
</div>
</aside>
<section class="widget archives">
<h2 class=section-title>サイト内検索</h2>
<form action=https://suzukiiichiro.github.io/search/ class="search-form widget">
<input name=keyword required placeholder=検索する文字>
<button title=検索><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
</button>
</form>
</section>
<aside class="widget archives sidearticle-contents--wrapper" id=popular-articles>
<h2 class=section-title>人気コンテンツ</h2>
<div class=sidearticle-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２９．waitコマンド】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２９．waitコマンド】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>waitコマンドは、実行中のプロセスの完了を待機するLinuxの組み込みコマンドです。 waitコマンドは、特定のプロセスIDまたはジョブIDで使用されます。waitコマンドでプロセスIDまたはジョブIDが指定されていない場合、現在のすべての子プロセスが完了するのを待機し、終了ステータスを返します。' wait_example.sh'という名前のファイルを作成し、次のスクリプトを追加します。 wa…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=30>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=15>
<img src=https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_200x0_resize_q75_box.jpg 2x" width=100 height=30 loading=lazy alt=【ssh/Bash】sshでログインして実行して自動的に抜けて返ってくる最も簡単な方法>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【ssh/Bash】sshでログインして実行して自動的に抜けて返ってくる最も簡単な方法</strong>
<p class=text>sshでサーバーにログインして、なんらかのコマンドを実行しターミナルに表示、ミッション終了後、ターミナルを自動的にログアウトしてローカルに何事もなかったかのようにもどってくる最も簡単な方法 やりたいこと sshでサーバーにログインして、なんらかのコマンドを実行しターミナルに表示、ミッション終了後、ターミナルを自動的にログアウトして…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=67>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=33>
<img src=https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_200x0_resize_q75_box.jpg 2x" width=100 height=67 loading=lazy alt=e-Statで面白いデータを探そう。ランキング上位「アイスクリーム」ってなんだ？>
</picture>
</div>
<div class=article-details>
<strong class=article-title>e-Statで面白いデータを探そう。ランキング上位「アイスクリーム」ってなんだ？</strong>
<p class=text>ここではe-Statの検索ランキング上位の「アイスクリーム」というのはどういう統計データなのかを説明しながら、私のe-Statデータマイニングの目的が大量のビックデータから社会的関心の高い項目を抽出することであることを示します。 私のe-Statでのデータマイニングの現在の目的は以下の通りです 大量の政府公開データの中から ①面白そうなデータをピックアップする ②データをわ…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=170>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=85>
<img src=https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_200x0_resize_q75_box.jpg 2x" width=100 height=170 loading=lazy alt=【grep特集】ざっくりわかるシェルスクリプト４>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【grep特集】ざっくりわかるシェルスクリプト４</strong>
<p class=text>bashプログラミングで最も強力な「grep」コマンドの基本的な考え方、bashスクリプトでの一般的な操作例を、ざっくりと説明します。 はじめに grep（グレップ）コマンド。UNIX/Linuxにおいてこれほど歴史あり、強力なコマンドはありません。そして多くのユーザーがこのコ…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２７．mailコマンド】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２７．mailコマンド】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>' mail 'または ' sendmail 'コマンドを使用して電子メールを送信できます。これらのコマンドを使用する前に、mailまたはsendmailに必要なパッケージをインストール・設定をする必要があります。' mail_example.sh 'という名前のファイルを作成し、次のコードを追加して電子メールを送信します。 mailコマンド メールを送る： ' mail &amp;lsquo;または '…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２８．dateコマンド】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２８．dateコマンド】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>dateコマンドを使用して、現在のシステムの日付と時刻の値を取得することができます。日付と時刻は、「Y」、「m」、「d」、「H」、「M」、および「S」を使用します。'date_parse.sh'という名前の新しいファイルを作成し、次のコードを追加して、日、月、年、時、分、秒の値を表示します。 dateコマンド 現在の日付を解析する： dateコマンドを使用して、現在のシステムの日付と時刻の値を取得…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２０．スクリプトからの戻り値を渡す】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２０．スクリプトからの戻り値を渡す】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>Bash関数は、数値と文字列値の両方を渡すことができます。関数から文字列値を渡す方法を次の例に示します。'function_return.sh'という名前のファイルを作成し、次のコードを追加します。関数greeting（）は、文字列値を変数valに返します。この変数は、処理の最後に他の文字列と組み合わせて出力します。 関数からの戻り値の受け渡し 関数からの戻り値の受け渡し： Bash関数は、数値と…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２４．ファイルを削除する】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２４．ファイルを削除する】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>'rm'コマンドは、ファイルまたはディレクトリを削除するためのコマンドです。次のコードを使用して「delete_file.sh」という名前のファイルを作成し、ユーザーからファイル名を取得して削除します。ここで、「-i」オプションは、ファイルを削除する前にユーザーに削除確認をに使用されます。 ファイルを削除する ファイルを削除します： &amp;lsquo;rm&amp;rsquo;コマンドは、ファイルまたはディレ…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【grep/sed/awkも】ざっくりわかるシェルスクリプト５」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【grep/sed/awkも】ざっくりわかるシェルスクリプト５」</strong>
<p class=text>この記事はシェルスクリプトを４５分でざっくりマスターできるチュートリアルです。bashスクリプト「Hello, World」から、ifステートメントなどの条件分岐、while, for, untilループをはじめ、シェルスクリプトの効率的なデバッグ手法の紹介など、シェルスクリプトを網羅的かつ短時間で学習することができます。 …</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=129>
<source srcset="https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=64>
<img src=https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_200x0_resize_q75_box.jpg 2x" width=100 height=129 loading=lazy alt=（８）【grep】シェルスクリプトコマンド活用紹介>
</picture>
</div>
<div class=article-details>
<strong class=article-title>（８）【grep】シェルスクリプトコマンド活用紹介</strong>
<p class=text>指定した文字が含まれている行だけを抽出する grepコマンド コマンドの実行結果から必要な箇所だけを抽出する 単語単位で検索する 前後の行も表示する 行番号付きで表示する 複数の文字列を指定して…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=58>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=29>
<img src=https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_200x0_resize_q75_box.jpg 2x" width=100 height=58 loading=lazy alt="overflow: scroll で後ろまでスクロールするのを防ぐ方法 - スクロール連鎖の防止">
</picture>
</div>
<div class=article-details>
<strong class=article-title>overflow: scroll で後ろまでスクロールするのを防ぐ方法 - スクロール連鎖の防止</strong>
<p class=text>overflow: scroll で後ろの要素がスクロールすることがありますが、CSSを使って、解決する問題、その仕組み、および使用場所について説明します。 出典元：Prevent Scroll Chaining With Overscroll Behavior - Ahmad Shadeed position: fixedの要素があるとしましょう。スクロールがある場合は、要素の下部の境界に到達す…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-17-02-ani/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-17-02-ani/anal_hu68ff39aa0e6aafd68051f9cb2318c17a_134679_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-17-02-ani/anal_hu68ff39aa0e6aafd68051f9cb2318c17a_134679_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=67>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-17-02-ani/anal_hu68ff39aa0e6aafd68051f9cb2318c17a_134679_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-17-02-ani/anal_hu68ff39aa0e6aafd68051f9cb2318c17a_134679_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=33>
<img src=https://suzukiiichiro.github.io/posts/2022-01-17-02-ani/anal_hu68ff39aa0e6aafd68051f9cb2318c17a_134679_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-17-02-ani/anal_hu68ff39aa0e6aafd68051f9cb2318c17a_134679_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-17-02-ani/anal_hu68ff39aa0e6aafd68051f9cb2318c17a_134679_200x0_resize_q75_box.jpg 2x" width=100 height=67 loading=lazy alt="s-Stat 時系列データで異常値を検知しよう（３）">
</picture>
</div>
<div class=article-details>
<strong class=article-title>s-Stat 時系列データで異常値を検知しよう（３）</strong>
<p class=text>ここではpythonのPandasでcsvを読み込んだDataFrameオブジェクトの使い方、DataFrameオブジェクトからSeriesオブジェクトへの変換方法を説明します。 Pandas DataFrameオブジェクト Pandasでcsvをread_csvするとDataFrameオブジェクトとして読み込まれます。 DataFr…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2021-12-25-01-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-25-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-25-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=30>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-25-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-25-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=15>
<img src=https://suzukiiichiro.github.io/posts/2021-12-25-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2021-12-25-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-25-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_200x0_resize_q75_box.jpg 2x" width=100 height=30 loading=lazy alt=【unComp】Bashで便利なコマンドを作ってみようって話>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【unComp】Bashで便利なコマンドを作ってみようって話</strong>
<p class=text>今回は、シェルスクリプトとbashの解凍コマンドを使って、日常よく使う圧縮ファイルの解凍作業を簡単にしてみようって話です できること 圧縮されているファイルを、ファイルの拡張子にあわせて解凍すると言う作業は、日常的に多いものです。今回は、圧縮ファイルの拡張子を判断…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=129>
<source srcset="https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=64>
<img src=https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_200x0_resize_q75_box.jpg 2x" width=100 height=129 loading=lazy alt=（１１）【getopts】シェルスクリプトコマンド活用紹介>
</picture>
</div>
<div class=article-details>
<strong class=article-title>（１１）【getopts】シェルスクリプトコマンド活用紹介</strong>
<p class=text>シェルスクリプトでオプションを処理したい getoptsコマンド オプションを解析する エラーメッセージを表示しない 引数付きのオプションを使用する getoptsコマンド概要 「getopt…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2021-12-21-03/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="hugoで[failed to unmarshal YAML]エラーが出た場合の対処法">
</picture>
</div>
<div class=article-details>
<strong class=article-title>hugoで[failed to unmarshal YAML]エラーが出た場合の対処法</strong>
<p class=text>エラーの内容 記事投稿時にfailed to unmarshal YAM エラーが起こった…</p>
</div>
</a>
</article>
</div>
<div class=link-btns>
<a href=https://suzukiiichiro.github.io/ranking/>人気のコンテンツをもっと見る</a>
</div>
</div>
</aside>
<aside class="widget archives">
<h2 class="widget-title section-title">アーカイブ</h2>
<select name=archives id=select-archives><option value>月を選択</option><option value=/archives/#2026年02月>
2026年02月（1）
</option><option value=/archives/#2025年10月>
2025年10月（17）
</option><option value=/archives/#2025年03月>
2025年03月（18）
</option><option value=/archives/#2024年04月>
2024年04月（2）
</option><option value=/archives/#2023年08月>
2023年08月（5）
</option><option value=/archives/#2023年06月>
2023年06月（61）
</option><option value=/archives/#2023年05月>
2023年05月（19）
</option><option value=/archives/#2023年04月>
2023年04月（6）
</option><option value=/archives/#2023年03月>
2023年03月（8）
</option><option value=/archives/#2023年02月>
2023年02月（6）
</option><option value=/archives/#2023年01月>
2023年01月（4）
</option><option value=/archives/#2022年11月>
2022年11月（17）
</option><option value=/archives/#2022年10月>
2022年10月（13）
</option><option value=/archives/#2022年09月>
2022年09月（8）
</option><option value=/archives/#2022年08月>
2022年08月（10）
</option><option value=/archives/#2022年07月>
2022年07月（20）
</option><option value=/archives/#2022年03月>
2022年03月（1）
</option><option value=/archives/#2022年02月>
2022年02月（22）
</option><option value=/archives/#2022年01月>
2022年01月（59）
</option><option value=/archives/#2021年12月>
2021年12月（14）
</option><option value=/archives/#0001年01月>
0001年01月（1）
</option></select>
</aside>
</div>
</div>
<footer class=site-footer>
<section class=copyright>
&copy;
<a href=https://suzukiiichiro.github.io/>NLP</a> .All Rights Reserved.
</section>
</footer>
<aside class="widget archives sidearticle-contents--wrapper" id=popular-articles--month>
<div class=contents-area>
<header>
<button type=button onclick="document.body.classList.remove('show-menu')">CLOSE</button>
<h2 class=section-title>最近人気の記事</h2>
</header>
<div class=sidearticle-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=30>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=15>
<img src=https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-24-01-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_200x0_resize_q75_box.jpg 2x" width=100 height=30 loading=lazy alt=【ssh/Bash】sshでログインして実行して自動的に抜けて返ってくる最も簡単な方法>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【ssh/Bash】sshでログインして実行して自動的に抜けて返ってくる最も簡単な方法</strong>
<p class=text>sshでサーバーにログインして、なんらかのコマンドを実行しターミナルに表示、ミッション終了後、ターミナルを自動的にログアウトしてローカルに何事もなかったかのようにもどってくる最も簡単な方法 やりたいこと sshでサーバーにログインして、なんらかのコマンドを実行しターミナルに表示、ミッション終了後、ターミナルを自動的にログアウトして…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-29-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２９．waitコマンド】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２９．waitコマンド】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>waitコマンドは、実行中のプロセスの完了を待機するLinuxの組み込みコマンドです。 waitコマンドは、特定のプロセスIDまたはジョブIDで使用されます。waitコマンドでプロセスIDまたはジョブIDが指定されていない場合、現在のすべての子プロセスが完了するのを待機し、終了ステータスを返します。' wait_example.sh'という名前のファイルを作成し、次のスクリプトを追加します。 wa…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-28-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２８．dateコマンド】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２８．dateコマンド】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>dateコマンドを使用して、現在のシステムの日付と時刻の値を取得することができます。日付と時刻は、「Y」、「m」、「d」、「H」、「M」、および「S」を使用します。'date_parse.sh'という名前の新しいファイルを作成し、次のコードを追加して、日、月、年、時、分、秒の値を表示します。 dateコマンド 現在の日付を解析する： dateコマンドを使用して、現在のシステムの日付と時刻の値を取得…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=58>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=29>
<img src=https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-15-01-wyoshi/intro_hu24c71efb47487f1e866b5cfa9cf10000_52262_200x0_resize_q75_box.jpg 2x" width=100 height=58 loading=lazy alt="overflow: scroll で後ろまでスクロールするのを防ぐ方法 - スクロール連鎖の防止">
</picture>
</div>
<div class=article-details>
<strong class=article-title>overflow: scroll で後ろまでスクロールするのを防ぐ方法 - スクロール連鎖の防止</strong>
<p class=text>overflow: scroll で後ろの要素がスクロールすることがありますが、CSSを使って、解決する問題、その仕組み、および使用場所について説明します。 出典元：Prevent Scroll Chaining With Overscroll Behavior - Ahmad Shadeed position: fixedの要素があるとしましょう。スクロールがある場合は、要素の下部の境界に到達す…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=170>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=85>
<img src=https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-24-01-suzuki/grep_hu5909208fb16d2109d0cdca2186f9358e_30103_200x0_resize_q75_box.jpg 2x" width=100 height=170 loading=lazy alt=【grep特集】ざっくりわかるシェルスクリプト４>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【grep特集】ざっくりわかるシェルスクリプト４</strong>
<p class=text>bashプログラミングで最も強力な「grep」コマンドの基本的な考え方、bashスクリプトでの一般的な操作例を、ざっくりと説明します。 はじめに grep（グレップ）コマンド。UNIX/Linuxにおいてこれほど歴史あり、強力なコマンドはありません。そして多くのユーザーがこのコ…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-27-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２７．mailコマンド】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２７．mailコマンド】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>' mail 'または ' sendmail 'コマンドを使用して電子メールを送信できます。これらのコマンドを使用する前に、mailまたはsendmailに必要なパッケージをインストール・設定をする必要があります。' mail_example.sh 'という名前のファイルを作成し、次のコードを追加して電子メールを送信します。 mailコマンド メールを送る： ' mail &amp;lsquo;または '…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=67>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=33>
<img src=https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-26-01-ani/anal_hu1fa49663358d8289c9aaa2b108c2bef9_133702_200x0_resize_q75_box.jpg 2x" width=100 height=67 loading=lazy alt=e-Statで面白いデータを探そう。ランキング上位「アイスクリーム」ってなんだ？>
</picture>
</div>
<div class=article-details>
<strong class=article-title>e-Statで面白いデータを探そう。ランキング上位「アイスクリーム」ってなんだ？</strong>
<p class=text>ここではe-Statの検索ランキング上位の「アイスクリーム」というのはどういう統計データなのかを説明しながら、私のe-Statデータマイニングの目的が大量のビックデータから社会的関心の高い項目を抽出することであることを示します。 私のe-Statでのデータマイニングの現在の目的は以下の通りです 大量の政府公開データの中から ①面白そうなデータをピックアップする ②データをわ…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-02-14-01-wyoshi/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-02-14-01-wyoshi/intro_hu1a4f8ee8698ef571fbfcd575aad93d81_24156_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-02-14-01-wyoshi/intro_hu1a4f8ee8698ef571fbfcd575aad93d81_24156_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=51>
<source srcset="https://suzukiiichiro.github.io/posts/2022-02-14-01-wyoshi/intro_hu1a4f8ee8698ef571fbfcd575aad93d81_24156_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-02-14-01-wyoshi/intro_hu1a4f8ee8698ef571fbfcd575aad93d81_24156_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=25>
<img src=https://suzukiiichiro.github.io/posts/2022-02-14-01-wyoshi/intro_hu1a4f8ee8698ef571fbfcd575aad93d81_24156_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-02-14-01-wyoshi/intro_hu1a4f8ee8698ef571fbfcd575aad93d81_24156_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-02-14-01-wyoshi/intro_hu1a4f8ee8698ef571fbfcd575aad93d81_24156_200x0_resize_q75_box.jpg 2x" width=100 height=51 loading=lazy alt=CSSでアプリのようにピタッとスナップするスクロールを作成>
</picture>
</div>
<div class=article-details>
<strong class=article-title>CSSでアプリのようにピタッとスナップするスクロールを作成</strong>
<p class=text>アプリでスクロールしてコンテンツにスナップする動作は一般的ですが、CSSでもアプリと同じようにスクロールしてスナップする動作が実装できます。 出典元：CSS Scroll Snap - Ahmad Shadeed アプリなどで横スクロールしてコンテンツにスナップするといった動作をよく見かけると思いますが、CSSで横スクロールのU…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-24-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２４．ファイルを削除する】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２４．ファイルを削除する】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>'rm'コマンドは、ファイルまたはディレクトリを削除するためのコマンドです。次のコードを使用して「delete_file.sh」という名前のファイルを作成し、ユーザーからファイル名を取得して削除します。ここで、「-i」オプションは、ファイルを削除する前にユーザーに削除確認をに使用されます。 ファイルを削除する ファイルを削除します： &amp;lsquo;rm&amp;rsquo;コマンドは、ファイルまたはディレ…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=129>
<source srcset="https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=64>
<img src=https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-04-01-grep-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_200x0_resize_q75_box.jpg 2x" width=100 height=129 loading=lazy alt=（８）【grep】シェルスクリプトコマンド活用紹介>
</picture>
</div>
<div class=article-details>
<strong class=article-title>（８）【grep】シェルスクリプトコマンド活用紹介</strong>
<p class=text>指定した文字が含まれている行だけを抽出する grepコマンド コマンドの実行結果から必要な箇所だけを抽出する 単語単位で検索する 前後の行も表示する 行番号付きで表示する 複数の文字列を指定して…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2021-12-23-03-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-23-03-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-23-03-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=30>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-23-03-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-23-03-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=15>
<img src=https://suzukiiichiro.github.io/posts/2021-12-23-03-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2021-12-23-03-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-23-03-suzuki/2021-12-23-bash_hu3f93fa107d6ed2da910fda4d86a52d3c_22108_200x0_resize_q75_box.jpg 2x" width=100 height=30 loading=lazy alt=【プログレスバー】Bashでプログレスバーを作ってみようって話>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【プログレスバー】Bashでプログレスバーを作ってみようって話</strong>
<p class=text>今回は、シェルスクリプトでプログレスバーを作ってみようと思います。処理の進捗をコンソールに表示させることで処理の進捗が確認できるのはデバッグや最適化にも役に立ちます。 プログレスバー ターミナルで、処理の進捗が表示されるプログレスバーというのがあります。 処理が進むにつれて、ジリジリとメーターが右に増えていくあ…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=129>
<source srcset="https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=64>
<img src=https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-07-07-01-getopts-suzuki/bash_hu5909208fb16d2109d0cdca2186f9358e_33901_200x0_resize_q75_box.jpg 2x" width=100 height=129 loading=lazy alt=（１１）【getopts】シェルスクリプトコマンド活用紹介>
</picture>
</div>
<div class=article-details>
<strong class=article-title>（１１）【getopts】シェルスクリプトコマンド活用紹介</strong>
<p class=text>シェルスクリプトでオプションを処理したい getoptsコマンド オプションを解析する エラーメッセージを表示しない 引数付きのオプションを使用する getoptsコマンド概要 「getopt…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2021-12-21-03/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=75>
<source srcset="https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=38>
<img src=https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2021-12-21-03/error_hu7e39d96c0286759ff592e45a50a24444_91990_200x0_resize_q75_box.jpg 2x" width=100 height=75 loading=lazy alt="hugoで[failed to unmarshal YAML]エラーが出た場合の対処法">
</picture>
</div>
<div class=article-details>
<strong class=article-title>hugoで[failed to unmarshal YAML]エラーが出た場合の対処法</strong>
<p class=text>エラーの内容 記事投稿時にfailed to unmarshal YAM エラーが起こった…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-01-14-20-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【２０．スクリプトからの戻り値を渡す】ざっくりわかる「シェルスクリプト」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【２０．スクリプトからの戻り値を渡す】ざっくりわかる「シェルスクリプト」</strong>
<p class=text>Bash関数は、数値と文字列値の両方を渡すことができます。関数から文字列値を渡す方法を次の例に示します。'function_return.sh'という名前のファイルを作成し、次のコードを追加します。関数greeting（）は、文字列値を変数valに返します。この変数は、処理の最後に他の文字列と組み合わせて出力します。 関数からの戻り値の受け渡し 関数からの戻り値の受け渡し： Bash関数は、数値と…</p>
</div>
</a>
</article>
<article class=has-image>
<a href=https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/>
<div class=article-image>
<picture class=picture>
<source srcset="https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" media="(min-width: 769px)" width=100 height=127>
<source srcset="https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_50x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 2x" media="(max-width: 768px)" width=50 height=63>
<img src=https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg srcset="https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_100x0_resize_q75_box.jpg 1x, https://suzukiiichiro.github.io/posts/2022-02-02-01-suzuki/shellscript_hu5909208fb16d2109d0cdca2186f9358e_31961_200x0_resize_q75_box.jpg 2x" width=100 height=127 loading=lazy alt=【grep/sed/awkも】ざっくりわかるシェルスクリプト５」>
</picture>
</div>
<div class=article-details>
<strong class=article-title>【grep/sed/awkも】ざっくりわかるシェルスクリプト５」</strong>
<p class=text>この記事はシェルスクリプトを４５分でざっくりマスターできるチュートリアルです。bashスクリプト「Hello, World」から、ifステートメントなどの条件分岐、while, for, untilループをはじめ、シェルスクリプトの効率的なデバッグ手法の紹介など、シェルスクリプトを網羅的かつ短時間で学習することができます。 …</p>
</div>
</a>
</article>
</div>
</div>
</div>
</aside>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=https://suzukiiichiro.github.io/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
<script type=module>
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
  const firebaseConfig = {
    apiKey: "AIzaSyDuTc8tgNsMVZK0YbZbH_i23ESm9YT1Vx4",
    authDomain: "nlp-blog-927bd.firebaseapp.com",
    projectId: "nlp-blog-927bd",
    storageBucket: "nlp-blog-927bd.appspot.com",
    messagingSenderId: "469873098519",
    appId: "1:469873098519:web:9ae03fb6e0a40fbf06c152",
    measurementId: "G-TC37CVBC0B"
  };
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  
</script>
<script src=https://suzukiiichiro.github.io/js/Custom.js></script>
<script>let setFillHeight=()=>{let a=window.innerHeight*.01;document.documentElement.style.setProperty('--vh',`${a}px`)};window.addEventListener('resize',setFillHeight),setFillHeight(),document.addEventListener('DOMContentLoaded',()=>{let a=document.getElementsByTagName('code');Array.from(a).forEach(a=>{if(a.className){let b=a.className.split(':'),d=b[0],c=b[1];c&&(a.classList.remove(a.className),a.classList.add(d),a.parentElement.setAttribute('data-lang',c),a.parentElement.classList.add('code-block-header'))}})})</script>
</body>
</html>